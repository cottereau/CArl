<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>CArl: Usage and implementation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_html_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CArl
   </div>
   <div id="projectbrief">Code Arlequin / C++ implementation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('cpp_usage.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Usage and implementation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="sec_cpp_usage"></a>
Usage</h1>
<h2><a class="anchor" id="subsec_cpp_workflow"></a>
Workflow</h2>
<p>The C++ implementation of the Arlequin method follows the algorithms presented in [[[REF]]], and it is roughly divided into three parts:</p>
<ol type="1">
<li>the mesh intersection search,</li>
<li>the coupling matrices assembly,</li>
<li>and the coupled system solver.</li>
</ol>
<p>The first two steps are implemented in the <a class="el" href="_c_arl__build__intersections_8cpp.html">CArl_build_intersections</a> and <a class="el" href="_c_arl__assemble__coupling_8cpp.html">CArl_assemble_coupling</a>, respectivelly. Their corresponding pages contain the documentation of the input parameters.</p>
<p>The coupled system solver uses the FETI method [[[REF]]] to calculate the coupled solutions of the two systems. To allow the usage of external solvers in a non-intrusive way, the implementation is broken down into several <code>CArl_FETI_***</code> binaries. If the user is using a scheduler program such as PBS, he only has to configure and launch the <a class="el" href="_c_arl___f_e_t_i__setup__init_8cpp_source.html">CArl_FETI_setup_init</a> binary.</p>
<p>If the user is not using a scheduler, the <a class="el" href="_c_arl___f_e_t_i__setup__init_8cpp_source.html">CArl_FETI_setup_init</a> binary will still take care of preparing the other binaries' input files, but the user will have to launch them by hand! Each binary will still return the command that the user has to run, but due to this limitation, the usage of a scheduler is highly recomended. This limitation is due to the fact that <code>mpirun</code> cannot be called recursively in the same shell.</p>
<p>Before calling the coupled system solver, though, the user has to do any preliminary operations involving the external solvers, including preparing their input parameter files. The output of the coupled system solver is a vector in the PETSc binary format.</p>
<p>The figure below presents a workflow for using the C++ version of CArl. The page <a class="el" href="cpp_examples.html">Examples</a> shows, in detailed steps, how to run a simple test case using external solvers based on the libMesh library. Finally, a more detailed description of the role of each <code>CArl_FETI_***</code> binaries is presented in the section <a class="el" href="cpp_usage.html#sec_cpp_implementation">Implementation of the FETI solver</a>.</p>
<div class="image">
<img src="CArl_FETI_structure_slide_reduced.png" alt="CArl_FETI_structure_slide_reduced.png"/>
<div class="caption">
Workflow of the C++ version of CArl</div></div>
 <h2><a class="anchor" id="subsec_cpp_input"></a>
Input file syntax</h2>
<p>All the <code>CArl_FETI_***</code> binaries take as an input a configuration file though the command line argument <code>-i</code>: </p><pre class="fragment">./CArl_FETI_*** -i [input file]
</pre><p>These input files contain parameters such as file paths, output folders, configuration parameters and Boolean flags. They are case-sensitive, and the symbol <code>#</code> is used to comment a single line.</p>
<p>Most of the parameters follow a <code>ParameterName [value]</code> format: </p><pre class="fragment"># Cluster scheduler type
ClusterSchedulerType LOCAL

# Path to the base script file
ScriptFile examples/coupled_traction_test/FETI_solver/common_script.sh
</pre><p>Since a space separates the <code>ParameterName</code> and the <code>[value]</code>, values containing spaces must be enclosed in `' '`: </p><pre class="fragment"># Command used for the external solver for the system A
ExtSolverA 'mpirun -n 4 ./libmesh_solve_linear_system -i '
</pre><p>Boolean flags do not have a <code>[value]</code>. Adding / uncommenting the <code>ParameterName</code> activates the option: </p><pre class="fragment"># Use the rigid body modes from the model B?
UseRigidBodyModesB 
</pre><p>A description of each file and its parameters can be found at the documentation pages of the corresponding <code>CArl_FETI_***</code> binaries.</p>
<h1><a class="anchor" id="secrb"></a>
Rigid body modes</h1>
<p>If the matrix of any of the models is ill-conditioned, the FETI solver needs its null space vectors / rigid body modes to work properly. These vectors must be saved in PETSc's binary format. An example of such a model is a linear elastic system under only a traction force. A detailed description of this case is shown in the <a class="el" href="cpp_exampletraction.html">3D traction test</a> example.</p>
<h1><a class="anchor" id="sec_cpp_implementation"></a>
Implementation of the FETI solver</h1>
<p>This section enters in some details of the implementation of the FETI solver, and as such reading the references [[[REF]]] and [[[REF]]] beforehand is highly recommended.</p>
<p>As said above, our implementation of the FETI algortihm is broken down into several <code>CArl_FETI_***</code> binaries. The "break points" correspont to the operations of the FETI algorithm where the solutions of the external solvers are needed. Before closing, each one of these binaries executes a script which first submits the jobs for the external solver, and then calls the appropriate <code>CArl_FETI_***</code> binary to continue the algortihm.</p>
<p>This approach allows a non-intrusive usaage of the external solvers: the user only has to worry to save the data to be sent from the <code>CArl_FETI_***</code> binaries and the external solvers in the appropriate format (see note <a class="el" href="cpp_usage.html#note_1">1</a>). It also avoids wasting cluster resources with idling jobs.</p>
<p>The figure below shows the structure of the FETI solver. It proceeds in the following manner:</p>
<ol type="1">
<li><b>Setup</b>:<ol type="a">
<li><a class="el" href="_c_arl___f_e_t_i__setup__init_8cpp_source.html">CArl_FETI_setup_init</a> generates the input parameter files for the other binaries, and the three execution scripts: <code>init_script.sh</code>, <code>iter_script.sh</code> and <code>sol_script.sh</code>. It then starts the setup of conjugate gradient method (CG) used by the coupled solver to calculate the Lagrange multipliers, and finally executes the <code>init_script.sh</code> script.</li>
<li>The <code>init_script.sh</code> script runs the external solvers for the uncoupled solutions <img class="formulaInl" alt="$u_{m,0}$" src="form_10.png"/> ( <img class="formulaInl" alt="$m = 1,2$" src="form_11.png"/>), and the initial auxiliary vectors <img class="formulaInl" alt="$x_l(0)$" src="form_38.png"/> (if needed). After these solvers are finished, the script launches <a class="el" href="_c_arl___f_e_t_i__setup__finish_8cpp_source.html">CArl_FETI_setup_finish</a>.</li>
<li><a class="el" href="_c_arl___f_e_t_i__setup__finish_8cpp_source.html">CArl_FETI_setup_finish</a> finishes the CG solver setup, and executes <code>iter_script.sh</code>.</li>
</ol>
</li>
<li><b>Iterate</b><ol type="a">
<li>The <code>iter_script.sh</code> script runs the external solvers for the <img class="formulaInl" alt="$iii$" src="form_13.png"/>-th auxiliary vectors <img class="formulaInl" alt="$x_l(iii)$" src="form_39.png"/>. After these solvers are finished, the script launches <a class="el" href="_c_arl___f_e_t_i__iterate_8cpp_source.html">CArl_FETI_iterate</a></li>
<li><a class="el" href="_c_arl___f_e_t_i__iterate_8cpp_source.html">CArl_FETI_iterate</a> all the other operations involved in the CG solver iteration, and checks the convergence parameters:<ul>
<li>If the CG solver neither converged or diverged, it executes <code>iter_script.sh</code> again.</li>
<li>If the CG solver converged, it executes <code>sol_script.sh</code>.</li>
<li>If the CG solver diverged, it stops the algorithm.</li>
</ul>
</li>
</ol>
</li>
<li><b>Solution</b><ol type="a">
<li>The <code>sol_script.sh</code> runs the external solvers for the final auxiliary vectors <img class="formulaInl" alt="$x_l(FINAL)$" src="form_40.png"/>, used to calculate the coupling effects on the models' solutions. After these solvers are finished, the script launches CArl_FETI_set_sol, which assembles and exports the coupled system solutions <img class="formulaInl" alt="$u_{m}$" src="form_16.png"/>.</li>
</ol>
</li>
</ol>
<p>As said above, this process is completely automated if a scheduling software, such as PBS, is used: the user only has to configure and execute the <code>CArl_FETI_setup_init</code> binary. Details about the input parameters of each binary can be found at its documentation page (linked above).</p>
<div class="image">
<img src="CArl_FETI_structure_slide_feti_solver.png" alt="CArl_FETI_structure_slide_feti_solver.png"/>
<div class="caption">
Structure of the CArl / FETI solver</div></div>
 <h1><a class="anchor" id="cpp_usage_refs"></a>
Notes and references</h1>
<p><a class="anchor" id="note_1"></a>1. At the moment, the binaries are capable of reading and writing vectors and matrices in the PETSc binary vectors and matrices. Details of their usage can be found at the documentation of each executable. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="cpp_main.html">CArl C++</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
