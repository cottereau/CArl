load "medit"

//border a(t=0,1){x=t;y=0;};
//border b(t=0,0.5){x=1;y=t;};
//border c(t=0,0.5){x=1-t;y=0.5;};
//border d(t=0.5,1){x=0.5;y=t;};
//border e(t=0.5,1){x=1-t;y=1;};
//border f(t=0,1){x=0;y=1-t;};
//
//mesh th = buildmesh (a(6) + b(4) + c(4) +d(4) + e(4) +
//    f(6));
//
//border aa(t=0,0.2){x=0.1+t;y=0.1;};
//border bb(t=0,0.2){x=0.3;y=0.1+t;};
//border cc(t=0,0.2){x=0.3-t;y=0.3;};
//border dd(t=0,0.2){x=0.1;y=0.3-t;};
//
//mesh silly = buildmesh (a(3) + b(2) + c(2) +d(2) + e(2) +
//	    f(3)+ aa(3) + bb(3) + cc(3) + dd(3));

mesh th = readmesh("base_problem.mesh");
mesh mask = readmesh("alpha_mask_FE2Dlatin.mesh");

fespace Vh(th,P2);
fespace Ph(mask,P0);

Vh u,v, uu,vv;

Ph reg=region;

int idxA =reg(2.5,0.5);
int idxB =reg(0.5,0.5);
int idxI =reg(1.5,0.5);

cout << "idxA = " <<  idxA << ", idxB = " << idxB << ", idxI = " << idxI << endl;

Ph isInA = (region==idxA);
Ph isInB = (region==idxB);
Ph isInI = (region==idxI);

Ph   numa	= 1-0.5*isInA-0.5*isInB + 0.5*isInI;
func nu		= 1-0.5*isInA-0.5*isInB + 0.5*isInI;

plot(th,wait=true);
plot(mask,wait=true);
plot(numa,fill=true,value=true,wait=true);

solve lap(u,v)	= int2d(th)(nu*( dx(u)*dx(v)+dy(u)*dy(v) ) )
		        	+ int2d(th)(-1*v)
					+ on(1,2,3,4,u= 0);

solve lap2(uu,vv)	= int2d(th)( ( dx(uu)*dx(vv)+dy(uu)*dy(vv) ) )
		        	+ int2d(th)(-1*vv)
					+ on(1,2,3,4,uu= 0);

plot(u,value=1,wait=1);
plot(uu,value=1,wait=1);
plot(u,uu,value=1,wait=1);

