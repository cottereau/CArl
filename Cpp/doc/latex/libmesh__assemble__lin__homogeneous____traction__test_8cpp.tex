\hypertarget{libmesh__assemble__lin__homogeneous____traction__test_8cpp}{}\section{/\+Users/breubreubreu/\+Programming/\+C\+Arl/\+Cpp/src/execs/ext\+\_\+solver\+\_\+libmesh/libmesh\+\_\+assemble\+\_\+lin\+\_\+homogeneous\+\_\+\+\_\+traction\+\_\+test.cpp File Reference}
\label{libmesh__assemble__lin__homogeneous____traction__test_8cpp}\index{/\+Users/breubreubreu/\+Programming/\+C\+Arl/\+Cpp/src/execs/ext\+\_\+solver\+\_\+libmesh/libmesh\+\_\+assemble\+\_\+lin\+\_\+homogeneous\+\_\+\+\_\+traction\+\_\+test.\+cpp@{/\+Users/breubreubreu/\+Programming/\+C\+Arl/\+Cpp/src/execs/ext\+\_\+solver\+\_\+libmesh/libmesh\+\_\+assemble\+\_\+lin\+\_\+homogeneous\+\_\+\+\_\+traction\+\_\+test.\+cpp}}
{\ttfamily \#include \char`\"{}libmesh\+\_\+assemble\+\_\+lin\+\_\+homogeneous.\+h\char`\"{}}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{libmesh__assemble__lin__homogeneous____traction__test_8cpp_a3c04138a5bfe5d72780bb7e82a18e627}{main} (int argc, char $\ast$$\ast$argv)
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{libmesh__assemble__lin__homogeneous____traction__test_8cpp_a3c04138a5bfe5d72780bb7e82a18e627}{}\index{libmesh\+\_\+assemble\+\_\+lin\+\_\+homogeneous\+\_\+\+\_\+traction\+\_\+test.\+cpp@{libmesh\+\_\+assemble\+\_\+lin\+\_\+homogeneous\+\_\+\+\_\+traction\+\_\+test.\+cpp}!main@{main}}
\index{main@{main}!libmesh\+\_\+assemble\+\_\+lin\+\_\+homogeneous\+\_\+\+\_\+traction\+\_\+test.\+cpp@{libmesh\+\_\+assemble\+\_\+lin\+\_\+homogeneous\+\_\+\+\_\+traction\+\_\+test.\+cpp}}
\subsubsection[{main(int argc, char $\ast$$\ast$argv)}]{\setlength{\rightskip}{0pt plus 5cm}int main (
\begin{DoxyParamCaption}
\item[{int}]{argc, }
\item[{char $\ast$$\ast$}]{argv}
\end{DoxyParamCaption}
)}\label{libmesh__assemble__lin__homogeneous____traction__test_8cpp_a3c04138a5bfe5d72780bb7e82a18e627}


Definition at line 3 of file libmesh\+\_\+assemble\+\_\+lin\+\_\+homogeneous\+\_\+\+\_\+traction\+\_\+test.\+cpp.


\begin{DoxyCode}
3                                 \{
4 
5     \textcolor{comment}{// [USER] Fixed boudary}
6     \hyperlink{ext__solver__libmesh__enums_8h_aa97ba4cfa58a6195444e6787a97757ef}{boundary\_id\_cube} fixed\_bound\_id = \hyperlink{ext__solver__libmesh__enums_8h_aa97ba4cfa58a6195444e6787a97757efa4ebfde8f7a29f6160bd733c093a6074b}{boundary\_id\_cube::MIN\_X};
7     
8     \textcolor{comment}{// [USER] Traction force density}
9     std::vector<double> traction\_density(3,0);
10     traction\_density[0] = 100.;
11 
12     \textcolor{comment}{// --- Initialize libMesh}
13     libMesh::LibMeshInit init(argc, argv);
14 
15     \textcolor{comment}{// Do performance log?}
16     \textcolor{keyword}{const} \textcolor{keywordtype}{bool} MASTER\_bPerfLog\_carl\_libmesh = \textcolor{keyword}{true};
17     libMesh::PerfLog perf\_log(\textcolor{stringliteral}{"Main program"}, MASTER\_bPerfLog\_carl\_libmesh);
18 
19     \textcolor{comment}{// libMesh's C++ / MPI communicator wrapper}
20     libMesh::Parallel::Communicator& WorldComm = init.comm();
21 
22     \textcolor{comment}{// Number of processors and processor rank.}
23     \textcolor{keywordtype}{int} rank = WorldComm.rank();
24     \textcolor{keywordtype}{int} nodes = WorldComm.size();
25 
26     \textcolor{comment}{// --- Set up inputs}
27 
28     \textcolor{comment}{// Command line parser}
29     GetPot command\_line(argc, argv);
30 
31     \textcolor{comment}{// File parser}
32     GetPot field\_parser;
33 
34     \textcolor{comment}{// If there is an input file, parse it to get the parameters. Else, parse the command line}
35     std::string input\_filename;
36     \textcolor{keywordflow}{if} (command\_line.search(2, \textcolor{stringliteral}{"--inputfile"}, \textcolor{stringliteral}{"-i"})) \{
37         input\_filename = command\_line.next(input\_filename);
38         field\_parser.parse\_input\_file(input\_filename, \textcolor{stringliteral}{"#"}, \textcolor{stringliteral}{"\(\backslash\)n"}, \textcolor{stringliteral}{" \(\backslash\)t\(\backslash\)n"});
39     \} \textcolor{keywordflow}{else} \{
40         field\_parser = command\_line;
41     \}
42 
43     \hyperlink{structlibmesh__assemble__input__params}{libmesh\_assemble\_input\_params} input\_params;
44     \hyperlink{namespacecarl_a902f88f3c52c6fc9c974bc99832e78a7}{get\_input\_params}(field\_parser, input\_params);
45 
46     \textcolor{comment}{// Check libMesh installation dimension}
47     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} dim = 3;
48 
49     libmesh\_example\_requires(dim == LIBMESH\_DIM, \textcolor{stringliteral}{"3D support"});
50 
51     \textcolor{comment}{// --- Declare the three meshes to be intersected}
52 
53     \textcolor{comment}{// - Parallelized meshes: A, B, mediator and weight}
54     perf\_log.push(\textcolor{stringliteral}{"Meshes - Parallel"},\textcolor{stringliteral}{"Read files:"});
55     libMesh::Mesh system\_mesh(WorldComm, dim);
56     system\_mesh.read(input\_params.\hyperlink{structlibmesh__assemble__input__params_aaacb1a941decf01232ab3c5bd9b3bacf}{mesh\_file});
57     system\_mesh.prepare\_for\_use();
58 
59     libMesh::Mesh mesh\_weight(WorldComm, dim);
60     mesh\_weight.allow\_renumbering(\textcolor{keyword}{false});
61     mesh\_weight.read(input\_params.\hyperlink{structlibmesh__assemble__input__params_abac50ee0db80bff6bb89d017d1fdc27b}{mesh\_weight\_file});
62     mesh\_weight.prepare\_for\_use();
63 
64     perf\_log.pop(\textcolor{stringliteral}{"Meshes - Parallel"},\textcolor{stringliteral}{"Read files:"});
65 
66     \textcolor{comment}{// --- Generate the equation systems}
67     perf\_log.push(\textcolor{stringliteral}{"System setup:"});
68 
69     \textcolor{comment}{// Set the equation systems object}
70     libMesh::EquationSystems equation\_systems(system\_mesh);
71 
72     \textcolor{comment}{// Add linear elasticity and physical parameters systems}
73     libMesh::LinearImplicitSystem& elasticity\_system
74                                         = \hyperlink{_c_arl__assemble__coupling_8cpp_a1fab87d9dc5c891ae8234cec6cf73491}{add\_elasticity}(equation\_systems);
75 
76     \textcolor{comment}{// Set clamped border}
77     \hyperlink{common__assemble__functions__elasticity__3_d_8cpp_a2ab22af687ba4728815bcf71500f2b8e}{set\_clamped\_border}(elasticity\_system, fixed\_bound\_id);
78 
79     \textcolor{comment}{// Initialize the equation systems}
80     equation\_systems.init();
81 
82     \textcolor{comment}{// Homogeneous properties for the macro system}
83     \hyperlink{assemble__functions__elasticity__3_d_8cpp_aea23a05af24215485f869a40649d9323}{set\_homogeneous\_physical\_properties}(equation\_systems, input\_params.
      \hyperlink{structlibmesh__assemble__input__params_a2aef9210c303764810d978496712e9b3}{physical\_params\_file});
84 
85     \textcolor{comment}{// Set the weight function object}
86     \hyperlink{classweight__parameter__function}{weight\_parameter\_function}  system\_weight(mesh\_weight);
87     system\_weight.set\_parameters(input\_params.\hyperlink{structlibmesh__assemble__input__params_a9b91599c97b26e5446f26440f74b896f}{weight\_domain\_idx\_file});
88 
89     perf\_log.pop(\textcolor{stringliteral}{"System setup:"});
90 
91     \textcolor{comment}{// Assemble!}
92     \hyperlink{assemble__functions__elasticity__3_d_8cpp_a2dd8cb6689b655c3ed988b7a2e07bf28}{assemble\_elasticity\_with\_weight\_and\_traction}(
      equation\_systems,\textcolor{stringliteral}{"Elasticity"},system\_weight,
93                             input\_params.\hyperlink{structlibmesh__assemble__input__params_a030b78e020faf6210813844e8f0c2eca}{system\_type},
94                             \hyperlink{ext__solver__libmesh__enums_8h_aa97ba4cfa58a6195444e6787a97757efa6d01f57e9870b866518c9526535ae170}{boundary\_id\_cube::MAX\_X},
95                             traction\_density);
96                             
97 \textcolor{comment}{// Print MatLab debugging output? Variable defined at "carl\_headers.h"}
98 \textcolor{preprocessor}{#ifdef PRINT\_MATLAB\_DEBUG}
99     elasticity\_system.matrix->print\_matlab(input\_params.\hyperlink{structlibmesh__assemble__input__params_af6d7a41287b40d913e5110b115b0b692}{output\_base} + \textcolor{stringliteral}{"\_sys\_mat.m"});
100     elasticity\_system.rhs->print\_matlab(input\_params.\hyperlink{structlibmesh__assemble__input__params_af6d7a41287b40d913e5110b115b0b692}{output\_base} + \textcolor{stringliteral}{"\_sys\_rhs\_vec.m"});
101 \textcolor{preprocessor}{#endif}
102 
103     \textcolor{comment}{// Export matrix and vector}
104     libMesh::PetscMatrix<libMesh::Number> * temp\_mat\_ptr = 
      libMesh::cast\_ptr<libMesh::PetscMatrix<libMesh::Number> * >(elasticity\_system.matrix);
105     libMesh::PetscVector<libMesh::Number> * temp\_vec\_ptr = 
      libMesh::cast\_ptr<libMesh::PetscVector<libMesh::Number> * >(elasticity\_system.rhs);
106 
107     \hyperlink{namespacecarl_a431936850bf5712121d8399ddbd76aa8}{carl::write\_PETSC\_matrix}(*temp\_mat\_ptr, input\_params.
      \hyperlink{structlibmesh__assemble__input__params_af6d7a41287b40d913e5110b115b0b692}{output\_base} + \textcolor{stringliteral}{"\_sys\_mat.petscmat"});
108     \hyperlink{namespacecarl_a1632084ec1f296b63559648cc9c2047f}{carl::write\_PETSC\_vector}(*temp\_vec\_ptr, input\_params.
      \hyperlink{structlibmesh__assemble__input__params_af6d7a41287b40d913e5110b115b0b692}{output\_base} + \textcolor{stringliteral}{"\_sys\_rhs\_vec.petscvec"});
109 
110     \textcolor{comment}{// If needed, print rigid body vectors}
111     \textcolor{keywordflow}{if}(input\_params.\hyperlink{structlibmesh__assemble__input__params_ae23881f91f012a17aca3f6d296f97ae9}{bCalculateRBVectors})
112     \{
113         MatNullSpace nullsp\_sys;
114         \hyperlink{rigid__body__nullspace__functions__3_d_8h_ae89c68ca2fb752127c2c39e23668f914}{build\_rigid\_body\_vectors}(elasticity\_system,nullsp\_sys);
115         \hyperlink{rigid__body__nullspace__functions__3_d_8h_a92d61aec182bca7a41728f3856f7113f}{write\_rigid\_body\_vectors}(nullsp\_sys,input\_params.
      \hyperlink{structlibmesh__assemble__input__params_af6d7a41287b40d913e5110b115b0b692}{output\_base},WorldComm.rank());
116         MatNullSpaceDestroy(&nullsp\_sys);
117     \}
118 
119     \textcolor{keywordflow}{return} 0;
120 \}\end{DoxyCode}
