\hypertarget{classcarl_1_1assemble__coupling__matrices}{}\section{carl\+:\+:assemble\+\_\+coupling\+\_\+matrices Class Reference}
\label{classcarl_1_1assemble__coupling__matrices}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}


{\ttfamily \#include $<$assemble\+\_\+coupling.\+h$>$}

\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classcarl_1_1assemble__coupling__matrices_a241a34bd5cc9b968f1d3d5d1ed7b5b0c}{assemble\+\_\+coupling\+\_\+matrices} (const lib\+Mesh\+::\+Parallel\+::\+Communicator \&comm)
\item 
\hyperlink{classcarl_1_1assemble__coupling__matrices_a0a9d43d2af319a9065e720d73b87190f}{$\sim$assemble\+\_\+coupling\+\_\+matrices} ()
\item 
void \hyperlink{classcarl_1_1assemble__coupling__matrices_a3b3020dd40cd78050744b35f9515b4d8}{clear} ()
\item 
lib\+Mesh\+::\+Equation\+Systems \& \hyperlink{classcarl_1_1assemble__coupling__matrices_a4ae5318b482918a2894a7fbcfde71b47}{set\+\_\+\+B\+I\+G\+\_\+\+Equation\+System} (const std\+::string \&name, lib\+Mesh\+::\+Mesh\+Base \&B\+I\+G\+Mesh)
\item 
lib\+Mesh\+::\+Equation\+Systems \& \hyperlink{classcarl_1_1assemble__coupling__matrices_a612773fda111eb80066b78cba261487e}{set\+\_\+\+Restricted\+\_\+\+B\+I\+G\+\_\+\+Equation\+System} (const std\+::string \&name, lib\+Mesh\+::\+Mesh\+Base \&R\+\_\+\+B\+I\+G\+Mesh)
\item 
{\footnotesize template$<$typename lib\+Mesh\+\_\+\+Matrix\+Type $>$ }\\lib\+Mesh\+::\+Equation\+Systems \& \hyperlink{classcarl_1_1assemble__coupling__matrices_a9ce9e893a73b9daaa7e7a419981495cc}{add\+\_\+micro\+\_\+\+Equation\+System} (const std\+::string \&name, lib\+Mesh\+::\+Mesh\+Base \&micro\+Mesh)
\item 
lib\+Mesh\+::\+Equation\+Systems \& \hyperlink{classcarl_1_1assemble__coupling__matrices_a94097d94bf9d2cb279fa062acaa1cb11}{add\+\_\+\+Restricted\+\_\+micro\+\_\+\+Equation\+System} (const std\+::string \&name, lib\+Mesh\+::\+Mesh\+Base \&R\+\_\+micro\+Mesh)
\item 
lib\+Mesh\+::\+Equation\+Systems \& \hyperlink{classcarl_1_1assemble__coupling__matrices_a837d8dd37af967adb11fd969660aff92}{add\+\_\+inter\+\_\+\+Equation\+System} (const std\+::string \&name, lib\+Mesh\+::\+Mesh\+Base \&inter\+Mesh)
\item 
lib\+Mesh\+::\+Equation\+Systems \& \hyperlink{classcarl_1_1assemble__coupling__matrices_a48de3bdb72c2b94ef7667b9288487d1b}{add\+\_\+mediator\+\_\+\+Equation\+System} (const std\+::string \&name, lib\+Mesh\+::\+Mesh\+Base \&mediator\+Mesh)
\item 
void \hyperlink{classcarl_1_1assemble__coupling__matrices_a68f48738c5ee19dc3b23f7c7b5645f84}{set\+\_\+coupling\+\_\+parameters} (const std\+::string \&name, double coupling\+\_\+rigidity, double coupling\+\_\+width)
\begin{DoxyCompactList}\small\item\em Set physical parameters. \end{DoxyCompactList}\item 
void \hyperlink{classcarl_1_1assemble__coupling__matrices_a677a3527845b3503cc5f5daa8de63864}{set\+\_\+corrected\+\_\+shapes} (const std\+::vector$<$ std\+::vector$<$ lib\+Mesh\+::\+Real $>$ $>$ \&lambda\+\_\+weights, const std\+::vector$<$ std\+::vector$<$ lib\+Mesh\+::\+Real $>$ $>$ \&phi\+\_\+inter, std\+::vector$<$ std\+::vector$<$ lib\+Mesh\+::\+Real $>$ $>$ \&phi\+\_\+corrected)
\item 
void \hyperlink{classcarl_1_1assemble__coupling__matrices_a7f5ae4da1fe905fb90e9016f1dbb2fea}{set\+\_\+corrected\+\_\+shape\+\_\+gradients} (const std\+::vector$<$ std\+::vector$<$ lib\+Mesh\+::\+Real $>$ $>$ \&lambda\+\_\+weights, const std\+::vector$<$ std\+::vector$<$ lib\+Mesh\+::\+Real\+Gradient $>$ $>$ \&phi\+\_\+inter, std\+::vector$<$ std\+::vector$<$ lib\+Mesh\+::\+Real\+Gradient $>$ $>$ \&phi\+\_\+corrected)
\item 
void \hyperlink{classcarl_1_1assemble__coupling__matrices_a27ee998dbd1a87b1ce4d1e9c9e515e43}{get\+\_\+lambdas} (const unsigned int dim, const lib\+Mesh\+::\+F\+E\+Type \&fe\+\_\+t, const lib\+Mesh\+::\+Elem $\ast$base\+\_\+elem, const std\+::vector$<$ lib\+Mesh\+::\+Point $>$ \&phys\+\_\+points, std\+::vector$<$ lib\+Mesh\+::\+Point $>$ \&ref\+\_\+points, std\+::vector$<$ std\+::vector$<$ lib\+Mesh\+::\+Real $>$ $>$ \&lambda\+\_\+weights)
\item 
lib\+Mesh\+::\+Petsc\+Matrix$<$ lib\+Mesh\+::\+Number $>$ \& \hyperlink{classcarl_1_1assemble__coupling__matrices_aaffaa004d87b534c3122f8bdc82820a1}{get\+\_\+micro\+\_\+coupling\+\_\+matrix} (const std\+::string \&name)
\item 
lib\+Mesh\+::\+Petsc\+Matrix$<$ lib\+Mesh\+::\+Number $>$ \& \hyperlink{classcarl_1_1assemble__coupling__matrices_abfc9a6e9937e7e4ae8ec55675be18e7b}{get\+\_\+\+B\+I\+G\+\_\+coupling\+\_\+matrix} (const std\+::string \&name)
\item 
lib\+Mesh\+::\+Petsc\+Matrix$<$ lib\+Mesh\+::\+Number $>$ \& \hyperlink{classcarl_1_1assemble__coupling__matrices_af8853c49243dcd7abb0778d260cfbd6e}{get\+\_\+mediator\+\_\+coupling\+\_\+matrix} (const std\+::string \&name)
\item 
void \hyperlink{classcarl_1_1assemble__coupling__matrices_a775d91b1cca6f22f8f68e7e3b17a1f88}{print\+\_\+matrix\+\_\+micro\+\_\+info} (const std\+::string \&name)
\item 
void \hyperlink{classcarl_1_1assemble__coupling__matrices_ad96032fec0168b1e000a4e8784d65474}{print\+\_\+matrix\+\_\+\+B\+I\+G\+\_\+info} (const std\+::string \&name)
\item 
void \hyperlink{classcarl_1_1assemble__coupling__matrices_a7af032fd8eb921ad1c7bf9e4ca49ac79}{print\+\_\+matrix\+\_\+mediator\+\_\+info} (const std\+::string \&name)
\item 
void \hyperlink{classcarl_1_1assemble__coupling__matrices_ad8ae59c24fd6fe18300860f21255e9d6}{print\+\_\+matrices\+\_\+matlab} (const std\+::string \&name, const std\+::string \&output\+Root=\char`\"{}coupling\char`\"{})
\item 
void \hyperlink{classcarl_1_1assemble__coupling__matrices_a806aca42c4648a67da472798c9064585}{print\+\_\+\+P\+E\+T\+S\+C\+\_\+matrices} (const std\+::string \&name, const std\+::string \&output\+Root=\char`\"{}coupling\char`\"{})
\item 
void \hyperlink{classcarl_1_1assemble__coupling__matrices_a85dee9db3e55f42fdc51bb2408e09d1a}{use\+\_\+\+H1\+\_\+coupling} (std\+::string name)
\item 
void \hyperlink{classcarl_1_1assemble__coupling__matrices_a7640410cbb9780403d643cb8c42275f7}{use\+\_\+\+L2\+\_\+coupling} (std\+::string name)
\item 
void \hyperlink{classcarl_1_1assemble__coupling__matrices_ace985578e3743b194f9058431735d997}{prepare\+\_\+coupling\+\_\+preallocation} (lib\+Mesh\+::\+Petsc\+Matrix$<$ lib\+Mesh\+::\+Number $>$ \&coupling\+\_\+matrix, \hyperlink{classcarl_1_1lib_mesh__fe__addresses__3}{lib\+Mesh\+\_\+fe\+\_\+addresses\+\_\+3} \&row\+\_\+addresses, \hyperlink{classcarl_1_1lib_mesh__fe__addresses__3}{lib\+Mesh\+\_\+fe\+\_\+addresses\+\_\+3} \&col\+\_\+addresses, const std\+::unordered\+\_\+multimap$<$ int, int $>$ \&inter\+\_\+table)
\item 
void \hyperlink{classcarl_1_1assemble__coupling__matrices_ac8e2ab74817605feb97044d794fc04c9}{assemble\+\_\+coupling\+\_\+elasticity\+\_\+3\+D\+\_\+parallel} (const std\+::string B\+I\+G\+\_\+name, const std\+::string micro\+\_\+name, const std\+::string inter\+\_\+name, const std\+::string mediator\+\_\+name, const lib\+Mesh\+::\+Mesh\+Base \&mesh\+\_\+\+R\+\_\+\+B\+I\+G, const lib\+Mesh\+::\+Mesh\+Base \&mesh\+\_\+\+R\+\_\+micro, const std\+::unordered\+\_\+map$<$ int, std\+::pair$<$ int, int $>$ $>$ \&full\+\_\+intersection\+\_\+pairs\+\_\+map, const std\+::unordered\+\_\+map$<$ int, std\+::pair$<$ int, int $>$ $>$ \&full\+\_\+intersection\+\_\+restricted\+\_\+pairs\+\_\+map, const std\+::unordered\+\_\+map$<$ int, int $>$ \&local\+\_\+intersection\+\_\+mesh\+I\+\_\+to\+\_\+inter\+\_\+map, const std\+::unordered\+\_\+multimap$<$ int, int $>$ \&inter\+\_\+table\+\_\+mediator\+\_\+\+B\+I\+G, const std\+::unordered\+\_\+multimap$<$ int, int $>$ \&inter\+\_\+table\+\_\+mediator\+\_\+micro, const std\+::string B\+I\+G\+\_\+type=\char`\"{}Elasticity\char`\"{}, const std\+::string micro\+\_\+type=\char`\"{}Elasticity\char`\"{}, bool b\+Same\+Elems\+Type=true)
\item 
void \hyperlink{classcarl_1_1assemble__coupling__matrices_ae3a145dae0e2d3f49b49da8c6d382f97}{check\+\_\+coupling\+\_\+construction\+\_\+3\+D\+\_\+parallel} (const std\+::string B\+I\+G\+\_\+name, const std\+::string micro\+\_\+name, const std\+::string inter\+\_\+name, const std\+::string mediator\+\_\+name, const lib\+Mesh\+::\+Mesh\+Base \&mesh\+\_\+\+R\+\_\+\+B\+I\+G, const lib\+Mesh\+::\+Mesh\+Base \&mesh\+\_\+\+R\+\_\+micro, const std\+::unordered\+\_\+map$<$ int, std\+::pair$<$ int, int $>$ $>$ \&full\+\_\+intersection\+\_\+pairs\+\_\+map, const std\+::unordered\+\_\+map$<$ int, std\+::pair$<$ int, int $>$ $>$ \&full\+\_\+intersection\+\_\+restricted\+\_\+pairs\+\_\+map, const std\+::unordered\+\_\+map$<$ int, int $>$ \&local\+\_\+intersection\+\_\+mesh\+I\+\_\+to\+\_\+inter\+\_\+map, const std\+::unordered\+\_\+multimap$<$ int, int $>$ \&inter\+\_\+table\+\_\+mediator\+\_\+\+B\+I\+G, const std\+::unordered\+\_\+multimap$<$ int, int $>$ \&inter\+\_\+table\+\_\+mediator\+\_\+micro, const std\+::string B\+I\+G\+\_\+type=\char`\"{}Elasticity\char`\"{}, const std\+::string micro\+\_\+type=\char`\"{}Elasticity\char`\"{}, bool b\+Same\+Elems\+Type=true)
\end{DoxyCompactItemize}
\subsection*{Protected Types}
\begin{DoxyCompactItemize}
\item 
typedef std\+::map$<$ std\+::string, lib\+Mesh\+::\+Equation\+Systems $\ast$ $>$\+::iterator \hyperlink{classcarl_1_1assemble__coupling__matrices_a2c14330f6dd8399037d78458bb27b4f4}{Eq\+System\+\_\+iterator}
\item 
typedef std\+::map$<$ std\+::string, lib\+Mesh\+::\+Petsc\+Matrix$<$ lib\+Mesh\+::\+Number $>$ $\ast$ $>$\+::iterator \hyperlink{classcarl_1_1assemble__coupling__matrices_a14c35d63e9e2980a32a6255ca963ab09}{Matrix\+\_\+iterator}
\item 
typedef std\+::map$<$ std\+::string, lib\+Mesh\+::\+Petsc\+Vector$<$ lib\+Mesh\+::\+Number $>$ $\ast$ $>$\+::iterator \hyperlink{classcarl_1_1assemble__coupling__matrices_a3d5b883bf64512930c7e6efcad06c60d}{Vector\+\_\+iterator}
\end{DoxyCompactItemize}
\subsection*{Protected Attributes}
\begin{DoxyCompactItemize}
\item 
const lib\+Mesh\+::\+Parallel\+::\+Communicator $\ast$ \hyperlink{classcarl_1_1assemble__coupling__matrices_a8a2164781f1a5f75ab1a5c7c4744f2f4}{m\+\_\+comm}
\item 
std\+::pair$<$ std\+::string, lib\+Mesh\+::\+Equation\+Systems $\ast$ $>$ \hyperlink{classcarl_1_1assemble__coupling__matrices_a74638b62015299b30afb23168b141429}{m\+\_\+\+B\+I\+G\+\_\+\+Equation\+System}
\item 
std\+::pair$<$ std\+::string, lib\+Mesh\+::\+Equation\+Systems $\ast$ $>$ \hyperlink{classcarl_1_1assemble__coupling__matrices_ac8e2172182aa563e854e7b693344b301}{m\+\_\+\+R\+\_\+\+B\+I\+G\+\_\+\+Equation\+System}
\item 
std\+::map$<$ std\+::string, lib\+Mesh\+::\+Equation\+Systems $\ast$ $>$ \hyperlink{classcarl_1_1assemble__coupling__matrices_a13fddbcb853df9b7ce1a99062fb9f8b6}{m\+\_\+micro\+\_\+\+Equation\+System\+Map}
\item 
std\+::map$<$ std\+::string, lib\+Mesh\+::\+Equation\+Systems $\ast$ $>$ \hyperlink{classcarl_1_1assemble__coupling__matrices_a5b7c4f9307a9611926dc1ccf8bb33d4b}{m\+\_\+\+R\+\_\+micro\+\_\+\+Equation\+System\+Map}
\item 
std\+::map$<$ std\+::string, lib\+Mesh\+::\+Equation\+Systems $\ast$ $>$ \hyperlink{classcarl_1_1assemble__coupling__matrices_a6c9fab72397ed371acccbf88fd72665f}{m\+\_\+inter\+\_\+\+Equation\+System\+Map}
\item 
std\+::map$<$ std\+::string, lib\+Mesh\+::\+Equation\+Systems $\ast$ $>$ \hyperlink{classcarl_1_1assemble__coupling__matrices_a9d61d2378c5658d6cfc7fa0d2ef306a5}{m\+\_\+mediator\+\_\+\+Equation\+System\+Map}
\item 
std\+::map$<$ std\+::string, lib\+Mesh\+::\+Petsc\+Matrix$<$ lib\+Mesh\+::\+Number $>$ $\ast$ $>$ \hyperlink{classcarl_1_1assemble__coupling__matrices_a73accf79c46d9ceab7f66f0e26c5e677}{m\+\_\+coupling\+Matrix\+Map\+\_\+mediator\+\_\+micro}
\item 
std\+::map$<$ std\+::string, lib\+Mesh\+::\+Petsc\+Matrix$<$ lib\+Mesh\+::\+Number $>$ $\ast$ $>$ \hyperlink{classcarl_1_1assemble__coupling__matrices_af8127910d360a01b1b9c9878f03282f4}{m\+\_\+coupling\+Matrix\+Map\+\_\+mediator\+\_\+\+B\+I\+G}
\item 
std\+::map$<$ std\+::string, lib\+Mesh\+::\+Petsc\+Matrix$<$ lib\+Mesh\+::\+Number $>$ $\ast$ $>$ \hyperlink{classcarl_1_1assemble__coupling__matrices_a1a838735ff335cdf1d24403ceab3b896}{m\+\_\+coupling\+Matrix\+Map\+\_\+mediator\+\_\+mediator}
\item 
std\+::map$<$ std\+::string, bool $>$ \hyperlink{classcarl_1_1assemble__coupling__matrices_a9e3bf058bd10aacb63ebbab34fe37628}{m\+\_\+b\+Use\+H1\+Coupling}
\item 
std\+::map$<$ std\+::string, bool $>$ \hyperlink{classcarl_1_1assemble__coupling__matrices_a84f7dc1f435eabc152f0df50d7650269}{m\+\_\+b\+Has\+Assembled\+\_\+micro}
\item 
bool \hyperlink{classcarl_1_1assemble__coupling__matrices_a3fa42a0aa231b0feaa3b27a6f0fb11e1}{m\+\_\+b\+Has\+Assembled\+\_\+\+B\+I\+G}
\item 
bool \hyperlink{classcarl_1_1assemble__coupling__matrices_a96baf5080d2887764b52d64d56dffce2}{m\+\_\+b\+Use\+Null\+Space\+\_\+\+B\+I\+G}
\item 
bool \hyperlink{classcarl_1_1assemble__coupling__matrices_aaed7135f088376664521b650c2b25fbd}{m\+\_\+b\+Has\+Defined\+Mesh\+Restrictions}
\item 
std\+::map$<$ std\+::string, double $>$ \hyperlink{classcarl_1_1assemble__coupling__matrices_a2133e2d98a47de9569137f31d69c58ee}{m\+\_\+coupling\+\_\+rigidity\+Map}
\item 
std\+::map$<$ std\+::string, double $>$ \hyperlink{classcarl_1_1assemble__coupling__matrices_a72f1024c5634b4e31b8583ee60bb14bc}{m\+\_\+coupling\+\_\+width\+Map}
\end{DoxyCompactItemize}


\subsection{Detailed Description}


Definition at line 246 of file assemble\+\_\+coupling.\+h.



\subsection{Member Typedef Documentation}
\hypertarget{classcarl_1_1assemble__coupling__matrices_a2c14330f6dd8399037d78458bb27b4f4}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!Eq\+System\+\_\+iterator@{Eq\+System\+\_\+iterator}}
\index{Eq\+System\+\_\+iterator@{Eq\+System\+\_\+iterator}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{Eq\+System\+\_\+iterator}]{\setlength{\rightskip}{0pt plus 5cm}typedef std\+::map$<$std\+::string, lib\+Mesh\+::\+Equation\+Systems$\ast$$>$\+::iterator {\bf carl\+::assemble\+\_\+coupling\+\_\+matrices\+::\+Eq\+System\+\_\+iterator}\hspace{0.3cm}{\ttfamily [protected]}}\label{classcarl_1_1assemble__coupling__matrices_a2c14330f6dd8399037d78458bb27b4f4}


Definition at line 281 of file assemble\+\_\+coupling.\+h.

\hypertarget{classcarl_1_1assemble__coupling__matrices_a14c35d63e9e2980a32a6255ca963ab09}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!Matrix\+\_\+iterator@{Matrix\+\_\+iterator}}
\index{Matrix\+\_\+iterator@{Matrix\+\_\+iterator}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{Matrix\+\_\+iterator}]{\setlength{\rightskip}{0pt plus 5cm}typedef std\+::map$<$std\+::string, lib\+Mesh\+::\+Petsc\+Matrix$<$lib\+Mesh\+::\+Number$>$$\ast$$>$\+::iterator {\bf carl\+::assemble\+\_\+coupling\+\_\+matrices\+::\+Matrix\+\_\+iterator}\hspace{0.3cm}{\ttfamily [protected]}}\label{classcarl_1_1assemble__coupling__matrices_a14c35d63e9e2980a32a6255ca963ab09}


Definition at line 282 of file assemble\+\_\+coupling.\+h.

\hypertarget{classcarl_1_1assemble__coupling__matrices_a3d5b883bf64512930c7e6efcad06c60d}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!Vector\+\_\+iterator@{Vector\+\_\+iterator}}
\index{Vector\+\_\+iterator@{Vector\+\_\+iterator}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{Vector\+\_\+iterator}]{\setlength{\rightskip}{0pt plus 5cm}typedef std\+::map$<$std\+::string, lib\+Mesh\+::\+Petsc\+Vector$<$lib\+Mesh\+::\+Number$>$$\ast$$>$\+::iterator {\bf carl\+::assemble\+\_\+coupling\+\_\+matrices\+::\+Vector\+\_\+iterator}\hspace{0.3cm}{\ttfamily [protected]}}\label{classcarl_1_1assemble__coupling__matrices_a3d5b883bf64512930c7e6efcad06c60d}


Definition at line 283 of file assemble\+\_\+coupling.\+h.



\subsection{Constructor \& Destructor Documentation}
\hypertarget{classcarl_1_1assemble__coupling__matrices_a241a34bd5cc9b968f1d3d5d1ed7b5b0c}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!assemble\+\_\+coupling\+\_\+matrices@{assemble\+\_\+coupling\+\_\+matrices}}
\index{assemble\+\_\+coupling\+\_\+matrices@{assemble\+\_\+coupling\+\_\+matrices}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{assemble\+\_\+coupling\+\_\+matrices(const lib\+Mesh\+::\+Parallel\+::\+Communicator \&comm)}]{\setlength{\rightskip}{0pt plus 5cm}carl\+::assemble\+\_\+coupling\+\_\+matrices\+::assemble\+\_\+coupling\+\_\+matrices (
\begin{DoxyParamCaption}
\item[{const lib\+Mesh\+::\+Parallel\+::\+Communicator \&}]{comm}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}\label{classcarl_1_1assemble__coupling__matrices_a241a34bd5cc9b968f1d3d5d1ed7b5b0c}


Definition at line 292 of file assemble\+\_\+coupling.\+h.


\begin{DoxyCode}
292                                                                         :
293             \hyperlink{classcarl_1_1assemble__coupling__matrices_a8a2164781f1a5f75ab1a5c7c4744f2f4}{m\_comm} \{ &comm \},
294             \hyperlink{classcarl_1_1assemble__coupling__matrices_a3fa42a0aa231b0feaa3b27a6f0fb11e1}{m\_bHasAssembled\_BIG} \{ \textcolor{keyword}{false} \},
295             \hyperlink{classcarl_1_1assemble__coupling__matrices_aaed7135f088376664521b650c2b25fbd}{m\_bHasDefinedMeshRestrictions} \{ \textcolor{keyword}{false} \}
296     \{
297     \};
\end{DoxyCode}
\hypertarget{classcarl_1_1assemble__coupling__matrices_a0a9d43d2af319a9065e720d73b87190f}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!````~assemble\+\_\+coupling\+\_\+matrices@{$\sim$assemble\+\_\+coupling\+\_\+matrices}}
\index{````~assemble\+\_\+coupling\+\_\+matrices@{$\sim$assemble\+\_\+coupling\+\_\+matrices}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{$\sim$assemble\+\_\+coupling\+\_\+matrices()}]{\setlength{\rightskip}{0pt plus 5cm}carl\+::assemble\+\_\+coupling\+\_\+matrices\+::$\sim$assemble\+\_\+coupling\+\_\+matrices (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}\label{classcarl_1_1assemble__coupling__matrices_a0a9d43d2af319a9065e720d73b87190f}


Definition at line 300 of file assemble\+\_\+coupling.\+h.


\begin{DoxyCode}
301     \{
302         this->\hyperlink{classcarl_1_1assemble__coupling__matrices_a3b3020dd40cd78050744b35f9515b4d8}{clear}();
303     \}
\end{DoxyCode}


\subsection{Member Function Documentation}
\hypertarget{classcarl_1_1assemble__coupling__matrices_a837d8dd37af967adb11fd969660aff92}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!add\+\_\+inter\+\_\+\+Equation\+System@{add\+\_\+inter\+\_\+\+Equation\+System}}
\index{add\+\_\+inter\+\_\+\+Equation\+System@{add\+\_\+inter\+\_\+\+Equation\+System}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{add\+\_\+inter\+\_\+\+Equation\+System(const std\+::string \&name, lib\+Mesh\+::\+Mesh\+Base \&inter\+Mesh)}]{\setlength{\rightskip}{0pt plus 5cm}lib\+Mesh\+::\+Equation\+Systems \& carl\+::assemble\+\_\+coupling\+\_\+matrices\+::add\+\_\+inter\+\_\+\+Equation\+System (
\begin{DoxyParamCaption}
\item[{const std\+::string \&}]{name, }
\item[{lib\+Mesh\+::\+Mesh\+Base \&}]{inter\+Mesh}
\end{DoxyParamCaption}
)}\label{classcarl_1_1assemble__coupling__matrices_a837d8dd37af967adb11fd969660aff92}


Definition at line 157 of file assemble\+\_\+coupling.\+cpp.


\begin{DoxyCode}
159     \{
160         libMesh::EquationSystems* EqSystemPtr = NULL;
161 
162         \textcolor{keywordflow}{if} (!\hyperlink{classcarl_1_1assemble__coupling__matrices_a6c9fab72397ed371acccbf88fd72665f}{m\_inter\_EquationSystemMap}.count(name))
163         \{
164             \textcolor{comment}{// Then add a new system}
165             EqSystemPtr = \textcolor{keyword}{new} libMesh::EquationSystems(interMesh);
166             \hyperlink{classcarl_1_1assemble__coupling__matrices_a6c9fab72397ed371acccbf88fd72665f}{m\_inter\_EquationSystemMap}.insert(std::make\_pair(name, EqSystemPtr));
167         \}
168         \textcolor{keywordflow}{else}
169         \{
170             \textcolor{comment}{// System already exits, return the system pointer}
171             std::cerr << \textcolor{stringliteral}{" *** Warning: inter system "} << name
172                     << \textcolor{stringliteral}{" already exists!"} << std::endl;
173             EqSystemPtr = \hyperlink{classcarl_1_1assemble__coupling__matrices_a6c9fab72397ed371acccbf88fd72665f}{m\_inter\_EquationSystemMap}[name];
174         \}
175 
176         \textcolor{keywordflow}{return} *EqSystemPtr;
177     \};
\end{DoxyCode}
\hypertarget{classcarl_1_1assemble__coupling__matrices_a48de3bdb72c2b94ef7667b9288487d1b}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!add\+\_\+mediator\+\_\+\+Equation\+System@{add\+\_\+mediator\+\_\+\+Equation\+System}}
\index{add\+\_\+mediator\+\_\+\+Equation\+System@{add\+\_\+mediator\+\_\+\+Equation\+System}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{add\+\_\+mediator\+\_\+\+Equation\+System(const std\+::string \&name, lib\+Mesh\+::\+Mesh\+Base \&mediator\+Mesh)}]{\setlength{\rightskip}{0pt plus 5cm}lib\+Mesh\+::\+Equation\+Systems \& carl\+::assemble\+\_\+coupling\+\_\+matrices\+::add\+\_\+mediator\+\_\+\+Equation\+System (
\begin{DoxyParamCaption}
\item[{const std\+::string \&}]{name, }
\item[{lib\+Mesh\+::\+Mesh\+Base \&}]{mediator\+Mesh}
\end{DoxyParamCaption}
)}\label{classcarl_1_1assemble__coupling__matrices_a48de3bdb72c2b94ef7667b9288487d1b}


Definition at line 179 of file assemble\+\_\+coupling.\+cpp.


\begin{DoxyCode}
181     \{
182         libMesh::EquationSystems* EqSystemPtr = NULL;
183 
184         \textcolor{keywordflow}{if} (!\hyperlink{classcarl_1_1assemble__coupling__matrices_a9d61d2378c5658d6cfc7fa0d2ef306a5}{m\_mediator\_EquationSystemMap}.count(name))
185         \{
186             \textcolor{comment}{// Then add a new system}
187             EqSystemPtr = \textcolor{keyword}{new} libMesh::EquationSystems(mediatorMesh);
188             \hyperlink{classcarl_1_1assemble__coupling__matrices_a9d61d2378c5658d6cfc7fa0d2ef306a5}{m\_mediator\_EquationSystemMap}.insert(
189                     std::make\_pair(name, EqSystemPtr));
190         \}
191         \textcolor{keywordflow}{else}
192         \{
193             \textcolor{comment}{// System already exits, return the system pointer}
194             std::cerr << \textcolor{stringliteral}{" *** Warning: mediator system "} << name
195                     << \textcolor{stringliteral}{" already exists!"} << std::endl;
196             EqSystemPtr = \hyperlink{classcarl_1_1assemble__coupling__matrices_a9d61d2378c5658d6cfc7fa0d2ef306a5}{m\_mediator\_EquationSystemMap}[name];
197         \}
198 
199         \textcolor{keywordflow}{return} *EqSystemPtr;
200     \};
\end{DoxyCode}
\hypertarget{classcarl_1_1assemble__coupling__matrices_a9ce9e893a73b9daaa7e7a419981495cc}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!add\+\_\+micro\+\_\+\+Equation\+System@{add\+\_\+micro\+\_\+\+Equation\+System}}
\index{add\+\_\+micro\+\_\+\+Equation\+System@{add\+\_\+micro\+\_\+\+Equation\+System}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{add\+\_\+micro\+\_\+\+Equation\+System(const std\+::string \&name, lib\+Mesh\+::\+Mesh\+Base \&micro\+Mesh)}]{\setlength{\rightskip}{0pt plus 5cm}template$<$typename lib\+Mesh\+\_\+\+Matrix\+Type $>$ lib\+Mesh\+::\+Equation\+Systems\& carl\+::assemble\+\_\+coupling\+\_\+matrices\+::add\+\_\+micro\+\_\+\+Equation\+System (
\begin{DoxyParamCaption}
\item[{const std\+::string \&}]{name, }
\item[{lib\+Mesh\+::\+Mesh\+Base \&}]{micro\+Mesh}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}\label{classcarl_1_1assemble__coupling__matrices_a9ce9e893a73b9daaa7e7a419981495cc}


Definition at line 316 of file assemble\+\_\+coupling.\+h.


\begin{DoxyCode}
318     \{
319         libMesh::EquationSystems* EqSystemPtr = NULL;
320         libMesh::PetscMatrix<libMesh::Number>* Matrix\_mediator\_micro\_Ptr = NULL;
321         libMesh::PetscMatrix<libMesh::Number>* Matrix\_mediator\_BIG\_Ptr = NULL;
322         libMesh::PetscMatrix<libMesh::Number>* Matrix\_mediator\_mediator\_Ptr =
323         NULL;
324 
325         \textcolor{keywordflow}{if} (!\hyperlink{classcarl_1_1assemble__coupling__matrices_a13fddbcb853df9b7ce1a99062fb9f8b6}{m\_micro\_EquationSystemMap}.count(name))
326         \{
327             \textcolor{comment}{// Then add a new system}
328             EqSystemPtr = \textcolor{keyword}{new} libMesh::EquationSystems(microMesh);
329 
330             Matrix\_mediator\_micro\_Ptr = \textcolor{keyword}{new} libMesh\_MatrixType(
331                     microMesh.comm());
332             Matrix\_mediator\_BIG\_Ptr = \textcolor{keyword}{new} libMesh\_MatrixType(microMesh.comm());
333             Matrix\_mediator\_mediator\_Ptr = \textcolor{keyword}{new} libMesh\_MatrixType(
334                     microMesh.comm());
335 
336             \hyperlink{classcarl_1_1assemble__coupling__matrices_a13fddbcb853df9b7ce1a99062fb9f8b6}{m\_micro\_EquationSystemMap}.insert(std::make\_pair(name, EqSystemPtr));
337             \hyperlink{classcarl_1_1assemble__coupling__matrices_a73accf79c46d9ceab7f66f0e26c5e677}{m\_couplingMatrixMap\_mediator\_micro}.insert(
338                     std::make\_pair(name, Matrix\_mediator\_micro\_Ptr));
339 
340             \hyperlink{classcarl_1_1assemble__coupling__matrices_af8127910d360a01b1b9c9878f03282f4}{m\_couplingMatrixMap\_mediator\_BIG}.insert(
341                     std::make\_pair(name, Matrix\_mediator\_BIG\_Ptr));
342 
343             \hyperlink{classcarl_1_1assemble__coupling__matrices_a1a838735ff335cdf1d24403ceab3b896}{m\_couplingMatrixMap\_mediator\_mediator}.insert(
344                     std::make\_pair(name, Matrix\_mediator\_mediator\_Ptr));
345 
346             \hyperlink{classcarl_1_1assemble__coupling__matrices_a84f7dc1f435eabc152f0df50d7650269}{m\_bHasAssembled\_micro}.insert(std::make\_pair(name, \textcolor{keyword}{false}));
347             \hyperlink{classcarl_1_1assemble__coupling__matrices_a9e3bf058bd10aacb63ebbab34fe37628}{m\_bUseH1Coupling}.insert(std::make\_pair(name, \textcolor{keyword}{false}));
348         \}
349         \textcolor{keywordflow}{else}
350         \{
351             \textcolor{comment}{// System already exits, return the system pointer}
352             std::cerr << \textcolor{stringliteral}{" *** Warning: micro system "} << name
353                     << \textcolor{stringliteral}{" already exists!"} << std::endl;
354             EqSystemPtr = \hyperlink{classcarl_1_1assemble__coupling__matrices_a13fddbcb853df9b7ce1a99062fb9f8b6}{m\_micro\_EquationSystemMap}[name];
355         \}
356 
357         \textcolor{keywordflow}{return} *EqSystemPtr;
358     \}
\end{DoxyCode}
\hypertarget{classcarl_1_1assemble__coupling__matrices_a94097d94bf9d2cb279fa062acaa1cb11}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!add\+\_\+\+Restricted\+\_\+micro\+\_\+\+Equation\+System@{add\+\_\+\+Restricted\+\_\+micro\+\_\+\+Equation\+System}}
\index{add\+\_\+\+Restricted\+\_\+micro\+\_\+\+Equation\+System@{add\+\_\+\+Restricted\+\_\+micro\+\_\+\+Equation\+System}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{add\+\_\+\+Restricted\+\_\+micro\+\_\+\+Equation\+System(const std\+::string \&name, lib\+Mesh\+::\+Mesh\+Base \&\+R\+\_\+micro\+Mesh)}]{\setlength{\rightskip}{0pt plus 5cm}lib\+Mesh\+::\+Equation\+Systems \& carl\+::assemble\+\_\+coupling\+\_\+matrices\+::add\+\_\+\+Restricted\+\_\+micro\+\_\+\+Equation\+System (
\begin{DoxyParamCaption}
\item[{const std\+::string \&}]{name, }
\item[{lib\+Mesh\+::\+Mesh\+Base \&}]{R\+\_\+micro\+Mesh}
\end{DoxyParamCaption}
)}\label{classcarl_1_1assemble__coupling__matrices_a94097d94bf9d2cb279fa062acaa1cb11}


Definition at line 132 of file assemble\+\_\+coupling.\+cpp.


\begin{DoxyCode}
134     \{
135         \hyperlink{classcarl_1_1assemble__coupling__matrices_aaed7135f088376664521b650c2b25fbd}{m\_bHasDefinedMeshRestrictions} = \textcolor{keyword}{true};
136 
137         libMesh::EquationSystems* EqSystemPtr = NULL;
138 
139         \textcolor{keywordflow}{if} (!\hyperlink{classcarl_1_1assemble__coupling__matrices_a5b7c4f9307a9611926dc1ccf8bb33d4b}{m\_R\_micro\_EquationSystemMap}.count(name))
140         \{
141             \textcolor{comment}{// Then add a new system}
142             EqSystemPtr = \textcolor{keyword}{new} libMesh::EquationSystems(R\_microMesh);
143 
144             \hyperlink{classcarl_1_1assemble__coupling__matrices_a5b7c4f9307a9611926dc1ccf8bb33d4b}{m\_R\_micro\_EquationSystemMap}.insert(std::make\_pair(name, EqSystemPtr)
      );
145         \}
146         \textcolor{keywordflow}{else}
147         \{
148             \textcolor{comment}{// System already exits, return the system pointer}
149             std::cerr << \textcolor{stringliteral}{" *** Warning: restricted micro system "} << name
150                     << \textcolor{stringliteral}{" already exists!"} << std::endl;
151             EqSystemPtr = \hyperlink{classcarl_1_1assemble__coupling__matrices_a13fddbcb853df9b7ce1a99062fb9f8b6}{m\_micro\_EquationSystemMap}[name];
152         \}
153 
154         \textcolor{keywordflow}{return} *EqSystemPtr;
155     \};
\end{DoxyCode}
\hypertarget{classcarl_1_1assemble__coupling__matrices_ac8e2ab74817605feb97044d794fc04c9}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!assemble\+\_\+coupling\+\_\+elasticity\+\_\+3\+D\+\_\+parallel@{assemble\+\_\+coupling\+\_\+elasticity\+\_\+3\+D\+\_\+parallel}}
\index{assemble\+\_\+coupling\+\_\+elasticity\+\_\+3\+D\+\_\+parallel@{assemble\+\_\+coupling\+\_\+elasticity\+\_\+3\+D\+\_\+parallel}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{assemble\+\_\+coupling\+\_\+elasticity\+\_\+3\+D\+\_\+parallel(const std\+::string B\+I\+G\+\_\+name, const std\+::string micro\+\_\+name, const std\+::string inter\+\_\+name, const std\+::string mediator\+\_\+name, const lib\+Mesh\+::\+Mesh\+Base \&mesh\+\_\+\+R\+\_\+\+B\+I\+G, const lib\+Mesh\+::\+Mesh\+Base \&mesh\+\_\+\+R\+\_\+micro, const std\+::unordered\+\_\+map$<$ int, std\+::pair$<$ int, int $>$ $>$ \&full\+\_\+intersection\+\_\+pairs\+\_\+map, const std\+::unordered\+\_\+map$<$ int, std\+::pair$<$ int, int $>$ $>$ \&full\+\_\+intersection\+\_\+restricted\+\_\+pairs\+\_\+map, const std\+::unordered\+\_\+map$<$ int, int $>$ \&local\+\_\+intersection\+\_\+mesh\+I\+\_\+to\+\_\+inter\+\_\+map, const std\+::unordered\+\_\+multimap$<$ int, int $>$ \&inter\+\_\+table\+\_\+mediator\+\_\+\+B\+I\+G, const std\+::unordered\+\_\+multimap$<$ int, int $>$ \&inter\+\_\+table\+\_\+mediator\+\_\+micro, const std\+::string B\+I\+G\+\_\+type=""Elasticity"", const std\+::string micro\+\_\+type=""Elasticity"", bool b\+Same\+Elems\+Type=true)}]{\setlength{\rightskip}{0pt plus 5cm}void carl\+::assemble\+\_\+coupling\+\_\+matrices\+::assemble\+\_\+coupling\+\_\+elasticity\+\_\+3\+D\+\_\+parallel (
\begin{DoxyParamCaption}
\item[{const std\+::string}]{B\+I\+G\+\_\+name, }
\item[{const std\+::string}]{micro\+\_\+name, }
\item[{const std\+::string}]{inter\+\_\+name, }
\item[{const std\+::string}]{mediator\+\_\+name, }
\item[{const lib\+Mesh\+::\+Mesh\+Base \&}]{mesh\+\_\+\+R\+\_\+\+B\+I\+G, }
\item[{const lib\+Mesh\+::\+Mesh\+Base \&}]{mesh\+\_\+\+R\+\_\+micro, }
\item[{const std\+::unordered\+\_\+map$<$ int, std\+::pair$<$ int, int $>$ $>$ \&}]{full\+\_\+intersection\+\_\+pairs\+\_\+map, }
\item[{const std\+::unordered\+\_\+map$<$ int, std\+::pair$<$ int, int $>$ $>$ \&}]{full\+\_\+intersection\+\_\+restricted\+\_\+pairs\+\_\+map, }
\item[{const std\+::unordered\+\_\+map$<$ int, int $>$ \&}]{local\+\_\+intersection\+\_\+mesh\+I\+\_\+to\+\_\+inter\+\_\+map, }
\item[{const std\+::unordered\+\_\+multimap$<$ int, int $>$ \&}]{inter\+\_\+table\+\_\+mediator\+\_\+\+B\+I\+G, }
\item[{const std\+::unordered\+\_\+multimap$<$ int, int $>$ \&}]{inter\+\_\+table\+\_\+mediator\+\_\+micro, }
\item[{const std\+::string}]{B\+I\+G\+\_\+type = {\ttfamily \char`\"{}Elasticity\char`\"{}}, }
\item[{const std\+::string}]{micro\+\_\+type = {\ttfamily \char`\"{}Elasticity\char`\"{}}, }
\item[{bool}]{b\+Same\+Elems\+Type = {\ttfamily true}}
\end{DoxyParamCaption}
)}\label{classcarl_1_1assemble__coupling__matrices_ac8e2ab74817605feb97044d794fc04c9}


Definition at line 183 of file assemble\+\_\+functions\+\_\+coupling.\+cpp.


\begin{DoxyCode}
204     \{
205         \textcolor{comment}{// TODO : make it possible to invert the algorithm's systems!}
206         \textcolor{comment}{// Addresses to the eq. systems}
207         libMesh::EquationSystems& mediator\_eq\_system =
208                 *\hyperlink{classcarl_1_1assemble__coupling__matrices_a9d61d2378c5658d6cfc7fa0d2ef306a5}{m\_mediator\_EquationSystemMap}[mediator\_name];
209         libMesh::EquationSystems& BIG\_eq\_system =
210                 *\hyperlink{classcarl_1_1assemble__coupling__matrices_a74638b62015299b30afb23168b141429}{m\_BIG\_EquationSystem}.second;
211         libMesh::EquationSystems& micro\_eq\_system =
212                 *\hyperlink{classcarl_1_1assemble__coupling__matrices_a13fddbcb853df9b7ce1a99062fb9f8b6}{m\_micro\_EquationSystemMap}[micro\_name];
213         libMesh::EquationSystems& inter\_eq\_system =
214                 *\hyperlink{classcarl_1_1assemble__coupling__matrices_a6c9fab72397ed371acccbf88fd72665f}{m\_inter\_EquationSystemMap}[inter\_name];
215 
216         libMesh::EquationSystems& R\_BIG\_eq\_system =
217                 *\hyperlink{classcarl_1_1assemble__coupling__matrices_ac8e2172182aa563e854e7b693344b301}{m\_R\_BIG\_EquationSystem}.second;
218         libMesh::EquationSystems& R\_micro\_eq\_system =
219                 *\hyperlink{classcarl_1_1assemble__coupling__matrices_a5b7c4f9307a9611926dc1ccf8bb33d4b}{m\_R\_micro\_EquationSystemMap}[micro\_name];
220 
221         \textcolor{comment}{// First, test if all the systems have an elasticity model and variable set}
222         \hyperlink{common__header_8h_a593ccc80b790b2268653fcf6597bf451}{homemade\_assert\_msg}(micro\_eq\_system.has\_system(micro\_type),
223                 \textcolor{stringliteral}{" Micro equation systems is missing a system type!"});
224         \hyperlink{common__header_8h_a593ccc80b790b2268653fcf6597bf451}{homemade\_assert\_msg}(BIG\_eq\_system.has\_system(BIG\_type),
225                 \textcolor{stringliteral}{" Macro equation systems is missing a system type!"});
226         \hyperlink{common__header_8h_a593ccc80b790b2268653fcf6597bf451}{homemade\_assert\_msg}(R\_micro\_eq\_system.has\_system(\textcolor{stringliteral}{"Elasticity"}),
227                 \textcolor{stringliteral}{" Restricted micro equation systems missing \(\backslash\)"Elasticity\(\backslash\)" system!"});
228         \hyperlink{common__header_8h_a593ccc80b790b2268653fcf6597bf451}{homemade\_assert\_msg}(R\_BIG\_eq\_system.has\_system(\textcolor{stringliteral}{"Elasticity"}),
229                 \textcolor{stringliteral}{" Restricted macro equation systems missing \(\backslash\)"Elasticity\(\backslash\)" system!"});
230         \hyperlink{common__header_8h_a593ccc80b790b2268653fcf6597bf451}{homemade\_assert\_msg}(inter\_eq\_system.has\_system(\textcolor{stringliteral}{"Elasticity"}),
231                 \textcolor{stringliteral}{" Intersection equation systems missing \(\backslash\)"Elasticity\(\backslash\)" system!"});
232         \hyperlink{common__header_8h_a593ccc80b790b2268653fcf6597bf451}{homemade\_assert\_msg}(mediator\_eq\_system.has\_system(\textcolor{stringliteral}{"Elasticity"}),
233                 \textcolor{stringliteral}{" Mediatored equation systems missing \(\backslash\)"Elasticity\(\backslash\)" system!"});
234 
235         \textcolor{comment}{// Systems and vars}
236         libMesh::System& volume\_mediator\_system =
237                 libMesh::cast\_ref<libMesh::System&>(mediator\_eq\_system.get\_system(\textcolor{stringliteral}{"Elasticity"}));
238 
239         libMesh::System& volume\_BIG\_system =
240                 libMesh::cast\_ref<libMesh::System&>(BIG\_eq\_system.get\_system<libMesh::ExplicitSystem>(
      BIG\_type));
241 
242         libMesh::System& volume\_micro\_system =
243                 libMesh::cast\_ref<libMesh::System&>(micro\_eq\_system.get\_system<libMesh::ExplicitSystem>(
      micro\_type));
244 
245         libMesh::System& volume\_inter\_system =
246                 inter\_eq\_system.get\_system<libMesh::ExplicitSystem>(\textcolor{stringliteral}{"Elasticity"});
247 
248         libMesh::System& volume\_R\_BIG\_system =
249                 R\_BIG\_eq\_system.get\_system<libMesh::ExplicitSystem>(\textcolor{stringliteral}{"Elasticity"});
250 
251         libMesh::System& volume\_R\_micro\_system =
252                 R\_micro\_eq\_system.get\_system<libMesh::ExplicitSystem>(\textcolor{stringliteral}{"Elasticity"});
253 
254         libMesh\_fe\_addresses\_3 mediator\_addresses(volume\_mediator\_system);
255         libMesh\_fe\_addresses\_3 BIG\_addresses(volume\_BIG\_system);
256         libMesh\_fe\_addresses\_3 micro\_addresses(volume\_micro\_system);
257         libMesh\_fe\_addresses\_3 inter\_addresses(volume\_inter\_system);
258 
259         libMesh\_fe\_addresses\_3 R\_BIG\_addresses(volume\_R\_BIG\_system);
260         libMesh\_fe\_addresses\_3 R\_micro\_addresses(volume\_R\_micro\_system);
261 
262         \textcolor{comment}{// Vector that will keep the quadrature points}
263         \textcolor{keyword}{const} std::vector<libMesh::Point>& quad\_points\_inter =
264                 inter\_addresses.fe\_unique\_ptr->get\_xyz();
265         std::vector<libMesh::Point> quad\_points\_reference;
266 
267         \textcolor{comment}{// Jacobians}
268         \textcolor{keyword}{const} std::vector<libMesh::Real>& JxW =
269                 inter\_addresses.fe\_unique\_ptr->get\_JxW();
270 
271         \textcolor{comment}{// Shape functions}
272         \textcolor{keyword}{const} std::vector<std::vector<libMesh::Real> >& phi\_inter =
273                 inter\_addresses.fe\_unique\_ptr->get\_phi();
274         std::vector<std::vector<libMesh::Real> > corrected\_phi\_R\_BIG;
275         std::vector<std::vector<libMesh::Real> > corrected\_phi\_R\_micro;
276         std::vector<std::vector<libMesh::Real> > corrected\_phi\_mediator;
277 
278         \textcolor{comment}{// Shape functions gradients}
279         \textcolor{keyword}{const} std::vector<std::vector<libMesh::RealGradient> >& dphi\_inter =
280                 inter\_addresses.fe\_unique\_ptr->get\_dphi();
281         std::vector<std::vector<libMesh::RealGradient> > corrected\_dphi\_R\_BIG;
282         std::vector<std::vector<libMesh::RealGradient> > corrected\_dphi\_R\_micro;
283         std::vector<std::vector<libMesh::RealGradient> > corrected\_dphi\_mediator;
284 
285         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} n\_quadrature\_pts = 0;
286 
287         \textcolor{comment}{// Addresses to the matrices}
288         libMesh::PetscMatrix<libMesh::Number>& couplingMatrix\_mediator\_BIG =
289                 *\hyperlink{classcarl_1_1assemble__coupling__matrices_af8127910d360a01b1b9c9878f03282f4}{m\_couplingMatrixMap\_mediator\_BIG}[micro\_name];
290         libMesh::PetscMatrix<libMesh::Number>& couplingMatrix\_mediator\_micro =
291                 *\hyperlink{classcarl_1_1assemble__coupling__matrices_a73accf79c46d9ceab7f66f0e26c5e677}{m\_couplingMatrixMap\_mediator\_micro}[micro\_name];
292         libMesh::PetscMatrix<libMesh::Number>& couplingMatrix\_mediator\_mediator =
293                 *\hyperlink{classcarl_1_1assemble__coupling__matrices_a1a838735ff335cdf1d24403ceab3b896}{m\_couplingMatrixMap\_mediator\_mediator}[micro\_name];
294 
295         \textcolor{keyword}{const} libMesh::Parallel::Communicator& WorldComm = couplingMatrix\_mediator\_micro.comm();
296 
297         \textcolor{comment}{// Values of the coupling constants}
298         \textcolor{keywordtype}{double} L2\_coupling\_const = \hyperlink{classcarl_1_1assemble__coupling__matrices_a2133e2d98a47de9569137f31d69c58ee}{m\_coupling\_rigidityMap}[micro\_name]
299                 / (\hyperlink{classcarl_1_1assemble__coupling__matrices_a72f1024c5634b4e31b8583ee60bb14bc}{m\_coupling\_widthMap}[micro\_name]
300                         * \hyperlink{classcarl_1_1assemble__coupling__matrices_a72f1024c5634b4e31b8583ee60bb14bc}{m\_coupling\_widthMap}[micro\_name]);
301         \textcolor{keywordtype}{double} H1\_coupling\_const = \hyperlink{classcarl_1_1assemble__coupling__matrices_a2133e2d98a47de9569137f31d69c58ee}{m\_coupling\_rigidityMap}[micro\_name];
302 
303         \textcolor{comment}{// DoF vectors and ranges}
304         mediator\_addresses.set\_DoFs();
305         BIG\_addresses.set\_DoFs();
306         micro\_addresses.set\_DoFs();
307         inter\_addresses.set\_DoFs();
308 
309         R\_BIG\_addresses.set\_DoFs();
310         R\_micro\_addresses.set\_DoFs();
311 
312         \textcolor{comment}{// Local matrix}
313         coupling\_matrices\_3 Me\_mediator\_R\_micro;
314         coupling\_matrices\_3 Me\_mediator\_R\_BIG;
315         coupling\_matrices\_3 Me\_mediator\_mediator;
316 
317         \textcolor{comment}{//    If all elements are of the same type, do the index "extraction",}
318         \textcolor{comment}{// the matrices resizes and repositions here}
319         \textcolor{keywordflow}{if} (bSameElemsType)
320         \{
321             Me\_mediator\_R\_micro.set\_matrices(mediator\_addresses, R\_micro\_addresses);
322             Me\_mediator\_R\_BIG.set\_matrices(mediator\_addresses, R\_BIG\_addresses);
323             Me\_mediator\_mediator.set\_matrices(mediator\_addresses,
324                     mediator\_addresses);
325 
326             \textcolor{comment}{// Restart the element}
327 
328             \textcolor{keyword}{const} libMesh::Elem* elem\_inter =
329                     *inter\_addresses.mesh.active\_local\_elements\_begin();
330             inter\_addresses.fe\_unique\_ptr->reinit(elem\_inter);
331             n\_quadrature\_pts = inter\_addresses.fe\_unique\_ptr->n\_quadrature\_points();
332 
333             corrected\_phi\_R\_BIG.resize(R\_BIG\_addresses.n\_dofs\_u,
334                     std::vector<libMesh::Real>(n\_quadrature\_pts, 0));
335             corrected\_phi\_R\_micro.resize(R\_micro\_addresses.n\_dofs\_u,
336                     std::vector<libMesh::Real>(n\_quadrature\_pts, 0));
337             corrected\_phi\_mediator.resize(mediator\_addresses.n\_dofs\_u,
338                     std::vector<libMesh::Real>(n\_quadrature\_pts, 0));
339 
340             \textcolor{keywordflow}{if} (\hyperlink{classcarl_1_1assemble__coupling__matrices_a9e3bf058bd10aacb63ebbab34fe37628}{m\_bUseH1Coupling}[micro\_name])
341             \{
342                 corrected\_dphi\_R\_BIG.resize(R\_BIG\_addresses.n\_dofs\_u,
343                         std::vector<libMesh::RealGradient>(n\_quadrature\_pts));
344                 corrected\_dphi\_mediator.resize(mediator\_addresses.n\_dofs\_u,
345                         std::vector<libMesh::RealGradient>(n\_quadrature\_pts));
346                 corrected\_dphi\_R\_micro.resize(R\_micro\_addresses.n\_dofs\_u,
347                         std::vector<libMesh::RealGradient>(n\_quadrature\_pts));
348             \}
349         \}
350 
351         \textcolor{comment}{// Vectors containing the lambda weights}
352         std::vector<std::vector<libMesh::Real> > lambda\_weight\_mediator(
353                 mediator\_addresses.n\_dofs\_u,
354                 std::vector<libMesh::Real>(inter\_addresses.n\_dofs\_u, 0));
355         std::vector<std::vector<libMesh::Real> > lambda\_weight\_R\_BIG(
356                 R\_BIG\_addresses.n\_dofs\_u,
357                 std::vector<libMesh::Real>(inter\_addresses.n\_dofs\_u, 0));
358         std::vector<std::vector<libMesh::Real> > lambda\_weight\_R\_micro(
359                 R\_micro\_addresses.n\_dofs\_u,
360                 std::vector<libMesh::Real>(inter\_addresses.n\_dofs\_u, 0));
361     
362         \textcolor{comment}{// Initialize global matrix}
363         \hyperlink{classcarl_1_1assemble__coupling__matrices_ace985578e3743b194f9058431735d997}{prepare\_coupling\_preallocation}(
364                 couplingMatrix\_mediator\_BIG,
365                 mediator\_addresses,
366                 BIG\_addresses,
367                 inter\_table\_mediator\_BIG
368                 );
369 
370         \hyperlink{classcarl_1_1assemble__coupling__matrices_ace985578e3743b194f9058431735d997}{prepare\_coupling\_preallocation}(
371                 couplingMatrix\_mediator\_micro,
372                 mediator\_addresses,
373                 micro\_addresses,
374                 inter\_table\_mediator\_micro
375                 );
376         
377         couplingMatrix\_mediator\_mediator.attach\_dof\_map(mediator\_addresses.dof\_map);
378         couplingMatrix\_mediator\_mediator.init();
379 
380         \textcolor{comment}{// Intersection indexes and iterators}
381         \textcolor{keywordtype}{int} inter\_idx = -1;
382         \textcolor{keywordtype}{int} elem\_restrict\_BIG\_idx = -1;
383         \textcolor{keywordtype}{int} elem\_restrict\_micro\_idx = -1;
384 
385         \textcolor{keywordtype}{int} elem\_BIG\_idx = -1;
386         \textcolor{keywordtype}{int} elem\_micro\_idx = -1;
387         \textcolor{keywordtype}{int} elem\_mediator\_idx = -1;
388         \textcolor{keywordtype}{int} elem\_inter\_idx = -1;
389 
390         std::pair<int, int> restrict\_idx\_pair;
391         std::pair<int, int> idx\_pair;
392 
393         \textcolor{comment}{// DEBUG CODE !!!}
394         \textcolor{keywordtype}{int} DEBUG\_max\_inter\_idx = -1;
395         \textcolor{keywordtype}{int} DEBUG\_nb\_of\_inter\_elems = 0;
396         \textcolor{keywordtype}{double} DEBUG\_vol = 0;
397 
398         \textcolor{comment}{// For each intersection}
399         libMesh::MeshBase::const\_element\_iterator           inter\_elIt =
400                 inter\_addresses.mesh.active\_local\_elements\_begin();
401         \textcolor{keyword}{const} libMesh::MeshBase::const\_element\_iterator     end\_inter\_elIt =
402                 inter\_addresses.mesh.active\_local\_elements\_end();
403 
404         \textcolor{keywordflow}{for}( ; inter\_elIt != end\_inter\_elIt; ++inter\_elIt )
405         \{
406             \textcolor{keyword}{const} libMesh::Elem* elem\_inter = *inter\_elIt;
407 
408             \textcolor{comment}{// Get the intersection element idx}
409             elem\_inter\_idx = elem\_inter->id();
410             inter\_idx = local\_intersection\_meshI\_to\_inter\_map.at(elem\_inter\_idx);
411 
412             restrict\_idx\_pair = full\_intersection\_restricted\_pairs\_map.at(inter\_idx);
413             elem\_restrict\_BIG\_idx = restrict\_idx\_pair.first;
414             elem\_restrict\_micro\_idx = restrict\_idx\_pair.second;
415 
416             idx\_pair = full\_intersection\_pairs\_map.at(inter\_idx);
417             elem\_BIG\_idx = idx\_pair.first;
418             elem\_micro\_idx = idx\_pair.second;
419 
420             \textcolor{comment}{// TODO For now, we suppose that BIG contains the mediator. So ...}
421             elem\_mediator\_idx = elem\_restrict\_BIG\_idx;
422 
423             \textcolor{keyword}{const} libMesh::Elem* elem\_mediator =
424                     mediator\_addresses.mesh.elem(elem\_mediator\_idx);
425             \textcolor{keyword}{const} libMesh::Elem* elem\_R\_BIG =
426                     R\_BIG\_addresses.mesh.elem(elem\_restrict\_BIG\_idx);
427             \textcolor{keyword}{const} libMesh::Elem* elem\_R\_micro =
428                     R\_micro\_addresses.mesh.elem(elem\_restrict\_micro\_idx);
429 
430             mediator\_addresses.set\_DoFs(elem\_mediator\_idx);
431             R\_BIG\_addresses.set\_DoFs(elem\_restrict\_BIG\_idx);
432             R\_micro\_addresses.set\_DoFs(elem\_restrict\_micro\_idx);
433 
434             BIG\_addresses.set\_DoFs(elem\_BIG\_idx);
435             micro\_addresses.set\_DoFs(elem\_micro\_idx);
436 
437             \textcolor{comment}{// Resize dense matrix, if needed}
438             \textcolor{keywordflow}{if} (!bSameElemsType)
439             \{
440                 Me\_mediator\_R\_micro.set\_matrices(mediator\_addresses,
441                         R\_micro\_addresses);
442                 Me\_mediator\_R\_BIG.set\_matrices(mediator\_addresses,
443                         R\_BIG\_addresses);
444                 Me\_mediator\_mediator.set\_matrices(mediator\_addresses,
445                         mediator\_addresses);
446 
447                 \textcolor{comment}{// Set up corrected shape vectors}
448                 inter\_addresses.fe\_unique\_ptr->reinit(elem\_inter);
449                 n\_quadrature\_pts =
450                         inter\_addresses.fe\_unique\_ptr->n\_quadrature\_points();
451 
452                 corrected\_phi\_R\_BIG.resize(R\_BIG\_addresses.n\_dofs\_u,
453                         std::vector<libMesh::Real>(n\_quadrature\_pts, 0));
454                 corrected\_phi\_mediator.resize(mediator\_addresses.n\_dofs\_u,
455                         std::vector<libMesh::Real>(n\_quadrature\_pts, 0));
456                 corrected\_phi\_R\_micro.resize(R\_micro\_addresses.n\_dofs\_u,
457                         std::vector<libMesh::Real>(n\_quadrature\_pts, 0));
458 
459                 \textcolor{keywordflow}{if} (\hyperlink{classcarl_1_1assemble__coupling__matrices_a9e3bf058bd10aacb63ebbab34fe37628}{m\_bUseH1Coupling}[micro\_name])
460                 \{
461                     corrected\_dphi\_R\_BIG.resize(R\_BIG\_addresses.n\_dofs\_u,
462                             std::vector<libMesh::RealGradient>(n\_quadrature\_pts));
463                     corrected\_dphi\_mediator.resize(mediator\_addresses.n\_dofs\_u,
464                             std::vector<libMesh::RealGradient>(n\_quadrature\_pts));
465                     corrected\_dphi\_R\_micro.resize(R\_micro\_addresses.n\_dofs\_u,
466                             std::vector<libMesh::RealGradient>(n\_quadrature\_pts));
467                 \}
468             \}
469 
470             Me\_mediator\_R\_micro.zero();
471             Me\_mediator\_R\_BIG.zero();
472             Me\_mediator\_mediator.zero();
473 
474             \textcolor{comment}{// DEBUG!!!}
475             \textcolor{keywordflow}{if} (\hyperlink{assemble__coupling_8h_a3f527e02b01bca9936969241fc053a33}{MASTER\_debug\_coupling\_assemble})
476             \{
477                 \textcolor{keywordflow}{if} (elem\_inter\_idx > DEBUG\_max\_inter\_idx)
478                 \{
479                     DEBUG\_max\_inter\_idx = elem\_inter\_idx;
480                 \}
481             \}
482 
483             \textcolor{comment}{// DEBUG !!!}
484             \textcolor{keywordflow}{if} (\hyperlink{assemble__coupling_8h_a3f527e02b01bca9936969241fc053a33}{MASTER\_debug\_coupling\_assemble})
485             \{
486                 DEBUG\_vol += elem\_inter->volume();
487                 ++DEBUG\_nb\_of\_inter\_elems;
488             \}
489 
490             \textcolor{comment}{// Restart the element}
491             inter\_addresses.fe\_unique\_ptr->reinit(elem\_inter);
492 
493             \hyperlink{classcarl_1_1assemble__coupling__matrices_a27ee998dbd1a87b1ce4d1e9c9e515e43}{get\_lambdas}(R\_BIG\_addresses.dim, R\_BIG\_addresses.fe\_type, elem\_R\_BIG,
494                     quad\_points\_inter, quad\_points\_reference,
495                     lambda\_weight\_R\_BIG);
496 
497             \hyperlink{classcarl_1_1assemble__coupling__matrices_a27ee998dbd1a87b1ce4d1e9c9e515e43}{get\_lambdas}(R\_micro\_addresses.dim, R\_micro\_addresses.fe\_type,
498                     elem\_R\_micro, quad\_points\_inter, quad\_points\_reference,
499                     lambda\_weight\_R\_micro);
500 
501             \hyperlink{classcarl_1_1assemble__coupling__matrices_a27ee998dbd1a87b1ce4d1e9c9e515e43}{get\_lambdas}(mediator\_addresses.dim, mediator\_addresses.fe\_type,
502                     elem\_mediator, quad\_points\_inter, quad\_points\_reference,
503                     lambda\_weight\_mediator);
504 
505             \hyperlink{classcarl_1_1assemble__coupling__matrices_a677a3527845b3503cc5f5daa8de63864}{set\_corrected\_shapes}(lambda\_weight\_R\_BIG, phi\_inter,
506                     corrected\_phi\_R\_BIG);
507             \hyperlink{classcarl_1_1assemble__coupling__matrices_a677a3527845b3503cc5f5daa8de63864}{set\_corrected\_shapes}(lambda\_weight\_R\_micro, phi\_inter,
508                     corrected\_phi\_R\_micro);
509             \hyperlink{classcarl_1_1assemble__coupling__matrices_a677a3527845b3503cc5f5daa8de63864}{set\_corrected\_shapes}(lambda\_weight\_mediator, phi\_inter,
510                     corrected\_phi\_mediator);
511 
512             \textcolor{keywordflow}{if} (\hyperlink{classcarl_1_1assemble__coupling__matrices_a9e3bf058bd10aacb63ebbab34fe37628}{m\_bUseH1Coupling}[micro\_name])
513             \{
514                 \hyperlink{classcarl_1_1assemble__coupling__matrices_a7f5ae4da1fe905fb90e9016f1dbb2fea}{set\_corrected\_shape\_gradients}(lambda\_weight\_R\_BIG, dphi\_inter,
515                         corrected\_dphi\_R\_BIG);
516                 \hyperlink{classcarl_1_1assemble__coupling__matrices_a7f5ae4da1fe905fb90e9016f1dbb2fea}{set\_corrected\_shape\_gradients}(lambda\_weight\_R\_micro, 
      dphi\_inter,
517                         corrected\_dphi\_R\_micro);
518                 \hyperlink{classcarl_1_1assemble__coupling__matrices_a7f5ae4da1fe905fb90e9016f1dbb2fea}{set\_corrected\_shape\_gradients}(lambda\_weight\_mediator,
519                         dphi\_inter, corrected\_dphi\_mediator);
520             \}
521 
522             \textcolor{comment}{// For each quadrature point determinate the sub-matrices elements}
523             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} qp = 0; qp < inter\_addresses.qrule.n\_points();
524                     qp++)
525             \{
526                 \textcolor{comment}{// Mediator -> micro coupling}
527                 Me\_mediator\_R\_micro.build\_L2\_coupling\_matrix(mediator\_addresses,
528                         R\_micro\_addresses, qp, corrected\_phi\_mediator,
529                         corrected\_phi\_R\_micro, JxW, L2\_coupling\_const);
530 
531                 \textcolor{comment}{// Mediator -> BIG coupling}
532                 Me\_mediator\_R\_BIG.build\_L2\_coupling\_matrix(mediator\_addresses,
533                         R\_BIG\_addresses, qp, corrected\_phi\_mediator,
534                         corrected\_phi\_R\_BIG, JxW, L2\_coupling\_const);
535 
536                 \textcolor{comment}{// Mediator -> Mediator coupling}
537                 Me\_mediator\_mediator.build\_L2\_coupling\_matrix(
538                         mediator\_addresses, mediator\_addresses, qp,
539                         corrected\_phi\_mediator, corrected\_phi\_mediator, JxW,
540                         L2\_coupling\_const);
541 
542                 \textcolor{keywordflow}{if} (\hyperlink{classcarl_1_1assemble__coupling__matrices_a9e3bf058bd10aacb63ebbab34fe37628}{m\_bUseH1Coupling}[micro\_name])
543                 \{
544                     \textcolor{comment}{// Then we must also build the strain terms}
545 
546                     \textcolor{comment}{// Mediator -> micro coupling}
547                     Me\_mediator\_R\_micro.add\_H1\_coupling\_matrix(mediator\_addresses,
548                             R\_micro\_addresses, qp, corrected\_dphi\_mediator,
549                             corrected\_dphi\_R\_micro, JxW, H1\_coupling\_const);
550 
551                     Me\_mediator\_R\_BIG.add\_H1\_coupling\_matrix(mediator\_addresses,
552                             R\_BIG\_addresses, qp, corrected\_dphi\_mediator,
553                             corrected\_dphi\_R\_BIG, JxW, H1\_coupling\_const);
554 
555                     Me\_mediator\_mediator.add\_H1\_coupling\_matrix(
556                             mediator\_addresses, mediator\_addresses, qp,
557                             corrected\_dphi\_mediator, corrected\_dphi\_mediator,
558                             JxW, H1\_coupling\_const);
559                 \}
560             \}
561 
562             couplingMatrix\_mediator\_micro.add\_matrix(Me\_mediator\_R\_micro.Me,
563                     mediator\_addresses.dof\_indices, micro\_addresses.dof\_indices);
564             couplingMatrix\_mediator\_BIG.add\_matrix(Me\_mediator\_R\_BIG.Me,
565                     mediator\_addresses.dof\_indices, BIG\_addresses.dof\_indices);
566             couplingMatrix\_mediator\_mediator.add\_matrix(Me\_mediator\_mediator.Me,
567                     mediator\_addresses.dof\_indices, mediator\_addresses.dof\_indices);
568         \}
569 
570         WorldComm.barrier();
571 
572         couplingMatrix\_mediator\_micro.close();
573         couplingMatrix\_mediator\_BIG.close();
574         couplingMatrix\_mediator\_mediator.close();
575 
576         \hyperlink{namespacecarl_a8ab4aecb3273c14a472f00cc892f95a0}{print\_matrix\_dim}(couplingMatrix\_mediator\_micro);
577         \hyperlink{namespacecarl_a8ab4aecb3273c14a472f00cc892f95a0}{print\_matrix\_dim}(couplingMatrix\_mediator\_BIG);
578         \hyperlink{namespacecarl_a8ab4aecb3273c14a472f00cc892f95a0}{print\_matrix\_dim}(couplingMatrix\_mediator\_mediator);
579 
580         \textcolor{keywordflow}{if} (\hyperlink{assemble__coupling_8h_a3f527e02b01bca9936969241fc053a33}{MASTER\_debug\_coupling\_assemble})
581         \{
582             std::cout << \textcolor{stringliteral}{"> COUPLING DEBUG !!! "} << std::endl;
583             std::cout << \textcolor{stringliteral}{">"} << std::endl;
584             std::cout << \textcolor{stringliteral}{">    DEBUG\_max\_inter\_idx     = "} << DEBUG\_max\_inter\_idx
585                     << std::endl;
586             std::cout << \textcolor{stringliteral}{">    DEBUG\_nb\_of\_inter\_elems = "}
587                     << DEBUG\_nb\_of\_inter\_elems << std::endl;
588             std::cout << \textcolor{stringliteral}{">    DEBUG\_vol               = "} << DEBUG\_vol << std::endl
589                     << std::endl;
590         \}
591     \};
\end{DoxyCode}
\hypertarget{classcarl_1_1assemble__coupling__matrices_ae3a145dae0e2d3f49b49da8c6d382f97}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!check\+\_\+coupling\+\_\+construction\+\_\+3\+D\+\_\+parallel@{check\+\_\+coupling\+\_\+construction\+\_\+3\+D\+\_\+parallel}}
\index{check\+\_\+coupling\+\_\+construction\+\_\+3\+D\+\_\+parallel@{check\+\_\+coupling\+\_\+construction\+\_\+3\+D\+\_\+parallel}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{check\+\_\+coupling\+\_\+construction\+\_\+3\+D\+\_\+parallel(const std\+::string B\+I\+G\+\_\+name, const std\+::string micro\+\_\+name, const std\+::string inter\+\_\+name, const std\+::string mediator\+\_\+name, const lib\+Mesh\+::\+Mesh\+Base \&mesh\+\_\+\+R\+\_\+\+B\+I\+G, const lib\+Mesh\+::\+Mesh\+Base \&mesh\+\_\+\+R\+\_\+micro, const std\+::unordered\+\_\+map$<$ int, std\+::pair$<$ int, int $>$ $>$ \&full\+\_\+intersection\+\_\+pairs\+\_\+map, const std\+::unordered\+\_\+map$<$ int, std\+::pair$<$ int, int $>$ $>$ \&full\+\_\+intersection\+\_\+restricted\+\_\+pairs\+\_\+map, const std\+::unordered\+\_\+map$<$ int, int $>$ \&local\+\_\+intersection\+\_\+mesh\+I\+\_\+to\+\_\+inter\+\_\+map, const std\+::unordered\+\_\+multimap$<$ int, int $>$ \&inter\+\_\+table\+\_\+mediator\+\_\+\+B\+I\+G, const std\+::unordered\+\_\+multimap$<$ int, int $>$ \&inter\+\_\+table\+\_\+mediator\+\_\+micro, const std\+::string B\+I\+G\+\_\+type=""Elasticity"", const std\+::string micro\+\_\+type=""Elasticity"", bool b\+Same\+Elems\+Type=true)}]{\setlength{\rightskip}{0pt plus 5cm}void carl\+::assemble\+\_\+coupling\+\_\+matrices\+::check\+\_\+coupling\+\_\+construction\+\_\+3\+D\+\_\+parallel (
\begin{DoxyParamCaption}
\item[{const std\+::string}]{B\+I\+G\+\_\+name, }
\item[{const std\+::string}]{micro\+\_\+name, }
\item[{const std\+::string}]{inter\+\_\+name, }
\item[{const std\+::string}]{mediator\+\_\+name, }
\item[{const lib\+Mesh\+::\+Mesh\+Base \&}]{mesh\+\_\+\+R\+\_\+\+B\+I\+G, }
\item[{const lib\+Mesh\+::\+Mesh\+Base \&}]{mesh\+\_\+\+R\+\_\+micro, }
\item[{const std\+::unordered\+\_\+map$<$ int, std\+::pair$<$ int, int $>$ $>$ \&}]{full\+\_\+intersection\+\_\+pairs\+\_\+map, }
\item[{const std\+::unordered\+\_\+map$<$ int, std\+::pair$<$ int, int $>$ $>$ \&}]{full\+\_\+intersection\+\_\+restricted\+\_\+pairs\+\_\+map, }
\item[{const std\+::unordered\+\_\+map$<$ int, int $>$ \&}]{local\+\_\+intersection\+\_\+mesh\+I\+\_\+to\+\_\+inter\+\_\+map, }
\item[{const std\+::unordered\+\_\+multimap$<$ int, int $>$ \&}]{inter\+\_\+table\+\_\+mediator\+\_\+\+B\+I\+G, }
\item[{const std\+::unordered\+\_\+multimap$<$ int, int $>$ \&}]{inter\+\_\+table\+\_\+mediator\+\_\+micro, }
\item[{const std\+::string}]{B\+I\+G\+\_\+type = {\ttfamily \char`\"{}Elasticity\char`\"{}}, }
\item[{const std\+::string}]{micro\+\_\+type = {\ttfamily \char`\"{}Elasticity\char`\"{}}, }
\item[{bool}]{b\+Same\+Elems\+Type = {\ttfamily true}}
\end{DoxyParamCaption}
)}\label{classcarl_1_1assemble__coupling__matrices_ae3a145dae0e2d3f49b49da8c6d382f97}


Definition at line 593 of file assemble\+\_\+functions\+\_\+coupling.\+cpp.


\begin{DoxyCode}
614     \{
615         \textcolor{comment}{// TODO : make it possible to invert the algorithm's systems!}
616         \textcolor{comment}{// Addresses to the eq. systems}
617         libMesh::EquationSystems& mediator\_eq\_system =
618                 *\hyperlink{classcarl_1_1assemble__coupling__matrices_a9d61d2378c5658d6cfc7fa0d2ef306a5}{m\_mediator\_EquationSystemMap}[mediator\_name];
619         libMesh::EquationSystems& BIG\_eq\_system =
620                 *\hyperlink{classcarl_1_1assemble__coupling__matrices_a74638b62015299b30afb23168b141429}{m\_BIG\_EquationSystem}.second;
621         libMesh::EquationSystems& micro\_eq\_system =
622                 *\hyperlink{classcarl_1_1assemble__coupling__matrices_a13fddbcb853df9b7ce1a99062fb9f8b6}{m\_micro\_EquationSystemMap}[micro\_name];
623         libMesh::EquationSystems& inter\_eq\_system =
624                 *\hyperlink{classcarl_1_1assemble__coupling__matrices_a6c9fab72397ed371acccbf88fd72665f}{m\_inter\_EquationSystemMap}[inter\_name];
625 
626         libMesh::EquationSystems& R\_BIG\_eq\_system =
627                 *\hyperlink{classcarl_1_1assemble__coupling__matrices_ac8e2172182aa563e854e7b693344b301}{m\_R\_BIG\_EquationSystem}.second;
628         libMesh::EquationSystems& R\_micro\_eq\_system =
629                 *\hyperlink{classcarl_1_1assemble__coupling__matrices_a5b7c4f9307a9611926dc1ccf8bb33d4b}{m\_R\_micro\_EquationSystemMap}[micro\_name];
630 
631         \textcolor{comment}{// First, test if all the systems have an elasticity model and variable set}
632         \hyperlink{common__header_8h_a593ccc80b790b2268653fcf6597bf451}{homemade\_assert\_msg}(micro\_eq\_system.has\_system(micro\_type),
633                 \textcolor{stringliteral}{" Micro equation systems is missing a system type!"});
634         \hyperlink{common__header_8h_a593ccc80b790b2268653fcf6597bf451}{homemade\_assert\_msg}(BIG\_eq\_system.has\_system(BIG\_type),
635                 \textcolor{stringliteral}{" Macro equation systems is missing a system type!"});
636         \hyperlink{common__header_8h_a593ccc80b790b2268653fcf6597bf451}{homemade\_assert\_msg}(R\_micro\_eq\_system.has\_system(\textcolor{stringliteral}{"Elasticity"}),
637                 \textcolor{stringliteral}{" Restricted micro equation systems missing \(\backslash\)"Elasticity\(\backslash\)" system!"});
638         \hyperlink{common__header_8h_a593ccc80b790b2268653fcf6597bf451}{homemade\_assert\_msg}(R\_BIG\_eq\_system.has\_system(\textcolor{stringliteral}{"Elasticity"}),
639                 \textcolor{stringliteral}{" Restricted macro equation systems missing \(\backslash\)"Elasticity\(\backslash\)" system!"});
640         \hyperlink{common__header_8h_a593ccc80b790b2268653fcf6597bf451}{homemade\_assert\_msg}(inter\_eq\_system.has\_system(\textcolor{stringliteral}{"Elasticity"}),
641                 \textcolor{stringliteral}{" Intersection equation systems missing \(\backslash\)"Elasticity\(\backslash\)" system!"});
642         \hyperlink{common__header_8h_a593ccc80b790b2268653fcf6597bf451}{homemade\_assert\_msg}(mediator\_eq\_system.has\_system(\textcolor{stringliteral}{"Elasticity"}),
643                 \textcolor{stringliteral}{" Mediatored equation systems missing \(\backslash\)"Elasticity\(\backslash\)" system!"});
644 
645         \textcolor{comment}{// Systems and vars}
646         libMesh::System& volume\_mediator\_system =
647                 libMesh::cast\_ref<libMesh::System&>(mediator\_eq\_system.get\_system(\textcolor{stringliteral}{"Elasticity"}));
648 
649         libMesh::System& volume\_BIG\_system =
650                 libMesh::cast\_ref<libMesh::System&>(BIG\_eq\_system.get\_system<libMesh::ExplicitSystem>(
      BIG\_type));
651 
652         libMesh::System& volume\_micro\_system =
653                 libMesh::cast\_ref<libMesh::System&>(micro\_eq\_system.get\_system<libMesh::ExplicitSystem>(
      micro\_type));
654 
655         libMesh::System& volume\_inter\_system =
656                 inter\_eq\_system.get\_system<libMesh::ExplicitSystem>(\textcolor{stringliteral}{"Elasticity"});
657 
658         libMesh::System& volume\_R\_BIG\_system =
659                 R\_BIG\_eq\_system.get\_system<libMesh::ExplicitSystem>(\textcolor{stringliteral}{"Elasticity"});
660 
661         libMesh::System& volume\_R\_micro\_system =
662                 R\_micro\_eq\_system.get\_system<libMesh::ExplicitSystem>(\textcolor{stringliteral}{"Elasticity"});
663 
664         libMesh\_fe\_addresses\_3 mediator\_addresses(volume\_mediator\_system);
665         libMesh\_fe\_addresses\_3 BIG\_addresses(volume\_BIG\_system);
666         libMesh\_fe\_addresses\_3 micro\_addresses(volume\_micro\_system);
667         libMesh\_fe\_addresses\_3 inter\_addresses(volume\_inter\_system);
668 
669         libMesh\_fe\_addresses\_3 R\_BIG\_addresses(volume\_R\_BIG\_system);
670         libMesh\_fe\_addresses\_3 R\_micro\_addresses(volume\_R\_micro\_system);
671 
672         \textcolor{comment}{// Vector that will keep the quadrature points}
673         \textcolor{keyword}{const} std::vector<libMesh::Point>& quad\_points\_inter =
674                 inter\_addresses.fe\_unique\_ptr->get\_xyz();
675         std::vector<libMesh::Point> quad\_points\_reference;
676 
677         \textcolor{comment}{// Jacobians}
678         \textcolor{keyword}{const} std::vector<libMesh::Real>& JxW =
679                 inter\_addresses.fe\_unique\_ptr->get\_JxW();
680 
681         \textcolor{comment}{// Shape functions}
682         \textcolor{keyword}{const} std::vector<std::vector<libMesh::Real> >& phi\_inter =
683                 inter\_addresses.fe\_unique\_ptr->get\_phi();
684         std::vector<std::vector<libMesh::Real> > corrected\_phi\_R\_BIG;
685         std::vector<std::vector<libMesh::Real> > corrected\_phi\_R\_micro;
686         std::vector<std::vector<libMesh::Real> > corrected\_phi\_mediator;
687 
688         \textcolor{comment}{// Shape functions gradients}
689         \textcolor{keyword}{const} std::vector<std::vector<libMesh::RealGradient> >& dphi\_inter =
690                 inter\_addresses.fe\_unique\_ptr->get\_dphi();
691         std::vector<std::vector<libMesh::RealGradient> > corrected\_dphi\_R\_BIG;
692         std::vector<std::vector<libMesh::RealGradient> > corrected\_dphi\_R\_micro;
693         std::vector<std::vector<libMesh::RealGradient> > corrected\_dphi\_mediator;
694 
695         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} n\_quadrature\_pts = 0;
696 
697         \textcolor{comment}{// Addresses to the matrices}
698         libMesh::PetscMatrix<libMesh::Number> couplingMatrix\_mediator\_BIG(mesh\_R\_BIG.comm());
699         libMesh::PetscMatrix<libMesh::Number> couplingMatrix\_mediator\_micro(mesh\_R\_BIG.comm());
700         libMesh::PetscMatrix<libMesh::Number> couplingMatrix\_mediator\_mediator(mesh\_R\_BIG.comm());
701 
702         \textcolor{keyword}{const} libMesh::Parallel::Communicator& WorldComm = couplingMatrix\_mediator\_micro.comm();
703 
704         \textcolor{comment}{// DoF vectors and ranges}
705         mediator\_addresses.set\_DoFs();
706         BIG\_addresses.set\_DoFs();
707         micro\_addresses.set\_DoFs();
708         inter\_addresses.set\_DoFs();
709 
710         R\_BIG\_addresses.set\_DoFs();
711         R\_micro\_addresses.set\_DoFs();
712 
713         \textcolor{comment}{// Local matrix}
714         coupling\_matrices\_3 Me\_mediator\_R\_micro;
715         coupling\_matrices\_3 Me\_mediator\_R\_BIG;
716         coupling\_matrices\_3 Me\_mediator\_mediator;
717 
718         \textcolor{comment}{//    If all elements are of the same type, do the index "extraction",}
719         \textcolor{comment}{// the matrices resizes and repositions here}
720         \textcolor{keywordflow}{if} (bSameElemsType)
721         \{
722             Me\_mediator\_R\_micro.set\_matrices(mediator\_addresses, R\_micro\_addresses);
723             Me\_mediator\_R\_BIG.set\_matrices(mediator\_addresses, R\_BIG\_addresses);
724             Me\_mediator\_mediator.set\_matrices(mediator\_addresses,
725                     mediator\_addresses);
726 
727             \textcolor{comment}{// Restart the element}
728 
729             \textcolor{keyword}{const} libMesh::Elem* elem\_inter =
730                     *inter\_addresses.mesh.active\_local\_elements\_begin();
731             inter\_addresses.fe\_unique\_ptr->reinit(elem\_inter);
732             n\_quadrature\_pts = inter\_addresses.fe\_unique\_ptr->n\_quadrature\_points();
733 
734             corrected\_phi\_R\_BIG.resize(R\_BIG\_addresses.n\_dofs\_u,
735                     std::vector<libMesh::Real>(n\_quadrature\_pts, 0));
736             corrected\_phi\_R\_micro.resize(R\_micro\_addresses.n\_dofs\_u,
737                     std::vector<libMesh::Real>(n\_quadrature\_pts, 0));
738             corrected\_phi\_mediator.resize(mediator\_addresses.n\_dofs\_u,
739                     std::vector<libMesh::Real>(n\_quadrature\_pts, 0));
740 
741 
742                 corrected\_dphi\_R\_BIG.resize(R\_BIG\_addresses.n\_dofs\_u,
743                         std::vector<libMesh::RealGradient>(n\_quadrature\_pts));
744                 corrected\_dphi\_mediator.resize(mediator\_addresses.n\_dofs\_u,
745                         std::vector<libMesh::RealGradient>(n\_quadrature\_pts));
746                 corrected\_dphi\_R\_micro.resize(R\_micro\_addresses.n\_dofs\_u,
747                         std::vector<libMesh::RealGradient>(n\_quadrature\_pts));
748 
749         \}
750 
751         \textcolor{comment}{// Vectors containing the lambda weights}
752         std::vector<std::vector<libMesh::Real> > lambda\_weight\_mediator(
753                 mediator\_addresses.n\_dofs\_u,
754                 std::vector<libMesh::Real>(inter\_addresses.n\_dofs\_u, 0));
755         std::vector<std::vector<libMesh::Real> > lambda\_weight\_R\_BIG(
756                 R\_BIG\_addresses.n\_dofs\_u,
757                 std::vector<libMesh::Real>(inter\_addresses.n\_dofs\_u, 0));
758         std::vector<std::vector<libMesh::Real> > lambda\_weight\_R\_micro(
759                 R\_micro\_addresses.n\_dofs\_u,
760                 std::vector<libMesh::Real>(inter\_addresses.n\_dofs\_u, 0));
761 
762         \textcolor{comment}{// Initialize global matrix}
763         \hyperlink{classcarl_1_1assemble__coupling__matrices_ace985578e3743b194f9058431735d997}{prepare\_coupling\_preallocation}(
764                 couplingMatrix\_mediator\_BIG,
765                 mediator\_addresses,
766                 BIG\_addresses,
767                 inter\_table\_mediator\_BIG
768                 );
769 
770         \hyperlink{classcarl_1_1assemble__coupling__matrices_ace985578e3743b194f9058431735d997}{prepare\_coupling\_preallocation}(
771                 couplingMatrix\_mediator\_micro,
772                 mediator\_addresses,
773                 micro\_addresses,
774                 inter\_table\_mediator\_micro
775                 );
776 
777         couplingMatrix\_mediator\_mediator.attach\_dof\_map(mediator\_addresses.dof\_map);
778         couplingMatrix\_mediator\_mediator.init();
779 
780         std::cout << \textcolor{stringliteral}{" ----------------- "} << std::endl;
781         \textcolor{comment}{// Intersection indexes and iterators}
782         \textcolor{keywordtype}{int} inter\_idx = -1;
783         \textcolor{keywordtype}{int} elem\_restrict\_BIG\_idx = -1;
784         \textcolor{keywordtype}{int} elem\_restrict\_micro\_idx = -1;
785 
786         \textcolor{keywordtype}{int} elem\_BIG\_idx = -1;
787         \textcolor{keywordtype}{int} elem\_micro\_idx = -1;
788         \textcolor{keywordtype}{int} elem\_mediator\_idx = -1;
789         \textcolor{keywordtype}{int} elem\_inter\_idx = -1;
790 
791         std::pair<int, int> restrict\_idx\_pair;
792         std::pair<int, int> idx\_pair;
793 
794         \textcolor{comment}{// DEBUG CODE !!!}
795         \textcolor{keywordtype}{int} DEBUG\_max\_inter\_idx = -1;
796         \textcolor{keywordtype}{int} DEBUG\_nb\_of\_inter\_elems = 0;
797         \textcolor{keywordtype}{double} DEBUG\_vol = 0;
798 
799         \textcolor{comment}{// For each intersection}
800         libMesh::MeshBase::const\_element\_iterator           inter\_elIt =
801                 inter\_addresses.mesh.active\_local\_elements\_begin();
802         \textcolor{keyword}{const} libMesh::MeshBase::const\_element\_iterator     end\_inter\_elIt =
803                 inter\_addresses.mesh.active\_local\_elements\_end();
804 
805         \textcolor{keywordflow}{for}( ; inter\_elIt != end\_inter\_elIt; ++inter\_elIt )
806         \{
807             \textcolor{keyword}{const} libMesh::Elem* elem\_inter = *inter\_elIt;
808 
809             \textcolor{comment}{// Get the intersection element idx}
810             elem\_inter\_idx = elem\_inter->id();
811             inter\_idx = local\_intersection\_meshI\_to\_inter\_map.at(elem\_inter\_idx);
812 
813             restrict\_idx\_pair = full\_intersection\_restricted\_pairs\_map.at(inter\_idx);
814             elem\_restrict\_BIG\_idx = restrict\_idx\_pair.first;
815             elem\_restrict\_micro\_idx = restrict\_idx\_pair.second;
816 
817             idx\_pair = full\_intersection\_pairs\_map.at(inter\_idx);
818             elem\_BIG\_idx = idx\_pair.first;
819             elem\_micro\_idx = idx\_pair.second;
820 
821             \textcolor{comment}{// TODO For now, we suppose that BIG contains the mediator. So ...}
822             elem\_mediator\_idx = elem\_restrict\_BIG\_idx;
823 
824             \textcolor{keyword}{const} libMesh::Elem* elem\_mediator =
825                     mediator\_addresses.mesh.elem(elem\_mediator\_idx);
826             \textcolor{keyword}{const} libMesh::Elem* elem\_R\_BIG =
827                     R\_BIG\_addresses.mesh.elem(elem\_restrict\_BIG\_idx);
828             \textcolor{keyword}{const} libMesh::Elem* elem\_R\_micro =
829                     R\_micro\_addresses.mesh.elem(elem\_restrict\_micro\_idx);
830 
831             mediator\_addresses.set\_DoFs(elem\_mediator\_idx);
832             R\_BIG\_addresses.set\_DoFs(elem\_restrict\_BIG\_idx);
833             R\_micro\_addresses.set\_DoFs(elem\_restrict\_micro\_idx);
834 
835             BIG\_addresses.set\_DoFs(elem\_BIG\_idx);
836             micro\_addresses.set\_DoFs(elem\_micro\_idx);
837 
838             \textcolor{comment}{// Resize dense matrix, if needed}
839             \textcolor{keywordflow}{if} (!bSameElemsType)
840             \{
841                 Me\_mediator\_R\_micro.set\_matrices(mediator\_addresses,
842                         R\_micro\_addresses);
843                 Me\_mediator\_R\_BIG.set\_matrices(mediator\_addresses,
844                         R\_BIG\_addresses);
845                 Me\_mediator\_mediator.set\_matrices(mediator\_addresses,
846                         mediator\_addresses);
847 
848                 \textcolor{comment}{// Set up corrected shape vectors}
849                 inter\_addresses.fe\_unique\_ptr->reinit(elem\_inter);
850                 n\_quadrature\_pts =
851                         inter\_addresses.fe\_unique\_ptr->n\_quadrature\_points();
852 
853                 corrected\_phi\_R\_BIG.resize(R\_BIG\_addresses.n\_dofs\_u,
854                         std::vector<libMesh::Real>(n\_quadrature\_pts, 0));
855                 corrected\_phi\_mediator.resize(mediator\_addresses.n\_dofs\_u,
856                         std::vector<libMesh::Real>(n\_quadrature\_pts, 0));
857                 corrected\_phi\_R\_micro.resize(R\_micro\_addresses.n\_dofs\_u,
858                         std::vector<libMesh::Real>(n\_quadrature\_pts, 0));
859 
860 
861                     corrected\_dphi\_R\_BIG.resize(R\_BIG\_addresses.n\_dofs\_u,
862                             std::vector<libMesh::RealGradient>(n\_quadrature\_pts));
863                     corrected\_dphi\_mediator.resize(mediator\_addresses.n\_dofs\_u,
864                             std::vector<libMesh::RealGradient>(n\_quadrature\_pts));
865                     corrected\_dphi\_R\_micro.resize(R\_micro\_addresses.n\_dofs\_u,
866                             std::vector<libMesh::RealGradient>(n\_quadrature\_pts));
867             \}
868 
869             Me\_mediator\_R\_micro.zero();
870             Me\_mediator\_R\_BIG.zero();
871             Me\_mediator\_mediator.zero();
872 
873             \textcolor{comment}{// DEBUG!!!}
874 
875                 \textcolor{keywordflow}{if} (elem\_inter\_idx > DEBUG\_max\_inter\_idx)
876                 \{
877                     DEBUG\_max\_inter\_idx = elem\_inter\_idx;
878                 \}
879 
880 
881             \textcolor{comment}{// DEBUG !!!}
882 
883                 DEBUG\_vol += std::abs(elem\_inter->volume());
884                 ++DEBUG\_nb\_of\_inter\_elems;
885 
886 
887             \textcolor{comment}{// Restart the element}
888             inter\_addresses.fe\_unique\_ptr->reinit(elem\_inter);
889 
890             \hyperlink{classcarl_1_1assemble__coupling__matrices_a27ee998dbd1a87b1ce4d1e9c9e515e43}{get\_lambdas}(R\_BIG\_addresses.dim, R\_BIG\_addresses.fe\_type, elem\_R\_BIG,
891                     quad\_points\_inter, quad\_points\_reference,
892                     lambda\_weight\_R\_BIG);
893 
894             \hyperlink{classcarl_1_1assemble__coupling__matrices_a27ee998dbd1a87b1ce4d1e9c9e515e43}{get\_lambdas}(R\_micro\_addresses.dim, R\_micro\_addresses.fe\_type,
895                     elem\_R\_micro, quad\_points\_inter, quad\_points\_reference,
896                     lambda\_weight\_R\_micro);
897 
898             \hyperlink{classcarl_1_1assemble__coupling__matrices_a27ee998dbd1a87b1ce4d1e9c9e515e43}{get\_lambdas}(mediator\_addresses.dim, mediator\_addresses.fe\_type,
899                     elem\_mediator, quad\_points\_inter, quad\_points\_reference,
900                     lambda\_weight\_mediator);
901 
902             \hyperlink{classcarl_1_1assemble__coupling__matrices_a677a3527845b3503cc5f5daa8de63864}{set\_corrected\_shapes}(lambda\_weight\_R\_BIG, phi\_inter,
903                     corrected\_phi\_R\_BIG);
904             \hyperlink{classcarl_1_1assemble__coupling__matrices_a677a3527845b3503cc5f5daa8de63864}{set\_corrected\_shapes}(lambda\_weight\_R\_micro, phi\_inter,
905                     corrected\_phi\_R\_micro);
906             \hyperlink{classcarl_1_1assemble__coupling__matrices_a677a3527845b3503cc5f5daa8de63864}{set\_corrected\_shapes}(lambda\_weight\_mediator, phi\_inter,
907                     corrected\_phi\_mediator);
908 
909                 \hyperlink{classcarl_1_1assemble__coupling__matrices_a7f5ae4da1fe905fb90e9016f1dbb2fea}{set\_corrected\_shape\_gradients}(lambda\_weight\_R\_BIG, dphi\_inter,
910                         corrected\_dphi\_R\_BIG);
911                 \hyperlink{classcarl_1_1assemble__coupling__matrices_a7f5ae4da1fe905fb90e9016f1dbb2fea}{set\_corrected\_shape\_gradients}(lambda\_weight\_R\_micro, 
      dphi\_inter,
912                         corrected\_dphi\_R\_micro);
913                 \hyperlink{classcarl_1_1assemble__coupling__matrices_a7f5ae4da1fe905fb90e9016f1dbb2fea}{set\_corrected\_shape\_gradients}(lambda\_weight\_mediator,
914                         dphi\_inter, corrected\_dphi\_mediator);
915 
916 
917             \textcolor{comment}{// For each quadrature point determinate the sub-matrices elements}
918             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} qp = 0; qp < inter\_addresses.qrule.n\_points();
919                     qp++)
920             \{
921                 \textcolor{comment}{// Mediator -> micro coupling}
922                 Me\_mediator\_R\_micro.build\_L2\_coupling\_matrix(mediator\_addresses,
923                         R\_micro\_addresses, qp, corrected\_phi\_mediator,
924                         corrected\_phi\_R\_micro, JxW, 1);
925 
926                 \textcolor{comment}{// Mediator -> BIG coupling}
927                 Me\_mediator\_R\_BIG.build\_L2\_coupling\_matrix(mediator\_addresses,
928                         R\_BIG\_addresses, qp, corrected\_phi\_mediator,
929                         corrected\_phi\_R\_BIG, JxW, 1);
930 
931                 \textcolor{comment}{// Mediator -> Mediator coupling}
932                 Me\_mediator\_mediator.build\_L2\_coupling\_matrix(
933                         mediator\_addresses, mediator\_addresses, qp,
934                         corrected\_phi\_mediator, corrected\_phi\_mediator, JxW,
935                         1);
936 
937                     \textcolor{comment}{// Then we must also build the strain terms}
938 
939                     \textcolor{comment}{// Mediator -> micro coupling}
940                     Me\_mediator\_R\_micro.add\_H1\_coupling\_matrix(mediator\_addresses,
941                             R\_micro\_addresses, qp, corrected\_dphi\_mediator,
942                             corrected\_dphi\_R\_micro, JxW, 0);
943 
944                     Me\_mediator\_R\_BIG.add\_H1\_coupling\_matrix(mediator\_addresses,
945                             R\_BIG\_addresses, qp, corrected\_dphi\_mediator,
946                             corrected\_dphi\_R\_BIG, JxW, 0);
947 
948                     Me\_mediator\_mediator.add\_H1\_coupling\_matrix(
949                             mediator\_addresses, mediator\_addresses, qp,
950                             corrected\_dphi\_mediator, corrected\_dphi\_mediator,
951                             JxW, 0);
952             \}
953 
954             couplingMatrix\_mediator\_micro.add\_matrix(Me\_mediator\_R\_micro.Me,
955                     mediator\_addresses.dof\_indices, micro\_addresses.dof\_indices);
956             couplingMatrix\_mediator\_BIG.add\_matrix(Me\_mediator\_R\_BIG.Me,
957                     mediator\_addresses.dof\_indices, BIG\_addresses.dof\_indices);
958             couplingMatrix\_mediator\_mediator.add\_matrix(Me\_mediator\_mediator.Me,
959                     mediator\_addresses.dof\_indices, mediator\_addresses.dof\_indices);
960         \}
961 
962         WorldComm.barrier();
963 
964         couplingMatrix\_mediator\_micro.close();
965         couplingMatrix\_mediator\_BIG.close();
966         couplingMatrix\_mediator\_mediator.close();
967 
968         std::cout << \textcolor{stringliteral}{" ----------------- "} << std::endl;
969 
970         Vec row\_sum\_micro, row\_sum\_BIG, row\_sum\_mediator;
971         MatCreateVecs(couplingMatrix\_mediator\_micro.mat(),&row\_sum\_micro,NULL);
972         MatCreateVecs(couplingMatrix\_mediator\_BIG.mat(),&row\_sum\_BIG,NULL);
973         MatCreateVecs(couplingMatrix\_mediator\_mediator.mat(),&row\_sum\_mediator,NULL);
974 
975         MatGetRowSum(couplingMatrix\_mediator\_micro.mat(),row\_sum\_micro);
976         MatGetRowSum(couplingMatrix\_mediator\_BIG.mat(),row\_sum\_BIG);
977         MatGetRowSum(couplingMatrix\_mediator\_mediator.mat(),row\_sum\_mediator);
978 
979         PetscScalar coupl\_vol\_micro = 0, coupl\_vol\_BIG = 0, coupl\_vol\_mediator = 0;
980 
981         VecSum(row\_sum\_micro,&coupl\_vol\_micro);
982         VecSum(row\_sum\_BIG,&coupl\_vol\_BIG);
983         VecSum(row\_sum\_mediator,&coupl\_vol\_mediator);
984 
985         mesh\_R\_BIG.comm().sum(DEBUG\_vol);
986 
987             std::cout << \textcolor{stringliteral}{"> COUPLING DEBUG !!! "} << std::endl;
988             std::cout << \textcolor{stringliteral}{">"} << std::endl;
989             std::cout << \textcolor{stringliteral}{">    DEBUG\_max\_inter\_idx     = "} << DEBUG\_max\_inter\_idx
990                     << std::endl;
991             std::cout << \textcolor{stringliteral}{">    DEBUG\_nb\_of\_inter\_elems = "}
992                     << DEBUG\_nb\_of\_inter\_elems << std::endl;
993             std::cout << \textcolor{stringliteral}{">    DEBUG\_mesh\_vol              = "} << DEBUG\_vol
994                     << std::endl;
995             std::cout << \textcolor{stringliteral}{">    DEBUG\_micro\_vol              = "} << coupl\_vol\_micro << std::endl;
996             std::cout << \textcolor{stringliteral}{">    DEBUG\_big\_vol              = "} << coupl\_vol\_BIG << std::endl;
997             std::cout << \textcolor{stringliteral}{">    DEBUG\_mediator\_vol              = "} << coupl\_vol\_mediator << std::endl
998                     << std::endl;
999 
1000             VecDestroy(&row\_sum\_micro);
1001             VecDestroy(&row\_sum\_BIG);
1002             VecDestroy(&row\_sum\_mediator);
1003     \};
\end{DoxyCode}
\hypertarget{classcarl_1_1assemble__coupling__matrices_a3b3020dd40cd78050744b35f9515b4d8}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!clear@{clear}}
\index{clear@{clear}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{clear()}]{\setlength{\rightskip}{0pt plus 5cm}void carl\+::assemble\+\_\+coupling\+\_\+matrices\+::clear (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\label{classcarl_1_1assemble__coupling__matrices_a3b3020dd40cd78050744b35f9515b4d8}


Definition at line 6 of file assemble\+\_\+coupling.\+cpp.


\begin{DoxyCode}
7     \{
8         \textcolor{comment}{// Clean up all systems}
9         libMesh::EquationSystems *EqBIGSys = \hyperlink{classcarl_1_1assemble__coupling__matrices_a74638b62015299b30afb23168b141429}{m\_BIG\_EquationSystem}.second;
10         EqBIGSys->clear();
11         \textcolor{keyword}{delete} EqBIGSys;
12         EqBIGSys = NULL;
13         \hyperlink{classcarl_1_1assemble__coupling__matrices_a74638b62015299b30afb23168b141429}{m\_BIG\_EquationSystem}.second = NULL;
14 
15         \textcolor{keywordflow}{while}(!\hyperlink{classcarl_1_1assemble__coupling__matrices_a13fddbcb853df9b7ce1a99062fb9f8b6}{m\_micro\_EquationSystemMap}.empty())
16         \{
17             \hyperlink{classcarl_1_1assemble__coupling__matrices_a2c14330f6dd8399037d78458bb27b4f4}{EqSystem\_iterator} toClean = 
      \hyperlink{classcarl_1_1assemble__coupling__matrices_a13fddbcb853df9b7ce1a99062fb9f8b6}{m\_micro\_EquationSystemMap}.begin();
18 
19             libMesh::EquationSystems *EqSys = toClean->second;
20             EqSys->clear();
21             \textcolor{keyword}{delete} EqSys;
22             EqSys = NULL;
23 
24             \hyperlink{classcarl_1_1assemble__coupling__matrices_a13fddbcb853df9b7ce1a99062fb9f8b6}{m\_micro\_EquationSystemMap}.erase(toClean);
25         \}
26 
27         \textcolor{keywordflow}{if}(\hyperlink{classcarl_1_1assemble__coupling__matrices_aaed7135f088376664521b650c2b25fbd}{m\_bHasDefinedMeshRestrictions})
28         \{
29             libMesh::EquationSystems *EqRBIGSys = \hyperlink{classcarl_1_1assemble__coupling__matrices_ac8e2172182aa563e854e7b693344b301}{m\_R\_BIG\_EquationSystem}.second;
30             EqRBIGSys->clear();
31             \textcolor{keyword}{delete} EqRBIGSys;
32             EqRBIGSys = NULL;
33             \hyperlink{classcarl_1_1assemble__coupling__matrices_ac8e2172182aa563e854e7b693344b301}{m\_R\_BIG\_EquationSystem}.second = NULL;
34 
35             \textcolor{keywordflow}{while}(!\hyperlink{classcarl_1_1assemble__coupling__matrices_a5b7c4f9307a9611926dc1ccf8bb33d4b}{m\_R\_micro\_EquationSystemMap}.empty())
36             \{
37                 \hyperlink{classcarl_1_1assemble__coupling__matrices_a2c14330f6dd8399037d78458bb27b4f4}{EqSystem\_iterator} toClean = 
      \hyperlink{classcarl_1_1assemble__coupling__matrices_a5b7c4f9307a9611926dc1ccf8bb33d4b}{m\_R\_micro\_EquationSystemMap}.begin();
38 
39                 libMesh::EquationSystems *EqSys = toClean->second;
40                 EqSys->clear();
41                 \textcolor{keyword}{delete} EqSys;
42                 EqSys = NULL;
43 
44                 \hyperlink{classcarl_1_1assemble__coupling__matrices_a5b7c4f9307a9611926dc1ccf8bb33d4b}{m\_R\_micro\_EquationSystemMap}.erase(toClean);
45             \}
46         \}
47 
48         \textcolor{keywordflow}{while}(!\hyperlink{classcarl_1_1assemble__coupling__matrices_a6c9fab72397ed371acccbf88fd72665f}{m\_inter\_EquationSystemMap}.empty())
49         \{
50             \hyperlink{classcarl_1_1assemble__coupling__matrices_a2c14330f6dd8399037d78458bb27b4f4}{EqSystem\_iterator} toClean = 
      \hyperlink{classcarl_1_1assemble__coupling__matrices_a6c9fab72397ed371acccbf88fd72665f}{m\_inter\_EquationSystemMap}.begin();
51 
52             libMesh::EquationSystems *EqSys = toClean->second;
53             EqSys->clear();
54             \textcolor{keyword}{delete} EqSys;
55             EqSys = NULL;
56 
57             \hyperlink{classcarl_1_1assemble__coupling__matrices_a6c9fab72397ed371acccbf88fd72665f}{m\_inter\_EquationSystemMap}.erase(toClean);
58         \}
59 
60         \textcolor{keywordflow}{while}(!\hyperlink{classcarl_1_1assemble__coupling__matrices_a9d61d2378c5658d6cfc7fa0d2ef306a5}{m\_mediator\_EquationSystemMap}.empty())
61         \{
62             \hyperlink{classcarl_1_1assemble__coupling__matrices_a2c14330f6dd8399037d78458bb27b4f4}{EqSystem\_iterator} toClean = 
      \hyperlink{classcarl_1_1assemble__coupling__matrices_a9d61d2378c5658d6cfc7fa0d2ef306a5}{m\_mediator\_EquationSystemMap}.begin();
63 
64             libMesh::EquationSystems *EqSys = toClean->second;
65             EqSys->clear();
66             \textcolor{keyword}{delete} EqSys;
67             EqSys = NULL;
68 
69             \hyperlink{classcarl_1_1assemble__coupling__matrices_a9d61d2378c5658d6cfc7fa0d2ef306a5}{m\_mediator\_EquationSystemMap}.erase(toClean);
70         \}
71 
72         \textcolor{keywordflow}{while}(!\hyperlink{classcarl_1_1assemble__coupling__matrices_a73accf79c46d9ceab7f66f0e26c5e677}{m\_couplingMatrixMap\_mediator\_micro}.empty())
73         \{
74             \hyperlink{classcarl_1_1assemble__coupling__matrices_a14c35d63e9e2980a32a6255ca963ab09}{Matrix\_iterator} toClean = 
      \hyperlink{classcarl_1_1assemble__coupling__matrices_a73accf79c46d9ceab7f66f0e26c5e677}{m\_couplingMatrixMap\_mediator\_micro}.begin();
75 
76             libMesh::PetscMatrix<libMesh::Number> *Mat = toClean->second;
77             Mat->clear();
78             \textcolor{keyword}{delete} Mat;
79             Mat = NULL;
80 
81             \hyperlink{classcarl_1_1assemble__coupling__matrices_a73accf79c46d9ceab7f66f0e26c5e677}{m\_couplingMatrixMap\_mediator\_micro}.erase(toClean);
82         \}
83 
84         \textcolor{keywordflow}{while}(!\hyperlink{classcarl_1_1assemble__coupling__matrices_af8127910d360a01b1b9c9878f03282f4}{m\_couplingMatrixMap\_mediator\_BIG}.empty())
85         \{
86             \hyperlink{classcarl_1_1assemble__coupling__matrices_a14c35d63e9e2980a32a6255ca963ab09}{Matrix\_iterator} toClean = 
      \hyperlink{classcarl_1_1assemble__coupling__matrices_af8127910d360a01b1b9c9878f03282f4}{m\_couplingMatrixMap\_mediator\_BIG}.begin();
87 
88             libMesh::PetscMatrix<libMesh::Number> *Mat = toClean->second;
89             Mat->clear();
90             \textcolor{keyword}{delete} Mat;
91             Mat = NULL;
92 
93             \hyperlink{classcarl_1_1assemble__coupling__matrices_af8127910d360a01b1b9c9878f03282f4}{m\_couplingMatrixMap\_mediator\_BIG}.erase(toClean);
94         \}
95 
96         \textcolor{keywordflow}{while}(!\hyperlink{classcarl_1_1assemble__coupling__matrices_a1a838735ff335cdf1d24403ceab3b896}{m\_couplingMatrixMap\_mediator\_mediator}.empty())
97         \{
98             \hyperlink{classcarl_1_1assemble__coupling__matrices_a14c35d63e9e2980a32a6255ca963ab09}{Matrix\_iterator} toClean = 
      \hyperlink{classcarl_1_1assemble__coupling__matrices_a1a838735ff335cdf1d24403ceab3b896}{m\_couplingMatrixMap\_mediator\_mediator}.begin();
99 
100             libMesh::PetscMatrix<libMesh::Number> *Mat = toClean->second;
101             Mat->clear();
102             \textcolor{keyword}{delete} Mat;
103             Mat = NULL;
104 
105             \hyperlink{classcarl_1_1assemble__coupling__matrices_a1a838735ff335cdf1d24403ceab3b896}{m\_couplingMatrixMap\_mediator\_mediator}.erase(toClean);
106         \}
107     \};
\end{DoxyCode}
\hypertarget{classcarl_1_1assemble__coupling__matrices_abfc9a6e9937e7e4ae8ec55675be18e7b}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!get\+\_\+\+B\+I\+G\+\_\+coupling\+\_\+matrix@{get\+\_\+\+B\+I\+G\+\_\+coupling\+\_\+matrix}}
\index{get\+\_\+\+B\+I\+G\+\_\+coupling\+\_\+matrix@{get\+\_\+\+B\+I\+G\+\_\+coupling\+\_\+matrix}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{get\+\_\+\+B\+I\+G\+\_\+coupling\+\_\+matrix(const std\+::string \&name)}]{\setlength{\rightskip}{0pt plus 5cm}lib\+Mesh\+::\+Petsc\+Matrix$<$ lib\+Mesh\+::\+Number $>$ \& carl\+::assemble\+\_\+coupling\+\_\+matrices\+::get\+\_\+\+B\+I\+G\+\_\+coupling\+\_\+matrix (
\begin{DoxyParamCaption}
\item[{const std\+::string \&}]{name}
\end{DoxyParamCaption}
)}\label{classcarl_1_1assemble__coupling__matrices_abfc9a6e9937e7e4ae8ec55675be18e7b}


Definition at line 341 of file assemble\+\_\+coupling.\+cpp.


\begin{DoxyCode}
342     \{
343         \textcolor{keywordflow}{return} * \hyperlink{classcarl_1_1assemble__coupling__matrices_af8127910d360a01b1b9c9878f03282f4}{m\_couplingMatrixMap\_mediator\_BIG}[name];
344     \}
\end{DoxyCode}
\hypertarget{classcarl_1_1assemble__coupling__matrices_a27ee998dbd1a87b1ce4d1e9c9e515e43}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!get\+\_\+lambdas@{get\+\_\+lambdas}}
\index{get\+\_\+lambdas@{get\+\_\+lambdas}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{get\+\_\+lambdas(const unsigned int dim, const lib\+Mesh\+::\+F\+E\+Type \&fe\+\_\+t, const lib\+Mesh\+::\+Elem $\ast$base\+\_\+elem, const std\+::vector$<$ lib\+Mesh\+::\+Point $>$ \&phys\+\_\+points, std\+::vector$<$ lib\+Mesh\+::\+Point $>$ \&ref\+\_\+points, std\+::vector$<$ std\+::vector$<$ lib\+Mesh\+::\+Real $>$ $>$ \&lambda\+\_\+weights)}]{\setlength{\rightskip}{0pt plus 5cm}void carl\+::assemble\+\_\+coupling\+\_\+matrices\+::get\+\_\+lambdas (
\begin{DoxyParamCaption}
\item[{const unsigned int}]{dim, }
\item[{const lib\+Mesh\+::\+F\+E\+Type \&}]{fe\+\_\+t, }
\item[{const lib\+Mesh\+::\+Elem $\ast$}]{base\+\_\+elem, }
\item[{const std\+::vector$<$ lib\+Mesh\+::\+Point $>$ \&}]{phys\+\_\+points, }
\item[{std\+::vector$<$ lib\+Mesh\+::\+Point $>$ \&}]{ref\+\_\+points, }
\item[{std\+::vector$<$ std\+::vector$<$ lib\+Mesh\+::\+Real $>$ $>$ \&}]{lambda\+\_\+weights}
\end{DoxyParamCaption}
)}\label{classcarl_1_1assemble__coupling__matrices_a27ee998dbd1a87b1ce4d1e9c9e515e43}


Definition at line 291 of file assemble\+\_\+coupling.\+cpp.


\begin{DoxyCode}
297     \{
298         \textcolor{comment}{// Test if we are using the correct type!}
299         \hyperlink{common__header_8h_a593ccc80b790b2268653fcf6597bf451}{homemade\_assert\_msg}(base\_elem->type() == libMesh::TET4 || base\_elem->type() == 
      libMesh::HEX8,
300                 \textcolor{stringliteral}{" Only implemented for TET4 or HEX8 elements!"});
301 
302         \hyperlink{common__header_8h_a593ccc80b790b2268653fcf6597bf451}{homemade\_assert\_msg}(dim == 3,
303                 \textcolor{stringliteral}{" Only implemented for 3D!"});
304 
305         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} lambda\_inter\_size = lambda\_weights[0].size();
306         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} lambda\_base\_size  = lambda\_weights.size();
307 
308         \textcolor{comment}{// Set vectors to have same sizes}
309         \textcolor{keywordflow}{if}(phys\_points.size() != ref\_points.size())
310         \{
311             ref\_points.resize( phys\_points.size() );
312         \}
313 
314         \textcolor{comment}{// Convert the points}
315         libMesh::FEInterface::inverse\_map(dim, fe\_t, base\_elem, phys\_points, ref\_points);
316 
317 
318 
319         \textcolor{comment}{// Calculate the lambdas}
320         \textcolor{comment}{// -> lines : DoF from base}
321         \textcolor{comment}{// -> cols  : DoF from inter}
322         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} iii = 0; iii < lambda\_base\_size; ++iii)
323         \{
324             \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} jjj = 0; jjj < lambda\_inter\_size; ++jjj)
325             \{
326                 lambda\_weights[iii][jjj] =
327                         libMesh::FE<3,libMesh::LAGRANGE>::shape(
328                                 base\_elem->type(),
329                                 libMesh::FIRST,
330                                 iii,
331                                 ref\_points[jjj]);
332             \}
333         \}
334     \};
\end{DoxyCode}
\hypertarget{classcarl_1_1assemble__coupling__matrices_af8853c49243dcd7abb0778d260cfbd6e}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!get\+\_\+mediator\+\_\+coupling\+\_\+matrix@{get\+\_\+mediator\+\_\+coupling\+\_\+matrix}}
\index{get\+\_\+mediator\+\_\+coupling\+\_\+matrix@{get\+\_\+mediator\+\_\+coupling\+\_\+matrix}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{get\+\_\+mediator\+\_\+coupling\+\_\+matrix(const std\+::string \&name)}]{\setlength{\rightskip}{0pt plus 5cm}lib\+Mesh\+::\+Petsc\+Matrix$<$ lib\+Mesh\+::\+Number $>$ \& carl\+::assemble\+\_\+coupling\+\_\+matrices\+::get\+\_\+mediator\+\_\+coupling\+\_\+matrix (
\begin{DoxyParamCaption}
\item[{const std\+::string \&}]{name}
\end{DoxyParamCaption}
)}\label{classcarl_1_1assemble__coupling__matrices_af8853c49243dcd7abb0778d260cfbd6e}


Definition at line 346 of file assemble\+\_\+coupling.\+cpp.


\begin{DoxyCode}
347     \{
348         \textcolor{keywordflow}{return} * \hyperlink{classcarl_1_1assemble__coupling__matrices_a1a838735ff335cdf1d24403ceab3b896}{m\_couplingMatrixMap\_mediator\_mediator}[name];
349     \}
\end{DoxyCode}
\hypertarget{classcarl_1_1assemble__coupling__matrices_aaffaa004d87b534c3122f8bdc82820a1}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!get\+\_\+micro\+\_\+coupling\+\_\+matrix@{get\+\_\+micro\+\_\+coupling\+\_\+matrix}}
\index{get\+\_\+micro\+\_\+coupling\+\_\+matrix@{get\+\_\+micro\+\_\+coupling\+\_\+matrix}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{get\+\_\+micro\+\_\+coupling\+\_\+matrix(const std\+::string \&name)}]{\setlength{\rightskip}{0pt plus 5cm}lib\+Mesh\+::\+Petsc\+Matrix$<$ lib\+Mesh\+::\+Number $>$ \& carl\+::assemble\+\_\+coupling\+\_\+matrices\+::get\+\_\+micro\+\_\+coupling\+\_\+matrix (
\begin{DoxyParamCaption}
\item[{const std\+::string \&}]{name}
\end{DoxyParamCaption}
)}\label{classcarl_1_1assemble__coupling__matrices_aaffaa004d87b534c3122f8bdc82820a1}


Definition at line 336 of file assemble\+\_\+coupling.\+cpp.


\begin{DoxyCode}
337     \{
338         \textcolor{keywordflow}{return} * \hyperlink{classcarl_1_1assemble__coupling__matrices_a73accf79c46d9ceab7f66f0e26c5e677}{m\_couplingMatrixMap\_mediator\_micro}[name];
339     \}
\end{DoxyCode}
\hypertarget{classcarl_1_1assemble__coupling__matrices_ace985578e3743b194f9058431735d997}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!prepare\+\_\+coupling\+\_\+preallocation@{prepare\+\_\+coupling\+\_\+preallocation}}
\index{prepare\+\_\+coupling\+\_\+preallocation@{prepare\+\_\+coupling\+\_\+preallocation}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{prepare\+\_\+coupling\+\_\+preallocation(lib\+Mesh\+::\+Petsc\+Matrix$<$ lib\+Mesh\+::\+Number $>$ \&coupling\+\_\+matrix, lib\+Mesh\+\_\+fe\+\_\+addresses\+\_\+3 \&row\+\_\+addresses, lib\+Mesh\+\_\+fe\+\_\+addresses\+\_\+3 \&col\+\_\+addresses, const std\+::unordered\+\_\+multimap$<$ int, int $>$ \&inter\+\_\+table)}]{\setlength{\rightskip}{0pt plus 5cm}void carl\+::assemble\+\_\+coupling\+\_\+matrices\+::prepare\+\_\+coupling\+\_\+preallocation (
\begin{DoxyParamCaption}
\item[{lib\+Mesh\+::\+Petsc\+Matrix$<$ lib\+Mesh\+::\+Number $>$ \&}]{coupling\+\_\+matrix, }
\item[{{\bf lib\+Mesh\+\_\+fe\+\_\+addresses\+\_\+3} \&}]{row\+\_\+addresses, }
\item[{{\bf lib\+Mesh\+\_\+fe\+\_\+addresses\+\_\+3} \&}]{col\+\_\+addresses, }
\item[{const std\+::unordered\+\_\+multimap$<$ int, int $>$ \&}]{inter\+\_\+table}
\end{DoxyParamCaption}
)}\label{classcarl_1_1assemble__coupling__matrices_ace985578e3743b194f9058431735d997}


Definition at line 6 of file assemble\+\_\+functions\+\_\+coupling.\+cpp.


\begin{DoxyCode}
12 \{
13     \textcolor{keyword}{const} libMesh::Parallel::Communicator& WorldComm = row\_addresses.mesh.comm();
14     \textcolor{keywordtype}{int} rank = WorldComm.rank();
15     \textcolor{keywordtype}{int} nodes = WorldComm.size();
16 
17     \textcolor{comment}{// Local and global dimensions setup}
18     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} row\_M = row\_addresses.dof\_map.n\_dofs();
19     \textcolor{keyword}{const} \textcolor{keywordtype}{int} col\_N = col\_addresses.dof\_map.n\_dofs();
20     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} row\_M\_local = row\_addresses.dof\_map.n\_local\_dofs();
21     \textcolor{keyword}{const} \textcolor{keywordtype}{int} col\_N\_local = col\_addresses.dof\_map.n\_local\_dofs();
22 
23     \textcolor{comment}{// Vectors that will be used to calculate the preallocation. There are two}
24     \textcolor{comment}{// "versions": a local one, starting at zero and which will contain this}
25     \textcolor{comment}{// processor's preallocation after syncing, and a global one, which will be}
26     \textcolor{comment}{// send to other processors}
27     std::vector<unsigned int> local\_n\_nz(row\_M\_local,0);
28     std::vector<unsigned int> local\_n\_oz(row\_M\_local,0);
29 
30     \textcolor{comment}{// Local limits of the DoF's}
31     std::vector<int> begin\_row\_DoF(nodes);
32     std::vector<int> end\_row\_DoF(nodes);
33     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} iii = 0; iii < nodes; ++iii)
34     \{
35         begin\_row\_DoF[iii] = row\_addresses.dof\_map.first\_dof(iii);
36         end\_row\_DoF[iii] = row\_addresses.dof\_map.end\_dof(iii);
37     \}
38 
39     std::vector<int> begin\_col\_DoF(nodes);
40     std::vector<int> end\_col\_DoF(nodes);
41     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} iii = 0; iii < nodes; ++iii)
42     \{
43         begin\_col\_DoF[iii] = col\_addresses.dof\_map.first\_dof(iii);
44         end\_col\_DoF[iii] = col\_addresses.dof\_map.end\_dof(iii);
45     \}
46 
47     \textcolor{keywordtype}{int} local\_begin\_row\_DoF = begin\_row\_DoF[rank];
48     \textcolor{keywordtype}{int} local\_end\_row\_DoF = end\_row\_DoF[rank];
49 
50     \textcolor{comment}{// Iterate over the row's mesh cells}
51 
52     \textcolor{keywordtype}{int} row\_mesh\_elem\_idx = 0;
53     \textcolor{keywordtype}{int} dummy\_col\_dof;
54 
55     std::vector<std::vector<int> > to\_add\_per\_proc(row\_M, std::vector<int>(nodes,0));
56 
57     std::vector<int> row\_dof\_indices\_procs;
58     libMesh::MeshBase::const\_element\_iterator it\_row\_elem =
59             row\_addresses.mesh.active\_local\_elements\_begin();
60     \textcolor{keyword}{const} libMesh::MeshBase::const\_element\_iterator     it\_row\_elem\_end =
61             row\_addresses.mesh.active\_local\_elements\_end();
62 
63     \textcolor{comment}{// What the code has to do:}
64     \textcolor{comment}{/*}
65 \textcolor{comment}{     *      - For each element associated to the rows, get the intersecting}
66 \textcolor{comment}{     *        elements and find out which processors own each of its DoFs. Use}
67 \textcolor{comment}{     *        this to populate the "to\_add\_per\_proc" table.}
68 \textcolor{comment}{     *}
69 \textcolor{comment}{     *      - Once it is filled, sync the "to\_add\_per\_proc" between the}
70 \textcolor{comment}{     *        processors.}
71 \textcolor{comment}{     *}
72 \textcolor{comment}{     *      - On each processor, iterate over the local row DoFs and add the}
73 \textcolor{comment}{     *        info from "to\_add\_per\_proc" to either "local\_n\_nz" or "local\_n\_oz",}
74 \textcolor{comment}{     *        depending on the processor.}
75 \textcolor{comment}{     *}
76 \textcolor{comment}{     *      - ... pray that it works?}
77 \textcolor{comment}{     */}
78 
79     std::unordered\_set<int> col\_DoFs\_to\_allocate;
80     col\_DoFs\_to\_allocate.reserve(col\_addresses.mesh.n\_nodes());
81 
82     \textcolor{keywordflow}{for}( ; it\_row\_elem != it\_row\_elem\_end; ++it\_row\_elem )
83     \{
84         \textcolor{comment}{// For each local mediator mesh elements ...}
85         \textcolor{keyword}{const} libMesh::Elem* elem\_mediator = *it\_row\_elem;
86 
87         \textcolor{comment}{// ... extract the element's index ...}
88         row\_mesh\_elem\_idx = elem\_mediator->id();
89 
90         \textcolor{comment}{// ... set its DoFs ...}
91         row\_addresses.set\_DoFs(row\_mesh\_elem\_idx);
92 
93         \textcolor{comment}{// ... clear the col\_DoFs set}
94         col\_DoFs\_to\_allocate.clear();
95 
96         \textcolor{comment}{// ... get the DoFs from the col mesh ...}
97         \textcolor{keyword}{auto} range\_elem\_col\_idx = inter\_table.equal\_range(row\_mesh\_elem\_idx);
98 
99         \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} it = range\_elem\_col\_idx.first; it != range\_elem\_col\_idx.second; ++it)
100         \{
101             col\_addresses.set\_DoFs(it->second);
102 
103             \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} iii = 0; iii < col\_addresses.n\_dofs; ++iii)
104             \{
105                 col\_DoFs\_to\_allocate.insert(col\_addresses.dof\_indices[iii]);
106             \}
107         \}
108 
109         \textcolor{comment}{// ... and finally increase the preallocation}
110         \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} it = col\_DoFs\_to\_allocate.begin(); it != col\_DoFs\_to\_allocate.end(); ++it)
111         \{
112             dummy\_col\_dof = *it;
113 
114             \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} nnn = 0; nnn < nodes; ++nnn)
115             \{
116                 \textcolor{keywordflow}{if}( dummy\_col\_dof > begin\_col\_DoF[nnn] &&
117                     dummy\_col\_dof < end\_col\_DoF[nnn])
118                 \{
119                     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} jjj = 0; jjj < row\_addresses.dof\_indices.size(); ++jjj)
120                     \{
121                         ++to\_add\_per\_proc[row\_addresses.dof\_indices[jjj]][nnn];
122                     \}
123                     \textcolor{keywordflow}{break};
124                 \}
125             \}
126         \}
127     \}
128 
129     \textcolor{comment}{// Guarantee that everyone is in the same page}
130     WorldComm.barrier();
131 
132     \textcolor{comment}{// Do a (lot) of syncs}
133     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} nnn = 0; nnn < nodes; ++nnn)
134     \{
135         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} iii = begin\_row\_DoF[nnn]; iii < end\_row\_DoF[nnn]; ++iii)
136         \{
137             \hyperlink{namespacecarl_a461e9a455e02d991c920b4b56390f326}{MPI\_reduce\_vector}(to\_add\_per\_proc[iii],nnn,WorldComm);
138         \}
139     \}
140 
141     \textcolor{keywordtype}{int} dummy\_total\_nz = 0;
142     \textcolor{keywordtype}{int} dummy\_total\_oz = 0;
143 
144     \textcolor{comment}{// Now, calculate the preallocation}
145     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} iii = local\_begin\_row\_DoF; iii < local\_end\_row\_DoF; ++iii)
146     \{
147         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} nnn = 0; nnn < rank; ++nnn)
148         \{
149             local\_n\_oz[iii - local\_begin\_row\_DoF] += to\_add\_per\_proc[iii][nnn];
150             dummy\_total\_oz += to\_add\_per\_proc[iii][nnn];
151         \}
152 
153         local\_n\_nz[iii - local\_begin\_row\_DoF] += to\_add\_per\_proc[iii][rank];
154         dummy\_total\_nz += to\_add\_per\_proc[iii][rank];
155 
156         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} nnn = rank + 1; nnn < nodes; ++nnn)
157         \{
158             local\_n\_oz[iii - local\_begin\_row\_DoF] += to\_add\_per\_proc[iii][nnn];
159             dummy\_total\_oz += to\_add\_per\_proc[iii][nnn];
160         \}
161     \}
162 
163     dummy\_total\_nz = 0;
164     dummy\_total\_oz = 0;
165 
166     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} iii = local\_begin\_row\_DoF; iii < local\_end\_row\_DoF; ++iii)
167     \{
168         local\_n\_nz[iii - local\_begin\_row\_DoF] = 1.1*local\_n\_nz[iii - local\_begin\_row\_DoF];
169         local\_n\_nz[iii - local\_begin\_row\_DoF] = std::max(static\_cast<unsigned int>(30),local\_n\_nz[iii - 
      local\_begin\_row\_DoF]);
170         local\_n\_nz[iii - local\_begin\_row\_DoF] = std::min(static\_cast<unsigned int>(col\_N\_local),local\_n\_nz[
      iii - local\_begin\_row\_DoF]);
171 
172         local\_n\_oz[iii - local\_begin\_row\_DoF] = 1.1*local\_n\_oz[iii - local\_begin\_row\_DoF];
173         local\_n\_oz[iii - local\_begin\_row\_DoF] = std::max(static\_cast<unsigned int>(10),local\_n\_oz[iii - 
      local\_begin\_row\_DoF]);
174         local\_n\_oz[iii - local\_begin\_row\_DoF] = std::min(static\_cast<unsigned int>(col\_N - col\_N\_local),
      local\_n\_oz[iii - local\_begin\_row\_DoF]);
175 
176         dummy\_total\_nz += local\_n\_nz[iii - local\_begin\_row\_DoF];
177         dummy\_total\_oz += local\_n\_oz[iii - local\_begin\_row\_DoF];
178     \}
179 
180     coupling\_matrix.init(row\_M, col\_N, row\_M\_local, col\_N\_local, local\_n\_nz, local\_n\_oz);
181 \}
\end{DoxyCode}
\hypertarget{classcarl_1_1assemble__coupling__matrices_ad8ae59c24fd6fe18300860f21255e9d6}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!print\+\_\+matrices\+\_\+matlab@{print\+\_\+matrices\+\_\+matlab}}
\index{print\+\_\+matrices\+\_\+matlab@{print\+\_\+matrices\+\_\+matlab}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{print\+\_\+matrices\+\_\+matlab(const std\+::string \&name, const std\+::string \&output\+Root=""coupling"")}]{\setlength{\rightskip}{0pt plus 5cm}void carl\+::assemble\+\_\+coupling\+\_\+matrices\+::print\+\_\+matrices\+\_\+matlab (
\begin{DoxyParamCaption}
\item[{const std\+::string \&}]{name, }
\item[{const std\+::string \&}]{output\+Root = {\ttfamily \char`\"{}coupling\char`\"{}}}
\end{DoxyParamCaption}
)}\label{classcarl_1_1assemble__coupling__matrices_ad8ae59c24fd6fe18300860f21255e9d6}


Definition at line 375 of file assemble\+\_\+coupling.\+cpp.


\begin{DoxyCode}
376     \{
377         libMesh::PetscMatrix<libMesh::Number>& CouplingTestMatrix\_BIG =
378                                 * \hyperlink{classcarl_1_1assemble__coupling__matrices_af8127910d360a01b1b9c9878f03282f4}{m\_couplingMatrixMap\_mediator\_BIG}[name];
379         libMesh::PetscMatrix<libMesh::Number>& CouplingTestMatrix\_micro=
380                                 * \hyperlink{classcarl_1_1assemble__coupling__matrices_a73accf79c46d9ceab7f66f0e26c5e677}{m\_couplingMatrixMap\_mediator\_micro}[name
      ];
381         libMesh::PetscMatrix<libMesh::Number>& CouplingTestMatrix\_mediator=
382                                 * \hyperlink{classcarl_1_1assemble__coupling__matrices_a1a838735ff335cdf1d24403ceab3b896}{m\_couplingMatrixMap\_mediator\_mediator}
      [name];
383 
384 \textcolor{comment}{// Print MatLab debugging output? Variable defined at "carl\_headers.h"}
385 \textcolor{preprocessor}{#ifdef PRINT\_MATLAB\_DEBUG}
386         CouplingTestMatrix\_BIG.print\_matlab(outputRoot + \textcolor{stringliteral}{"/coupling\_matrix\_macro.m"});
387         CouplingTestMatrix\_micro.print\_matlab(outputRoot + \textcolor{stringliteral}{"/coupling\_matrix\_micro.m"});
388         CouplingTestMatrix\_mediator.print\_matlab(outputRoot + \textcolor{stringliteral}{"/coupling\_matrix\_mediator.m"});
389 \textcolor{preprocessor}{#endif}
390     \}
\end{DoxyCode}
\hypertarget{classcarl_1_1assemble__coupling__matrices_ad96032fec0168b1e000a4e8784d65474}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!print\+\_\+matrix\+\_\+\+B\+I\+G\+\_\+info@{print\+\_\+matrix\+\_\+\+B\+I\+G\+\_\+info}}
\index{print\+\_\+matrix\+\_\+\+B\+I\+G\+\_\+info@{print\+\_\+matrix\+\_\+\+B\+I\+G\+\_\+info}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{print\+\_\+matrix\+\_\+\+B\+I\+G\+\_\+info(const std\+::string \&name)}]{\setlength{\rightskip}{0pt plus 5cm}void carl\+::assemble\+\_\+coupling\+\_\+matrices\+::print\+\_\+matrix\+\_\+\+B\+I\+G\+\_\+info (
\begin{DoxyParamCaption}
\item[{const std\+::string \&}]{name}
\end{DoxyParamCaption}
)}\label{classcarl_1_1assemble__coupling__matrices_ad96032fec0168b1e000a4e8784d65474}


Definition at line 359 of file assemble\+\_\+coupling.\+cpp.


\begin{DoxyCode}
360     \{
361         libMesh::PetscMatrix<libMesh::Number>& CouplingTestMatrix =
362                             * \hyperlink{classcarl_1_1assemble__coupling__matrices_af8127910d360a01b1b9c9878f03282f4}{m\_couplingMatrixMap\_mediator\_BIG}[name];
363         std::cout << \textcolor{stringliteral}{"| Restrict - Macro matrix -> "} << name << std::endl;
364         \hyperlink{namespacecarl_acf412e8527bfd67e81b80b71bf3bb479}{print\_matrix}(CouplingTestMatrix);
365     \}
\end{DoxyCode}
\hypertarget{classcarl_1_1assemble__coupling__matrices_a7af032fd8eb921ad1c7bf9e4ca49ac79}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!print\+\_\+matrix\+\_\+mediator\+\_\+info@{print\+\_\+matrix\+\_\+mediator\+\_\+info}}
\index{print\+\_\+matrix\+\_\+mediator\+\_\+info@{print\+\_\+matrix\+\_\+mediator\+\_\+info}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{print\+\_\+matrix\+\_\+mediator\+\_\+info(const std\+::string \&name)}]{\setlength{\rightskip}{0pt plus 5cm}void carl\+::assemble\+\_\+coupling\+\_\+matrices\+::print\+\_\+matrix\+\_\+mediator\+\_\+info (
\begin{DoxyParamCaption}
\item[{const std\+::string \&}]{name}
\end{DoxyParamCaption}
)}\label{classcarl_1_1assemble__coupling__matrices_a7af032fd8eb921ad1c7bf9e4ca49ac79}


Definition at line 367 of file assemble\+\_\+coupling.\+cpp.


\begin{DoxyCode}
368     \{
369         libMesh::PetscMatrix<libMesh::Number>& CouplingTestMatrix =
370                             * \hyperlink{classcarl_1_1assemble__coupling__matrices_a1a838735ff335cdf1d24403ceab3b896}{m\_couplingMatrixMap\_mediator\_mediator}[
      name];
371         std::cout << \textcolor{stringliteral}{"| Restrict - Restrict matrix -> "} << name << std::endl;
372         \hyperlink{namespacecarl_acf412e8527bfd67e81b80b71bf3bb479}{print\_matrix}(CouplingTestMatrix);
373     \}
\end{DoxyCode}
\hypertarget{classcarl_1_1assemble__coupling__matrices_a775d91b1cca6f22f8f68e7e3b17a1f88}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!print\+\_\+matrix\+\_\+micro\+\_\+info@{print\+\_\+matrix\+\_\+micro\+\_\+info}}
\index{print\+\_\+matrix\+\_\+micro\+\_\+info@{print\+\_\+matrix\+\_\+micro\+\_\+info}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{print\+\_\+matrix\+\_\+micro\+\_\+info(const std\+::string \&name)}]{\setlength{\rightskip}{0pt plus 5cm}void carl\+::assemble\+\_\+coupling\+\_\+matrices\+::print\+\_\+matrix\+\_\+micro\+\_\+info (
\begin{DoxyParamCaption}
\item[{const std\+::string \&}]{name}
\end{DoxyParamCaption}
)}\label{classcarl_1_1assemble__coupling__matrices_a775d91b1cca6f22f8f68e7e3b17a1f88}


Definition at line 351 of file assemble\+\_\+coupling.\+cpp.


\begin{DoxyCode}
352     \{
353         libMesh::PetscMatrix<libMesh::Number>& CouplingTestMatrix =
354                             * \hyperlink{classcarl_1_1assemble__coupling__matrices_a73accf79c46d9ceab7f66f0e26c5e677}{m\_couplingMatrixMap\_mediator\_micro}[name];
355         std::cout << \textcolor{stringliteral}{"| Restrict - Micro matrix -> "} << name << std::endl;
356         \hyperlink{namespacecarl_acf412e8527bfd67e81b80b71bf3bb479}{print\_matrix}(CouplingTestMatrix);
357     \}
\end{DoxyCode}
\hypertarget{classcarl_1_1assemble__coupling__matrices_a806aca42c4648a67da472798c9064585}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!print\+\_\+\+P\+E\+T\+S\+C\+\_\+matrices@{print\+\_\+\+P\+E\+T\+S\+C\+\_\+matrices}}
\index{print\+\_\+\+P\+E\+T\+S\+C\+\_\+matrices@{print\+\_\+\+P\+E\+T\+S\+C\+\_\+matrices}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{print\+\_\+\+P\+E\+T\+S\+C\+\_\+matrices(const std\+::string \&name, const std\+::string \&output\+Root=""coupling"")}]{\setlength{\rightskip}{0pt plus 5cm}void carl\+::assemble\+\_\+coupling\+\_\+matrices\+::print\+\_\+\+P\+E\+T\+S\+C\+\_\+matrices (
\begin{DoxyParamCaption}
\item[{const std\+::string \&}]{name, }
\item[{const std\+::string \&}]{output\+Root = {\ttfamily \char`\"{}coupling\char`\"{}}}
\end{DoxyParamCaption}
)}\label{classcarl_1_1assemble__coupling__matrices_a806aca42c4648a67da472798c9064585}


Definition at line 392 of file assemble\+\_\+coupling.\+cpp.


\begin{DoxyCode}
393     \{
394         libMesh::PetscMatrix<libMesh::Number>& CouplingTestMatrix\_BIG =
395                                 * \hyperlink{classcarl_1_1assemble__coupling__matrices_af8127910d360a01b1b9c9878f03282f4}{m\_couplingMatrixMap\_mediator\_BIG}[name];
396         libMesh::PetscMatrix<libMesh::Number>& CouplingTestMatrix\_micro=
397                                 * \hyperlink{classcarl_1_1assemble__coupling__matrices_a73accf79c46d9ceab7f66f0e26c5e677}{m\_couplingMatrixMap\_mediator\_micro}[name
      ];
398         libMesh::PetscMatrix<libMesh::Number>& CouplingTestMatrix\_mediator=
399                                 * \hyperlink{classcarl_1_1assemble__coupling__matrices_a1a838735ff335cdf1d24403ceab3b896}{m\_couplingMatrixMap\_mediator\_mediator}
      [name];
400 
401         \hyperlink{namespacecarl_a431936850bf5712121d8399ddbd76aa8}{write\_PETSC\_matrix}(CouplingTestMatrix\_BIG.mat(), outputRoot + \textcolor{stringliteral}{"
      /coupling\_matrix\_macro.petscmat"},\hyperlink{classcarl_1_1assemble__coupling__matrices_a8a2164781f1a5f75ab1a5c7c4744f2f4}{m\_comm}->rank(),\hyperlink{classcarl_1_1assemble__coupling__matrices_a8a2164781f1a5f75ab1a5c7c4744f2f4}{m\_comm}->get());
402         \hyperlink{namespacecarl_a431936850bf5712121d8399ddbd76aa8}{write\_PETSC\_matrix}(CouplingTestMatrix\_micro.mat(), outputRoot + \textcolor{stringliteral}{"
      /coupling\_matrix\_micro.petscmat"},\hyperlink{classcarl_1_1assemble__coupling__matrices_a8a2164781f1a5f75ab1a5c7c4744f2f4}{m\_comm}->rank(),\hyperlink{classcarl_1_1assemble__coupling__matrices_a8a2164781f1a5f75ab1a5c7c4744f2f4}{m\_comm}->get());
403         \hyperlink{namespacecarl_a431936850bf5712121d8399ddbd76aa8}{write\_PETSC\_matrix}(CouplingTestMatrix\_mediator.mat(), outputRoot + \textcolor{stringliteral}{"
      /coupling\_matrix\_mediator.petscmat"},\hyperlink{classcarl_1_1assemble__coupling__matrices_a8a2164781f1a5f75ab1a5c7c4744f2f4}{m\_comm}->rank(),\hyperlink{classcarl_1_1assemble__coupling__matrices_a8a2164781f1a5f75ab1a5c7c4744f2f4}{m\_comm}->get());
404     \}
\end{DoxyCode}
\hypertarget{classcarl_1_1assemble__coupling__matrices_a4ae5318b482918a2894a7fbcfde71b47}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!set\+\_\+\+B\+I\+G\+\_\+\+Equation\+System@{set\+\_\+\+B\+I\+G\+\_\+\+Equation\+System}}
\index{set\+\_\+\+B\+I\+G\+\_\+\+Equation\+System@{set\+\_\+\+B\+I\+G\+\_\+\+Equation\+System}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{set\+\_\+\+B\+I\+G\+\_\+\+Equation\+System(const std\+::string \&name, lib\+Mesh\+::\+Mesh\+Base \&\+B\+I\+G\+Mesh)}]{\setlength{\rightskip}{0pt plus 5cm}lib\+Mesh\+::\+Equation\+Systems \& carl\+::assemble\+\_\+coupling\+\_\+matrices\+::set\+\_\+\+B\+I\+G\+\_\+\+Equation\+System (
\begin{DoxyParamCaption}
\item[{const std\+::string \&}]{name, }
\item[{lib\+Mesh\+::\+Mesh\+Base \&}]{B\+I\+G\+Mesh}
\end{DoxyParamCaption}
)}\label{classcarl_1_1assemble__coupling__matrices_a4ae5318b482918a2894a7fbcfde71b47}


Definition at line 109 of file assemble\+\_\+coupling.\+cpp.


\begin{DoxyCode}
110     \{
111         libMesh::EquationSystems* EqSystemPtr = \textcolor{keyword}{new} libMesh::EquationSystems(
112                 BIGMesh);
113 
114         \hyperlink{classcarl_1_1assemble__coupling__matrices_a74638b62015299b30afb23168b141429}{m\_BIG\_EquationSystem}.first = name;
115         \hyperlink{classcarl_1_1assemble__coupling__matrices_a74638b62015299b30afb23168b141429}{m\_BIG\_EquationSystem}.second = EqSystemPtr;
116 
117         \textcolor{keywordflow}{return} *EqSystemPtr;
118     \};
\end{DoxyCode}
\hypertarget{classcarl_1_1assemble__coupling__matrices_a7f5ae4da1fe905fb90e9016f1dbb2fea}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!set\+\_\+corrected\+\_\+shape\+\_\+gradients@{set\+\_\+corrected\+\_\+shape\+\_\+gradients}}
\index{set\+\_\+corrected\+\_\+shape\+\_\+gradients@{set\+\_\+corrected\+\_\+shape\+\_\+gradients}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{set\+\_\+corrected\+\_\+shape\+\_\+gradients(const std\+::vector$<$ std\+::vector$<$ lib\+Mesh\+::\+Real $>$ $>$ \&lambda\+\_\+weights, const std\+::vector$<$ std\+::vector$<$ lib\+Mesh\+::\+Real\+Gradient $>$ $>$ \&phi\+\_\+inter, std\+::vector$<$ std\+::vector$<$ lib\+Mesh\+::\+Real\+Gradient $>$ $>$ \&phi\+\_\+corrected)}]{\setlength{\rightskip}{0pt plus 5cm}void carl\+::assemble\+\_\+coupling\+\_\+matrices\+::set\+\_\+corrected\+\_\+shape\+\_\+gradients (
\begin{DoxyParamCaption}
\item[{const std\+::vector$<$ std\+::vector$<$ lib\+Mesh\+::\+Real $>$ $>$ \&}]{lambda\+\_\+weights, }
\item[{const std\+::vector$<$ std\+::vector$<$ lib\+Mesh\+::\+Real\+Gradient $>$ $>$ \&}]{phi\+\_\+inter, }
\item[{std\+::vector$<$ std\+::vector$<$ lib\+Mesh\+::\+Real\+Gradient $>$ $>$ \&}]{phi\+\_\+corrected}
\end{DoxyParamCaption}
)}\label{classcarl_1_1assemble__coupling__matrices_a7f5ae4da1fe905fb90e9016f1dbb2fea}


Definition at line 250 of file assemble\+\_\+coupling.\+cpp.


\begin{DoxyCode}
253     \{
254         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} lambda\_corr\_size   = lambda\_weights.size();
255         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} lambda\_inter\_size  = lambda\_weights[0].size();
256 
257         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} phi\_inter\_dof      = dphi\_inter.size();
258         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} phi\_inter\_qp       = dphi\_inter[0].size();
259 
260         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} phi\_corrected\_dof      = dphi\_corrected.size();
261         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} phi\_corrected\_qp       = dphi\_corrected[0].size();
262 
263         \textcolor{comment}{/*}
264 \textcolor{comment}{        *       lambda  : [ n\_dofs\_corr ] x [ n\_dofs\_inter ]}
265 \textcolor{comment}{        *       inter   : [ n\_dofs\_inter ] x [ n\_qp ]}
266 \textcolor{comment}{        *       corr    : [ n\_dofs\_corr ] x [ n\_qp ]}
267 \textcolor{comment}{        */}
268 
269         \hyperlink{common__header_8h_a593ccc80b790b2268653fcf6597bf451}{homemade\_assert\_msg}(phi\_inter\_qp == phi\_corrected\_qp,
270                         \textcolor{stringliteral}{" Different numbers of quadrature points!"});
271         \hyperlink{common__header_8h_a593ccc80b790b2268653fcf6597bf451}{homemade\_assert\_msg}(lambda\_corr\_size == phi\_corrected\_dof,
272                         \textcolor{stringliteral}{" Incompatible corrected shape table and barycentric coordinates!"});
273         \hyperlink{common__header_8h_a593ccc80b790b2268653fcf6597bf451}{homemade\_assert\_msg}(lambda\_inter\_size == phi\_inter\_dof,
274                         \textcolor{stringliteral}{" Incompatible intersection shape table and barycentric coordinates!"});
275 
276         \textcolor{comment}{// phi\_A,i (qp) = l\_i,1 * phi\_I,1 (qp) + l\_i,2 * phi\_I,2 (qp) ...}
277         \textcolor{comment}{//              = sum [ l\_i,j * phi\_I,j (qp) ]}
278         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} qp = 0; qp < phi\_inter\_qp; ++qp)
279         \{
280             \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} iii = 0; iii < phi\_corrected\_dof; ++iii)
281             \{
282                 dphi\_corrected[iii][qp] = 0;
283                 \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} jjj = 0; jjj < phi\_inter\_dof; ++jjj)
284                 \{
285                     dphi\_corrected[iii][qp] += lambda\_weights[iii][jjj]*dphi\_inter[jjj][qp];
286                 \}
287             \}
288         \}
289     \};
\end{DoxyCode}
\hypertarget{classcarl_1_1assemble__coupling__matrices_a677a3527845b3503cc5f5daa8de63864}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!set\+\_\+corrected\+\_\+shapes@{set\+\_\+corrected\+\_\+shapes}}
\index{set\+\_\+corrected\+\_\+shapes@{set\+\_\+corrected\+\_\+shapes}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{set\+\_\+corrected\+\_\+shapes(const std\+::vector$<$ std\+::vector$<$ lib\+Mesh\+::\+Real $>$ $>$ \&lambda\+\_\+weights, const std\+::vector$<$ std\+::vector$<$ lib\+Mesh\+::\+Real $>$ $>$ \&phi\+\_\+inter, std\+::vector$<$ std\+::vector$<$ lib\+Mesh\+::\+Real $>$ $>$ \&phi\+\_\+corrected)}]{\setlength{\rightskip}{0pt plus 5cm}void carl\+::assemble\+\_\+coupling\+\_\+matrices\+::set\+\_\+corrected\+\_\+shapes (
\begin{DoxyParamCaption}
\item[{const std\+::vector$<$ std\+::vector$<$ lib\+Mesh\+::\+Real $>$ $>$ \&}]{lambda\+\_\+weights, }
\item[{const std\+::vector$<$ std\+::vector$<$ lib\+Mesh\+::\+Real $>$ $>$ \&}]{phi\+\_\+inter, }
\item[{std\+::vector$<$ std\+::vector$<$ lib\+Mesh\+::\+Real $>$ $>$ \&}]{phi\+\_\+corrected}
\end{DoxyParamCaption}
)}\label{classcarl_1_1assemble__coupling__matrices_a677a3527845b3503cc5f5daa8de63864}


Definition at line 209 of file assemble\+\_\+coupling.\+cpp.


\begin{DoxyCode}
212     \{
213         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} lambda\_corr\_size   = lambda\_weights.size();
214         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} lambda\_inter\_size  = lambda\_weights[0].size();
215 
216         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} phi\_inter\_dof      = phi\_inter.size();
217         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} phi\_inter\_qp       = phi\_inter[0].size();
218 
219         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} phi\_corrected\_dof      = phi\_corrected.size();
220         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} phi\_corrected\_qp       = phi\_corrected[0].size();
221 
222         \textcolor{comment}{/*}
223 \textcolor{comment}{        *       lambda  : [ n\_dofs\_corr ] x [ n\_dofs\_inter ]}
224 \textcolor{comment}{        *       inter   : [ n\_dofs\_inter ] x [ n\_qp ]}
225 \textcolor{comment}{        *       corr    : [ n\_dofs\_corr ] x [ n\_qp ]}
226 \textcolor{comment}{        */}
227 
228         \hyperlink{common__header_8h_a593ccc80b790b2268653fcf6597bf451}{homemade\_assert\_msg}(phi\_inter\_qp == phi\_corrected\_qp,
229                         \textcolor{stringliteral}{" Different numbers of quadrature points!"});
230         \hyperlink{common__header_8h_a593ccc80b790b2268653fcf6597bf451}{homemade\_assert\_msg}(lambda\_corr\_size == phi\_corrected\_dof,
231                         \textcolor{stringliteral}{" Incompatible corrected shape table and barycentric coordinates!"});
232         \hyperlink{common__header_8h_a593ccc80b790b2268653fcf6597bf451}{homemade\_assert\_msg}(lambda\_inter\_size == phi\_inter\_dof,
233                         \textcolor{stringliteral}{" Incompatible intersection shape table and barycentric coordinates!"});
234 
235         \textcolor{comment}{// phi\_A,i (qp) = l\_i,1 * phi\_I,1 (qp) + l\_i,2 * phi\_I,2 (qp) ...}
236         \textcolor{comment}{//              = sum [ l\_i,j * phi\_I,j (qp) ]}
237         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} qp = 0; qp < phi\_inter\_qp; ++qp)
238         \{
239             \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} iii = 0; iii < phi\_corrected\_dof; ++iii)
240             \{
241                 phi\_corrected[iii][qp] = 0;
242                 \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} jjj = 0; jjj < phi\_inter\_dof; ++jjj)
243                 \{
244                     phi\_corrected[iii][qp] += lambda\_weights[iii][jjj]*phi\_inter[jjj][qp];
245                 \}
246             \}
247         \}
248     \}
\end{DoxyCode}
\hypertarget{classcarl_1_1assemble__coupling__matrices_a68f48738c5ee19dc3b23f7c7b5645f84}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!set\+\_\+coupling\+\_\+parameters@{set\+\_\+coupling\+\_\+parameters}}
\index{set\+\_\+coupling\+\_\+parameters@{set\+\_\+coupling\+\_\+parameters}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{set\+\_\+coupling\+\_\+parameters(const std\+::string \&name, double coupling\+\_\+rigidity, double coupling\+\_\+width)}]{\setlength{\rightskip}{0pt plus 5cm}void carl\+::assemble\+\_\+coupling\+\_\+matrices\+::set\+\_\+coupling\+\_\+parameters (
\begin{DoxyParamCaption}
\item[{const std\+::string \&}]{name, }
\item[{double}]{coupling\+\_\+rigidity, }
\item[{double}]{coupling\+\_\+width}
\end{DoxyParamCaption}
)}\label{classcarl_1_1assemble__coupling__matrices_a68f48738c5ee19dc3b23f7c7b5645f84}


Set physical parameters. 



Definition at line 202 of file assemble\+\_\+coupling.\+cpp.


\begin{DoxyCode}
204     \{
205         \hyperlink{classcarl_1_1assemble__coupling__matrices_a2133e2d98a47de9569137f31d69c58ee}{m\_coupling\_rigidityMap}[name] = coupling\_rigidity;
206         \hyperlink{classcarl_1_1assemble__coupling__matrices_a72f1024c5634b4e31b8583ee60bb14bc}{m\_coupling\_widthMap}[name] = coupling\_width;
207     \};
\end{DoxyCode}
\hypertarget{classcarl_1_1assemble__coupling__matrices_a612773fda111eb80066b78cba261487e}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!set\+\_\+\+Restricted\+\_\+\+B\+I\+G\+\_\+\+Equation\+System@{set\+\_\+\+Restricted\+\_\+\+B\+I\+G\+\_\+\+Equation\+System}}
\index{set\+\_\+\+Restricted\+\_\+\+B\+I\+G\+\_\+\+Equation\+System@{set\+\_\+\+Restricted\+\_\+\+B\+I\+G\+\_\+\+Equation\+System}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{set\+\_\+\+Restricted\+\_\+\+B\+I\+G\+\_\+\+Equation\+System(const std\+::string \&name, lib\+Mesh\+::\+Mesh\+Base \&\+R\+\_\+\+B\+I\+G\+Mesh)}]{\setlength{\rightskip}{0pt plus 5cm}lib\+Mesh\+::\+Equation\+Systems \& carl\+::assemble\+\_\+coupling\+\_\+matrices\+::set\+\_\+\+Restricted\+\_\+\+B\+I\+G\+\_\+\+Equation\+System (
\begin{DoxyParamCaption}
\item[{const std\+::string \&}]{name, }
\item[{lib\+Mesh\+::\+Mesh\+Base \&}]{R\+\_\+\+B\+I\+G\+Mesh}
\end{DoxyParamCaption}
)}\label{classcarl_1_1assemble__coupling__matrices_a612773fda111eb80066b78cba261487e}


Definition at line 120 of file assemble\+\_\+coupling.\+cpp.


\begin{DoxyCode}
121     \{
122         \hyperlink{classcarl_1_1assemble__coupling__matrices_aaed7135f088376664521b650c2b25fbd}{m\_bHasDefinedMeshRestrictions} = \textcolor{keyword}{true};
123         libMesh::EquationSystems* EqSystemPtr = \textcolor{keyword}{new} libMesh::EquationSystems(
124                 R\_BIGMesh);
125 
126         \hyperlink{classcarl_1_1assemble__coupling__matrices_ac8e2172182aa563e854e7b693344b301}{m\_R\_BIG\_EquationSystem}.first = name;
127         \hyperlink{classcarl_1_1assemble__coupling__matrices_ac8e2172182aa563e854e7b693344b301}{m\_R\_BIG\_EquationSystem}.second = EqSystemPtr;
128 
129         \textcolor{keywordflow}{return} *EqSystemPtr;
130     \};
\end{DoxyCode}
\hypertarget{classcarl_1_1assemble__coupling__matrices_a85dee9db3e55f42fdc51bb2408e09d1a}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!use\+\_\+\+H1\+\_\+coupling@{use\+\_\+\+H1\+\_\+coupling}}
\index{use\+\_\+\+H1\+\_\+coupling@{use\+\_\+\+H1\+\_\+coupling}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{use\+\_\+\+H1\+\_\+coupling(std\+::string name)}]{\setlength{\rightskip}{0pt plus 5cm}void carl\+::assemble\+\_\+coupling\+\_\+matrices\+::use\+\_\+\+H1\+\_\+coupling (
\begin{DoxyParamCaption}
\item[{std\+::string}]{name}
\end{DoxyParamCaption}
)}\label{classcarl_1_1assemble__coupling__matrices_a85dee9db3e55f42fdc51bb2408e09d1a}


Definition at line 406 of file assemble\+\_\+coupling.\+cpp.


\begin{DoxyCode}
407     \{
408         \hyperlink{classcarl_1_1assemble__coupling__matrices_a9e3bf058bd10aacb63ebbab34fe37628}{m\_bUseH1Coupling}[name] = \textcolor{keyword}{true};
409     \};
\end{DoxyCode}
\hypertarget{classcarl_1_1assemble__coupling__matrices_a7640410cbb9780403d643cb8c42275f7}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!use\+\_\+\+L2\+\_\+coupling@{use\+\_\+\+L2\+\_\+coupling}}
\index{use\+\_\+\+L2\+\_\+coupling@{use\+\_\+\+L2\+\_\+coupling}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{use\+\_\+\+L2\+\_\+coupling(std\+::string name)}]{\setlength{\rightskip}{0pt plus 5cm}void carl\+::assemble\+\_\+coupling\+\_\+matrices\+::use\+\_\+\+L2\+\_\+coupling (
\begin{DoxyParamCaption}
\item[{std\+::string}]{name}
\end{DoxyParamCaption}
)}\label{classcarl_1_1assemble__coupling__matrices_a7640410cbb9780403d643cb8c42275f7}


Definition at line 411 of file assemble\+\_\+coupling.\+cpp.


\begin{DoxyCode}
412     \{
413         \hyperlink{classcarl_1_1assemble__coupling__matrices_a9e3bf058bd10aacb63ebbab34fe37628}{m\_bUseH1Coupling}[name] = \textcolor{keyword}{false};
414     \};
\end{DoxyCode}


\subsection{Member Data Documentation}
\hypertarget{classcarl_1_1assemble__coupling__matrices_a3fa42a0aa231b0feaa3b27a6f0fb11e1}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!m\+\_\+b\+Has\+Assembled\+\_\+\+B\+I\+G@{m\+\_\+b\+Has\+Assembled\+\_\+\+B\+I\+G}}
\index{m\+\_\+b\+Has\+Assembled\+\_\+\+B\+I\+G@{m\+\_\+b\+Has\+Assembled\+\_\+\+B\+I\+G}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{m\+\_\+b\+Has\+Assembled\+\_\+\+B\+I\+G}]{\setlength{\rightskip}{0pt plus 5cm}bool carl\+::assemble\+\_\+coupling\+\_\+matrices\+::m\+\_\+b\+Has\+Assembled\+\_\+\+B\+I\+G\hspace{0.3cm}{\ttfamily [protected]}}\label{classcarl_1_1assemble__coupling__matrices_a3fa42a0aa231b0feaa3b27a6f0fb11e1}


Definition at line 272 of file assemble\+\_\+coupling.\+h.

\hypertarget{classcarl_1_1assemble__coupling__matrices_a84f7dc1f435eabc152f0df50d7650269}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!m\+\_\+b\+Has\+Assembled\+\_\+micro@{m\+\_\+b\+Has\+Assembled\+\_\+micro}}
\index{m\+\_\+b\+Has\+Assembled\+\_\+micro@{m\+\_\+b\+Has\+Assembled\+\_\+micro}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{m\+\_\+b\+Has\+Assembled\+\_\+micro}]{\setlength{\rightskip}{0pt plus 5cm}std\+::map$<$std\+::string, bool$>$ carl\+::assemble\+\_\+coupling\+\_\+matrices\+::m\+\_\+b\+Has\+Assembled\+\_\+micro\hspace{0.3cm}{\ttfamily [protected]}}\label{classcarl_1_1assemble__coupling__matrices_a84f7dc1f435eabc152f0df50d7650269}


Definition at line 271 of file assemble\+\_\+coupling.\+h.

\hypertarget{classcarl_1_1assemble__coupling__matrices_aaed7135f088376664521b650c2b25fbd}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!m\+\_\+b\+Has\+Defined\+Mesh\+Restrictions@{m\+\_\+b\+Has\+Defined\+Mesh\+Restrictions}}
\index{m\+\_\+b\+Has\+Defined\+Mesh\+Restrictions@{m\+\_\+b\+Has\+Defined\+Mesh\+Restrictions}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{m\+\_\+b\+Has\+Defined\+Mesh\+Restrictions}]{\setlength{\rightskip}{0pt plus 5cm}bool carl\+::assemble\+\_\+coupling\+\_\+matrices\+::m\+\_\+b\+Has\+Defined\+Mesh\+Restrictions\hspace{0.3cm}{\ttfamily [protected]}}\label{classcarl_1_1assemble__coupling__matrices_aaed7135f088376664521b650c2b25fbd}


Definition at line 274 of file assemble\+\_\+coupling.\+h.

\hypertarget{classcarl_1_1assemble__coupling__matrices_a74638b62015299b30afb23168b141429}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!m\+\_\+\+B\+I\+G\+\_\+\+Equation\+System@{m\+\_\+\+B\+I\+G\+\_\+\+Equation\+System}}
\index{m\+\_\+\+B\+I\+G\+\_\+\+Equation\+System@{m\+\_\+\+B\+I\+G\+\_\+\+Equation\+System}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{m\+\_\+\+B\+I\+G\+\_\+\+Equation\+System}]{\setlength{\rightskip}{0pt plus 5cm}std\+::pair$<$std\+::string, lib\+Mesh\+::\+Equation\+Systems$\ast$$>$ carl\+::assemble\+\_\+coupling\+\_\+matrices\+::m\+\_\+\+B\+I\+G\+\_\+\+Equation\+System\hspace{0.3cm}{\ttfamily [protected]}}\label{classcarl_1_1assemble__coupling__matrices_a74638b62015299b30afb23168b141429}


Definition at line 255 of file assemble\+\_\+coupling.\+h.

\hypertarget{classcarl_1_1assemble__coupling__matrices_a9e3bf058bd10aacb63ebbab34fe37628}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!m\+\_\+b\+Use\+H1\+Coupling@{m\+\_\+b\+Use\+H1\+Coupling}}
\index{m\+\_\+b\+Use\+H1\+Coupling@{m\+\_\+b\+Use\+H1\+Coupling}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{m\+\_\+b\+Use\+H1\+Coupling}]{\setlength{\rightskip}{0pt plus 5cm}std\+::map$<$std\+::string, bool$>$ carl\+::assemble\+\_\+coupling\+\_\+matrices\+::m\+\_\+b\+Use\+H1\+Coupling\hspace{0.3cm}{\ttfamily [protected]}}\label{classcarl_1_1assemble__coupling__matrices_a9e3bf058bd10aacb63ebbab34fe37628}


Definition at line 270 of file assemble\+\_\+coupling.\+h.

\hypertarget{classcarl_1_1assemble__coupling__matrices_a96baf5080d2887764b52d64d56dffce2}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!m\+\_\+b\+Use\+Null\+Space\+\_\+\+B\+I\+G@{m\+\_\+b\+Use\+Null\+Space\+\_\+\+B\+I\+G}}
\index{m\+\_\+b\+Use\+Null\+Space\+\_\+\+B\+I\+G@{m\+\_\+b\+Use\+Null\+Space\+\_\+\+B\+I\+G}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{m\+\_\+b\+Use\+Null\+Space\+\_\+\+B\+I\+G}]{\setlength{\rightskip}{0pt plus 5cm}bool carl\+::assemble\+\_\+coupling\+\_\+matrices\+::m\+\_\+b\+Use\+Null\+Space\+\_\+\+B\+I\+G\hspace{0.3cm}{\ttfamily [protected]}}\label{classcarl_1_1assemble__coupling__matrices_a96baf5080d2887764b52d64d56dffce2}


Definition at line 273 of file assemble\+\_\+coupling.\+h.

\hypertarget{classcarl_1_1assemble__coupling__matrices_a8a2164781f1a5f75ab1a5c7c4744f2f4}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!m\+\_\+comm@{m\+\_\+comm}}
\index{m\+\_\+comm@{m\+\_\+comm}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{m\+\_\+comm}]{\setlength{\rightskip}{0pt plus 5cm}const lib\+Mesh\+::\+Parallel\+::\+Communicator$\ast$ carl\+::assemble\+\_\+coupling\+\_\+matrices\+::m\+\_\+comm\hspace{0.3cm}{\ttfamily [protected]}}\label{classcarl_1_1assemble__coupling__matrices_a8a2164781f1a5f75ab1a5c7c4744f2f4}


Definition at line 252 of file assemble\+\_\+coupling.\+h.

\hypertarget{classcarl_1_1assemble__coupling__matrices_a2133e2d98a47de9569137f31d69c58ee}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!m\+\_\+coupling\+\_\+rigidity\+Map@{m\+\_\+coupling\+\_\+rigidity\+Map}}
\index{m\+\_\+coupling\+\_\+rigidity\+Map@{m\+\_\+coupling\+\_\+rigidity\+Map}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{m\+\_\+coupling\+\_\+rigidity\+Map}]{\setlength{\rightskip}{0pt plus 5cm}std\+::map$<$std\+::string, double$>$ carl\+::assemble\+\_\+coupling\+\_\+matrices\+::m\+\_\+coupling\+\_\+rigidity\+Map\hspace{0.3cm}{\ttfamily [protected]}}\label{classcarl_1_1assemble__coupling__matrices_a2133e2d98a47de9569137f31d69c58ee}


Definition at line 277 of file assemble\+\_\+coupling.\+h.

\hypertarget{classcarl_1_1assemble__coupling__matrices_a72f1024c5634b4e31b8583ee60bb14bc}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!m\+\_\+coupling\+\_\+width\+Map@{m\+\_\+coupling\+\_\+width\+Map}}
\index{m\+\_\+coupling\+\_\+width\+Map@{m\+\_\+coupling\+\_\+width\+Map}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{m\+\_\+coupling\+\_\+width\+Map}]{\setlength{\rightskip}{0pt plus 5cm}std\+::map$<$std\+::string, double$>$ carl\+::assemble\+\_\+coupling\+\_\+matrices\+::m\+\_\+coupling\+\_\+width\+Map\hspace{0.3cm}{\ttfamily [protected]}}\label{classcarl_1_1assemble__coupling__matrices_a72f1024c5634b4e31b8583ee60bb14bc}


Definition at line 278 of file assemble\+\_\+coupling.\+h.

\hypertarget{classcarl_1_1assemble__coupling__matrices_af8127910d360a01b1b9c9878f03282f4}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!m\+\_\+coupling\+Matrix\+Map\+\_\+mediator\+\_\+\+B\+I\+G@{m\+\_\+coupling\+Matrix\+Map\+\_\+mediator\+\_\+\+B\+I\+G}}
\index{m\+\_\+coupling\+Matrix\+Map\+\_\+mediator\+\_\+\+B\+I\+G@{m\+\_\+coupling\+Matrix\+Map\+\_\+mediator\+\_\+\+B\+I\+G}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{m\+\_\+coupling\+Matrix\+Map\+\_\+mediator\+\_\+\+B\+I\+G}]{\setlength{\rightskip}{0pt plus 5cm}std\+::map$<$std\+::string, lib\+Mesh\+::\+Petsc\+Matrix$<$lib\+Mesh\+::\+Number$>$$\ast$$>$ carl\+::assemble\+\_\+coupling\+\_\+matrices\+::m\+\_\+coupling\+Matrix\+Map\+\_\+mediator\+\_\+\+B\+I\+G\hspace{0.3cm}{\ttfamily [protected]}}\label{classcarl_1_1assemble__coupling__matrices_af8127910d360a01b1b9c9878f03282f4}


Definition at line 266 of file assemble\+\_\+coupling.\+h.

\hypertarget{classcarl_1_1assemble__coupling__matrices_a1a838735ff335cdf1d24403ceab3b896}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!m\+\_\+coupling\+Matrix\+Map\+\_\+mediator\+\_\+mediator@{m\+\_\+coupling\+Matrix\+Map\+\_\+mediator\+\_\+mediator}}
\index{m\+\_\+coupling\+Matrix\+Map\+\_\+mediator\+\_\+mediator@{m\+\_\+coupling\+Matrix\+Map\+\_\+mediator\+\_\+mediator}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{m\+\_\+coupling\+Matrix\+Map\+\_\+mediator\+\_\+mediator}]{\setlength{\rightskip}{0pt plus 5cm}std\+::map$<$std\+::string, lib\+Mesh\+::\+Petsc\+Matrix$<$lib\+Mesh\+::\+Number$>$$\ast$$>$ carl\+::assemble\+\_\+coupling\+\_\+matrices\+::m\+\_\+coupling\+Matrix\+Map\+\_\+mediator\+\_\+mediator\hspace{0.3cm}{\ttfamily [protected]}}\label{classcarl_1_1assemble__coupling__matrices_a1a838735ff335cdf1d24403ceab3b896}


Definition at line 267 of file assemble\+\_\+coupling.\+h.

\hypertarget{classcarl_1_1assemble__coupling__matrices_a73accf79c46d9ceab7f66f0e26c5e677}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!m\+\_\+coupling\+Matrix\+Map\+\_\+mediator\+\_\+micro@{m\+\_\+coupling\+Matrix\+Map\+\_\+mediator\+\_\+micro}}
\index{m\+\_\+coupling\+Matrix\+Map\+\_\+mediator\+\_\+micro@{m\+\_\+coupling\+Matrix\+Map\+\_\+mediator\+\_\+micro}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{m\+\_\+coupling\+Matrix\+Map\+\_\+mediator\+\_\+micro}]{\setlength{\rightskip}{0pt plus 5cm}std\+::map$<$std\+::string, lib\+Mesh\+::\+Petsc\+Matrix$<$lib\+Mesh\+::\+Number$>$$\ast$$>$ carl\+::assemble\+\_\+coupling\+\_\+matrices\+::m\+\_\+coupling\+Matrix\+Map\+\_\+mediator\+\_\+micro\hspace{0.3cm}{\ttfamily [protected]}}\label{classcarl_1_1assemble__coupling__matrices_a73accf79c46d9ceab7f66f0e26c5e677}


Definition at line 265 of file assemble\+\_\+coupling.\+h.

\hypertarget{classcarl_1_1assemble__coupling__matrices_a6c9fab72397ed371acccbf88fd72665f}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!m\+\_\+inter\+\_\+\+Equation\+System\+Map@{m\+\_\+inter\+\_\+\+Equation\+System\+Map}}
\index{m\+\_\+inter\+\_\+\+Equation\+System\+Map@{m\+\_\+inter\+\_\+\+Equation\+System\+Map}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{m\+\_\+inter\+\_\+\+Equation\+System\+Map}]{\setlength{\rightskip}{0pt plus 5cm}std\+::map$<$std\+::string, lib\+Mesh\+::\+Equation\+Systems$\ast$$>$ carl\+::assemble\+\_\+coupling\+\_\+matrices\+::m\+\_\+inter\+\_\+\+Equation\+System\+Map\hspace{0.3cm}{\ttfamily [protected]}}\label{classcarl_1_1assemble__coupling__matrices_a6c9fab72397ed371acccbf88fd72665f}


Definition at line 261 of file assemble\+\_\+coupling.\+h.

\hypertarget{classcarl_1_1assemble__coupling__matrices_a9d61d2378c5658d6cfc7fa0d2ef306a5}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!m\+\_\+mediator\+\_\+\+Equation\+System\+Map@{m\+\_\+mediator\+\_\+\+Equation\+System\+Map}}
\index{m\+\_\+mediator\+\_\+\+Equation\+System\+Map@{m\+\_\+mediator\+\_\+\+Equation\+System\+Map}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{m\+\_\+mediator\+\_\+\+Equation\+System\+Map}]{\setlength{\rightskip}{0pt plus 5cm}std\+::map$<$std\+::string, lib\+Mesh\+::\+Equation\+Systems$\ast$$>$ carl\+::assemble\+\_\+coupling\+\_\+matrices\+::m\+\_\+mediator\+\_\+\+Equation\+System\+Map\hspace{0.3cm}{\ttfamily [protected]}}\label{classcarl_1_1assemble__coupling__matrices_a9d61d2378c5658d6cfc7fa0d2ef306a5}


Definition at line 262 of file assemble\+\_\+coupling.\+h.

\hypertarget{classcarl_1_1assemble__coupling__matrices_a13fddbcb853df9b7ce1a99062fb9f8b6}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!m\+\_\+micro\+\_\+\+Equation\+System\+Map@{m\+\_\+micro\+\_\+\+Equation\+System\+Map}}
\index{m\+\_\+micro\+\_\+\+Equation\+System\+Map@{m\+\_\+micro\+\_\+\+Equation\+System\+Map}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{m\+\_\+micro\+\_\+\+Equation\+System\+Map}]{\setlength{\rightskip}{0pt plus 5cm}std\+::map$<$std\+::string, lib\+Mesh\+::\+Equation\+Systems$\ast$$>$ carl\+::assemble\+\_\+coupling\+\_\+matrices\+::m\+\_\+micro\+\_\+\+Equation\+System\+Map\hspace{0.3cm}{\ttfamily [protected]}}\label{classcarl_1_1assemble__coupling__matrices_a13fddbcb853df9b7ce1a99062fb9f8b6}


Definition at line 258 of file assemble\+\_\+coupling.\+h.

\hypertarget{classcarl_1_1assemble__coupling__matrices_ac8e2172182aa563e854e7b693344b301}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!m\+\_\+\+R\+\_\+\+B\+I\+G\+\_\+\+Equation\+System@{m\+\_\+\+R\+\_\+\+B\+I\+G\+\_\+\+Equation\+System}}
\index{m\+\_\+\+R\+\_\+\+B\+I\+G\+\_\+\+Equation\+System@{m\+\_\+\+R\+\_\+\+B\+I\+G\+\_\+\+Equation\+System}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{m\+\_\+\+R\+\_\+\+B\+I\+G\+\_\+\+Equation\+System}]{\setlength{\rightskip}{0pt plus 5cm}std\+::pair$<$std\+::string, lib\+Mesh\+::\+Equation\+Systems$\ast$$>$ carl\+::assemble\+\_\+coupling\+\_\+matrices\+::m\+\_\+\+R\+\_\+\+B\+I\+G\+\_\+\+Equation\+System\hspace{0.3cm}{\ttfamily [protected]}}\label{classcarl_1_1assemble__coupling__matrices_ac8e2172182aa563e854e7b693344b301}


Definition at line 256 of file assemble\+\_\+coupling.\+h.

\hypertarget{classcarl_1_1assemble__coupling__matrices_a5b7c4f9307a9611926dc1ccf8bb33d4b}{}\index{carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}!m\+\_\+\+R\+\_\+micro\+\_\+\+Equation\+System\+Map@{m\+\_\+\+R\+\_\+micro\+\_\+\+Equation\+System\+Map}}
\index{m\+\_\+\+R\+\_\+micro\+\_\+\+Equation\+System\+Map@{m\+\_\+\+R\+\_\+micro\+\_\+\+Equation\+System\+Map}!carl\+::assemble\+\_\+coupling\+\_\+matrices@{carl\+::assemble\+\_\+coupling\+\_\+matrices}}
\subsubsection[{m\+\_\+\+R\+\_\+micro\+\_\+\+Equation\+System\+Map}]{\setlength{\rightskip}{0pt plus 5cm}std\+::map$<$std\+::string, lib\+Mesh\+::\+Equation\+Systems$\ast$$>$ carl\+::assemble\+\_\+coupling\+\_\+matrices\+::m\+\_\+\+R\+\_\+micro\+\_\+\+Equation\+System\+Map\hspace{0.3cm}{\ttfamily [protected]}}\label{classcarl_1_1assemble__coupling__matrices_a5b7c4f9307a9611926dc1ccf8bb33d4b}


Definition at line 259 of file assemble\+\_\+coupling.\+h.



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
/\+Users/breubreubreu/\+Programming/\+C\+Arl/\+Cpp/src/include/\hyperlink{assemble__coupling_8h}{assemble\+\_\+coupling.\+h}\item 
/\+Users/breubreubreu/\+Programming/\+C\+Arl/\+Cpp/src/common/coupling\+\_\+matrix/\hyperlink{assemble__coupling_8cpp}{assemble\+\_\+coupling.\+cpp}\item 
/\+Users/breubreubreu/\+Programming/\+C\+Arl/\+Cpp/src/common/coupling\+\_\+matrix/\hyperlink{assemble__functions__coupling_8cpp}{assemble\+\_\+functions\+\_\+coupling.\+cpp}\end{DoxyCompactItemize}
