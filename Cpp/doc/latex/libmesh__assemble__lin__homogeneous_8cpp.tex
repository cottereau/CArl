\hypertarget{libmesh__assemble__lin__homogeneous_8cpp}{}\section{/\+Users/breubreubreu/\+Programming/\+C\+Arl/\+Cpp/src/execs/ext\+\_\+solver\+\_\+libmesh/ext\+\_\+solver\+\_\+libmesh\+\_\+common/\+N\+O\+T\+\_\+\+R\+E\+A\+D\+Y\+\_\+\+Y\+E\+T/libmesh\+\_\+assemble\+\_\+lin\+\_\+homogeneous.cpp File Reference}
\label{libmesh__assemble__lin__homogeneous_8cpp}\index{/\+Users/breubreubreu/\+Programming/\+C\+Arl/\+Cpp/src/execs/ext\+\_\+solver\+\_\+libmesh/ext\+\_\+solver\+\_\+libmesh\+\_\+common/\+N\+O\+T\+\_\+\+R\+E\+A\+D\+Y\+\_\+\+Y\+E\+T/libmesh\+\_\+assemble\+\_\+lin\+\_\+homogeneous.\+cpp@{/\+Users/breubreubreu/\+Programming/\+C\+Arl/\+Cpp/src/execs/ext\+\_\+solver\+\_\+libmesh/ext\+\_\+solver\+\_\+libmesh\+\_\+common/\+N\+O\+T\+\_\+\+R\+E\+A\+D\+Y\+\_\+\+Y\+E\+T/libmesh\+\_\+assemble\+\_\+lin\+\_\+homogeneous.\+cpp}}
{\ttfamily \#include \char`\"{}libmesh\+\_\+assemble\+\_\+lin\+\_\+homogeneous.\+h\char`\"{}}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{libmesh__assemble__lin__homogeneous_8cpp_a3c04138a5bfe5d72780bb7e82a18e627}{main} (int argc, char $\ast$$\ast$argv)
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{libmesh__assemble__lin__homogeneous_8cpp_a3c04138a5bfe5d72780bb7e82a18e627}{}\index{libmesh\+\_\+assemble\+\_\+lin\+\_\+homogeneous.\+cpp@{libmesh\+\_\+assemble\+\_\+lin\+\_\+homogeneous.\+cpp}!main@{main}}
\index{main@{main}!libmesh\+\_\+assemble\+\_\+lin\+\_\+homogeneous.\+cpp@{libmesh\+\_\+assemble\+\_\+lin\+\_\+homogeneous.\+cpp}}
\subsubsection[{main(int argc, char $\ast$$\ast$argv)}]{\setlength{\rightskip}{0pt plus 5cm}int main (
\begin{DoxyParamCaption}
\item[{int}]{argc, }
\item[{char $\ast$$\ast$}]{argv}
\end{DoxyParamCaption}
)}\label{libmesh__assemble__lin__homogeneous_8cpp_a3c04138a5bfe5d72780bb7e82a18e627}


Definition at line 3 of file libmesh\+\_\+assemble\+\_\+lin\+\_\+homogeneous.\+cpp.


\begin{DoxyCode}
3                                 \{
4 
5     \textcolor{comment}{// [USER] Fixed boudary}
6     \hyperlink{ext__solver__libmesh__enums_8h_aa97ba4cfa58a6195444e6787a97757ef}{boundary\_id\_cube} fixed\_bound\_id = \hyperlink{ext__solver__libmesh__enums_8h_aa97ba4cfa58a6195444e6787a97757efa4ebfde8f7a29f6160bd733c093a6074b}{boundary\_id\_cube::MIN\_X};
7     
8     \textcolor{comment}{// --- Initialize libMesh}
9     libMesh::LibMeshInit init(argc, argv);
10 
11     \textcolor{comment}{// Do performance log?}
12     \textcolor{keyword}{const} \textcolor{keywordtype}{bool} MASTER\_bPerfLog\_carl\_libmesh = \textcolor{keyword}{true};
13     libMesh::PerfLog perf\_log(\textcolor{stringliteral}{"Main program"}, MASTER\_bPerfLog\_carl\_libmesh);
14 
15     \textcolor{comment}{// libMesh's C++ / MPI communicator wrapper}
16     libMesh::Parallel::Communicator& WorldComm = init.comm();
17 
18     \textcolor{comment}{// Number of processors and processor rank.}
19     \textcolor{keywordtype}{int} rank = WorldComm.rank();
20     \textcolor{keywordtype}{int} nodes = WorldComm.size();
21 
22     \textcolor{comment}{// --- Set up inputs}
23 
24     \textcolor{comment}{// Command line parser}
25     GetPot command\_line(argc, argv);
26 
27     \textcolor{comment}{// File parser}
28     GetPot field\_parser;
29 
30     \textcolor{comment}{// If there is an input file, parse it to get the parameters. Else, parse the command line}
31     std::string input\_filename;
32     \textcolor{keywordflow}{if} (command\_line.search(2, \textcolor{stringliteral}{"--inputfile"}, \textcolor{stringliteral}{"-i"})) \{
33         input\_filename = command\_line.next(input\_filename);
34         field\_parser.parse\_input\_file(input\_filename, \textcolor{stringliteral}{"#"}, \textcolor{stringliteral}{"\(\backslash\)n"}, \textcolor{stringliteral}{" \(\backslash\)t\(\backslash\)n"});
35     \} \textcolor{keywordflow}{else} \{
36         field\_parser = command\_line;
37     \}
38 
39     \hyperlink{structlibmesh__assemble__input__params}{libmesh\_assemble\_input\_params} input\_params;
40     \hyperlink{namespacecarl_a902f88f3c52c6fc9c974bc99832e78a7}{get\_input\_params}(field\_parser, input\_params);
41 
42     \textcolor{comment}{// Check libMesh installation dimension}
43     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} dim = 3;
44 
45     libmesh\_example\_requires(dim == LIBMESH\_DIM, \textcolor{stringliteral}{"3D support"});
46 
47     \textcolor{comment}{// --- Declare the three meshes to be intersected}
48 
49     \textcolor{comment}{// - Parallelized meshes: A, B, mediator and weight}
50     perf\_log.push(\textcolor{stringliteral}{"Meshes - Parallel"},\textcolor{stringliteral}{"Read files:"});
51     libMesh::Mesh system\_mesh(WorldComm, dim);
52     system\_mesh.read(input\_params.\hyperlink{structlibmesh__assemble__input__params_aaacb1a941decf01232ab3c5bd9b3bacf}{mesh\_file});
53     system\_mesh.prepare\_for\_use();
54 
55     libMesh::Mesh mesh\_weight(WorldComm, dim);
56     mesh\_weight.allow\_renumbering(\textcolor{keyword}{false});
57     mesh\_weight.read(input\_params.\hyperlink{structlibmesh__assemble__input__params_abac50ee0db80bff6bb89d017d1fdc27b}{mesh\_weight\_file});
58     mesh\_weight.prepare\_for\_use();
59 
60     perf\_log.pop(\textcolor{stringliteral}{"Meshes - Parallel"},\textcolor{stringliteral}{"Read files:"});
61 
62     \textcolor{comment}{// --- Generate the equation systems}
63     perf\_log.push(\textcolor{stringliteral}{"System setup:"});
64 
65     libMesh::EquationSystems& equation\_systems = libMesh::EquationSystems(system\_mesh);
66 
67     \textcolor{comment}{// Add linear elasticity system}
68     libMesh::LinearImplicitSystem& elasticity\_system
69                                         = \hyperlink{_c_arl__assemble__coupling_8cpp_a1fab87d9dc5c891ae8234cec6cf73491}{add\_elasticity}(equation\_systems);
70 
71     \textcolor{comment}{// Set clamped border}
72     \hyperlink{common__assemble__functions__elasticity__3_d_8cpp_a2ab22af687ba4728815bcf71500f2b8e}{set\_clamped\_border}(elasticity\_system, fixed\_bound\_id);
73 
74 \textcolor{comment}{//  // [MACRO] Build stress system}
75 \textcolor{comment}{//  libMesh::ExplicitSystem& stress\_system\_BIG}
76 \textcolor{comment}{//                                      = add\_stress(equation\_systems\_BIG);}
77 
78 \textcolor{comment}{//  equation\_systems\_BIG.init();}
79 
80 \textcolor{comment}{//  perf\_log.pop("Macro system","System initialization:");}
81 
82 \textcolor{comment}{//  // - Build the micro system}
83 
84 \textcolor{comment}{//  perf\_log.push("Micro system","System initialization:");}
85 \textcolor{comment}{//  libMesh::EquationSystems& equation\_systems\_micro =}
86 \textcolor{comment}{//                  CoupledTest.add\_micro\_EquationSystem<libMesh::PetscMatrix<libMesh::Number>
       >("MicroSys", mesh\_micro);}
87 
88 \textcolor{comment}{//  // [MICRO] Set up the physical properties}
89 \textcolor{comment}{//  libMesh::LinearImplicitSystem& elasticity\_system\_micro}
90 \textcolor{comment}{//                                      = add\_elasticity(equation\_systems\_micro);}
91 
92 \textcolor{comment}{//  // [MICRO] Build stress system}
93 \textcolor{comment}{//  libMesh::ExplicitSystem& stress\_system\_micro}
94 \textcolor{comment}{//                                      = add\_stress(equation\_systems\_micro);}
95 
96 \textcolor{comment}{//  equation\_systems\_micro.init();}
97 \textcolor{comment}{//  perf\_log.pop("Micro system","System initialization:");}
98 
99 \textcolor{comment}{//  // - Build the RESTRICTED BIG system}
100 \textcolor{comment}{//  perf\_log.push("RESTRICTED macro system","System initialization:");}
101 \textcolor{comment}{//  libMesh::EquationSystems& equation\_systems\_R\_BIG =}
102 \textcolor{comment}{//                  CoupledTest.set\_Restricted\_BIG\_EquationSystem("BigSys", mesh\_R\_BIG);}
103 
104 \textcolor{comment}{//  // [R. MACRO] Set up the physical properties}
105 \textcolor{comment}{//  libMesh::ExplicitSystem& elasticity\_system\_R\_BIG}
106 \textcolor{comment}{//                                      = add\_explicit\_elasticity(equation\_systems\_R\_BIG);}
107 
108 \textcolor{comment}{//  carl::reduced\_system\_init(elasticity\_system\_R\_BIG);}
109 
110 \textcolor{comment}{//  perf\_log.pop("RESTRICTED macro system","System initialization:");}
111 
112 \textcolor{comment}{//  // - Build the RESTRICTED micro system}
113 
114 \textcolor{comment}{//  perf\_log.push("RESTRICTED micro system","System initialization:");}
115 \textcolor{comment}{//  libMesh::EquationSystems& equation\_systems\_R\_micro =}
116 \textcolor{comment}{//                  CoupledTest.add\_Restricted\_micro\_EquationSystem("MicroSys", mesh\_R\_micro);}
117 
118 \textcolor{comment}{//  // [R. MICRO] Set up the physical properties}
119 \textcolor{comment}{//  libMesh::ExplicitSystem& elasticity\_system\_R\_micro}
120 \textcolor{comment}{//                                      = add\_explicit\_elasticity(equation\_systems\_R\_micro);}
121 
122 \textcolor{comment}{//  carl::reduced\_system\_init(elasticity\_system\_R\_micro);}
123 \textcolor{comment}{//  perf\_log.pop("RESTRICTED micro system","System initialization:");}
124 
125 \textcolor{comment}{//  // - Build the mediator system}
126 
127 \textcolor{comment}{//  perf\_log.push("Mediator system","System initialization:");}
128 \textcolor{comment}{//  libMesh::EquationSystems& equation\_systems\_mediator =}
129 \textcolor{comment}{//                  CoupledTest.add\_mediator\_EquationSystem("MediatorSys", mesh\_mediator);}
130 
131 \textcolor{comment}{//  libMesh::LinearImplicitSystem& elasticity\_system\_mediator}
132 \textcolor{comment}{//                                      = add\_elasticity(equation\_systems\_mediator);}
133 
134 \textcolor{comment}{//  equation\_systems\_mediator.init();}
135 
136 \textcolor{comment}{//  WorldComm.barrier();}
137 
138 \textcolor{comment}{//  perf\_log.pop("Mediator system","System initialization:");}
139 
140 \textcolor{comment}{//  // - Build the dummy inter system}
141 
142 \textcolor{comment}{//  perf\_log.push("Intersection system","System initialization:");}
143 \textcolor{comment}{//  libMesh::ExplicitSystem& elasticity\_system\_inter}
144 \textcolor{comment}{//                                      = add\_explicit\_elasticity(equation\_systems\_inter);}
145 
146 \textcolor{comment}{//  carl::reduced\_system\_init(elasticity\_system\_inter);}
147 
148 \textcolor{comment}{//  WorldComm.barrier();}
149 
150 \textcolor{comment}{//  perf\_log.pop("Intersection system","System initialization:");}
151 
152 \textcolor{comment}{//  perf\_log.push("Physical properties","System initialization:");}
153 
154 \textcolor{comment}{//  // --- Set the physical parameters}
155 \textcolor{comment}{//  double BIG\_E = 0;}
156 \textcolor{comment}{//  double BIG\_Mu = 0;}
157 
158 \textcolor{comment}{//  double coupling\_const = -1;}
159 
160 \textcolor{comment}{//  // Anisotropic properties for the micro system}
161 \textcolor{comment}{//  carl::anisotropic\_elasticity\_tensor\_cubic\_sym
       anisotropy\_data(equation\_systems\_micro,input\_params.physical\_params\_file,BIG\_E,BIG\_Mu);}
162 
163 \textcolor{comment}{//  // Homogeneous properties for the macro system}
164 \textcolor{comment}{//  set\_constant\_physical\_properties(equation\_systems\_BIG,BIG\_E,BIG\_Mu);}
165 
166 \textcolor{comment}{//  perf\_log.pop("Physical properties","System initialization:");}
167 
168 \textcolor{comment}{//  // --- Set the coupling matrices}
169 \textcolor{comment}{//  perf\_log.push("Set coupling matrices");}
170 \textcolor{comment}{//  coupling\_const = BIG\_E;}
171 
172 \textcolor{comment}{//  // Set parameters}
173 \textcolor{comment}{//  CoupledTest.set\_coupling\_parameters("MicroSys",coupling\_const,input\_params.mean\_distance);}
174 
175 \textcolor{comment}{//  // Use H1 norm}
176 \textcolor{comment}{//  CoupledTest.use\_H1\_coupling("MicroSys");}
177 
178 \textcolor{comment}{//  // Assemble!}
179 \textcolor{comment}{//  CoupledTest.assemble\_coupling\_elasticity\_3D\_parallel("BigSys","MicroSys",}
180 \textcolor{comment}{//          "InterSys","MediatorSys",}
181 \textcolor{comment}{//          mesh\_R\_BIG, mesh\_R\_micro,}
182 \textcolor{comment}{//          local\_intersection\_pairs\_map,}
183 \textcolor{comment}{//          local\_intersection\_restricted\_pairs\_map,}
184 \textcolor{comment}{//          local\_intersection\_meshI\_to\_inter\_map,}
185 \textcolor{comment}{//          inter\_mediator\_BIG,}
186 \textcolor{comment}{//          inter\_mediator\_micro);}
187 
188 \textcolor{comment}{//  // Print some info}
189 \textcolor{comment}{//  std::cout << std::endl;}
190 \textcolor{comment}{//  std::cout << "| ---> Constants " << std::endl;}
191 \textcolor{comment}{//  std::cout << "| Macro :" << std::endl;}
192 \textcolor{comment}{//  std::cout << "|    E            : " << BIG\_E << std::endl;}
193 \textcolor{comment}{//  std::cout << "|    Mu (lamba\_2) : " << BIG\_Mu << std::endl;}
194 \textcolor{comment}{//  std::cout << "|    lambda\_1     : " << eval\_lambda\_1(BIG\_E,BIG\_Mu) << std::endl;}
195 \textcolor{comment}{//  std::cout << "| Coupling :" << std::endl;}
196 \textcolor{comment}{//  std::cout << "|    kappa        : " << coupling\_const << std::endl;}
197 \textcolor{comment}{//  std::cout << "|    e            : " << input\_params.mean\_distance << std::endl;}
198 
199 \textcolor{comment}{//  switch(input\_params.solver\_type)}
200 \textcolor{comment}{//  \{}
201 \textcolor{comment}{//      case carl::LATIN\_MODIFIED\_STIFFNESS:}
202 \textcolor{comment}{//      case carl::LATIN\_ORIGINAL\_STIFFNESS:}
203 \textcolor{comment}{//      \{}
204 \textcolor{comment}{//          std::cout << "| LATIN :" << std::endl;}
205 \textcolor{comment}{//          std::cout << "|    k\_dA, k\_dB   : " << input\_params.k\_dA << " " << input\_params.k\_dB <<
       std::endl;}
206 \textcolor{comment}{//          std::cout << "|    k\_cA, k\_cB   : " << input\_params.k\_cA << " " << input\_params.k\_cB <<
       std::endl;}
207 \textcolor{comment}{//          break;}
208 \textcolor{comment}{//      \}}
209 \textcolor{comment}{//      case carl::CG:}
210 \textcolor{comment}{//      \{}
211 \textcolor{comment}{//          break;}
212 \textcolor{comment}{//      \}}
213 \textcolor{comment}{//  \}}
214 \textcolor{comment}{//  perf\_log.pop("Set coupling matrices");}
215     
216 \textcolor{comment}{//  std::cout << "| restart file    : " << input\_params.coupled\_restart\_file\_base << "*" << std::endl;}
217 
218 \textcolor{comment}{//  std::cout << std::endl << "| --> Testing the solver " << std::endl << std::endl;}
219 \textcolor{comment}{//  perf\_log.push("Set up","Coupled Solver:");}
220 
221 \textcolor{comment}{//  // --- Set restart files}
222 \textcolor{comment}{//  if(input\_params.b\_PrintRestartFiles || input\_params.b\_UseRestartFiles)}
223 \textcolor{comment}{//  \{}
224 \textcolor{comment}{//      CoupledTest.set\_restart(    input\_params.b\_UseRestartFiles,}
225 \textcolor{comment}{//              input\_params.b\_PrintRestartFiles,}
226 \textcolor{comment}{//              input\_params.coupled\_restart\_file\_base);}
227 \textcolor{comment}{//  \}}
228 \textcolor{comment}{//  std::cout << std::endl << "| --> Setting the solver " << std::endl << std::endl;}
229 
230 \textcolor{comment}{//  // --- Set up the coupled solver!}
231 \textcolor{comment}{//  switch(input\_params.solver\_type)}
232 \textcolor{comment}{//  \{}
233 \textcolor{comment}{//      case carl::LATIN\_MODIFIED\_STIFFNESS:}
234 \textcolor{comment}{//      case carl::LATIN\_ORIGINAL\_STIFFNESS:}
235 \textcolor{comment}{//      \{}
236 \textcolor{comment}{//          CoupledTest.set\_LATIN\_solver(   "MicroSys","Elasticity",}
237 \textcolor{comment}{//                                          assemble\_elasticity\_with\_weight,}
238 \textcolor{comment}{//                                          assemble\_elasticity\_anisotropic\_with\_weight,}
239 \textcolor{comment}{//                                          anisotropy\_data,}
240 \textcolor{comment}{//                                          input\_params.k\_dA, input\_params.k\_dB, input\_params.k\_cA,
       input\_params.k\_cB,}
241 \textcolor{comment}{//                                          input\_params.LATIN\_eps, input\_params.LATIN\_conv\_max,
       input\_params.LATIN\_relax);}
242 \textcolor{comment}{//          break;}
243 \textcolor{comment}{//      \}}
244 \textcolor{comment}{//      case carl::CG:}
245 \textcolor{comment}{//      \{}
246 \textcolor{comment}{//          CoupledTest.use\_null\_space\_micro("MicroSys",true);}
247 \textcolor{comment}{//          CoupledTest.set\_cg\_preconditioner\_type(input\_params.CG\_precond\_type);}
248 \textcolor{comment}{//          CoupledTest.set\_CG\_solver(  "MicroSys","Elasticity",}
249 \textcolor{comment}{//                                          assemble\_elasticity\_with\_weight,}
250 \textcolor{comment}{//                                          assemble\_elasticity\_anisotropic\_with\_weight,}
251 \textcolor{comment}{//                                          anisotropy\_data,}
252 \textcolor{comment}{//                                          
      input\_params.CG\_coupled\_conv\_abs,input\_params.CG\_coupled\_conv\_rel,}
253 \textcolor{comment}{//                                          input\_params.CG\_coupled\_conv\_max,input\_params.CG\_coupled\_div,}
254 \textcolor{comment}{//                                          input\_params.CG\_coupled\_conv\_corr);}
255 \textcolor{comment}{//          break;}
256 \textcolor{comment}{//      \}}
257 \textcolor{comment}{//  \}}
258 \textcolor{comment}{//  perf\_log.pop("Set up","Coupled Solver:");}
259 
260 
261 \textcolor{comment}{//  // --- Solve !}
262 \textcolor{comment}{//  perf\_log.push("Solve","Coupled Solver:");}
263 \textcolor{comment}{//  CoupledTest.solve("MicroSys","Elasticity",input\_params.coupled\_convergence\_output);}
264 \textcolor{comment}{//  perf\_log.pop("Solve","Coupled Solver:");}
265 
266 \textcolor{comment}{//  // --- Calculate stress}
267 \textcolor{comment}{//  perf\_log.push("Compute stress - micro","Output:");}
268 \textcolor{comment}{//  compute\_stresses(equation\_systems\_micro);}
269 \textcolor{comment}{//  perf\_log.pop("Compute stress - micro","Output:");}
270 
271 \textcolor{comment}{//  perf\_log.push("Compute stress - macro","Output:");}
272 \textcolor{comment}{//  compute\_stresses(equation\_systems\_BIG);}
273 \textcolor{comment}{//  perf\_log.pop("Compute stress - macro","Output:");}
274 
275 \textcolor{comment}{//  // --- Export solution}
276 \textcolor{comment}{// #ifdef LIBMESH\_HAVE\_EXODUS\_API}
277 \textcolor{comment}{//  if(input\_params.b\_PrintOutput)}
278 \textcolor{comment}{//  \{}
279 \textcolor{comment}{//      perf\_log.push("Save output","Output:");}
280 \textcolor{comment}{//      libMesh::ExodusII\_IO exo\_io\_micro(mesh\_micro, /*single\_precision=*/true);}
281 
282 \textcolor{comment}{//      std::set<std::string> system\_names\_micro;}
283 \textcolor{comment}{//      system\_names\_micro.insert("Elasticity");}
284 \textcolor{comment}{//      
      exo\_io\_micro.write\_equation\_systems(input\_params.output\_file\_micro,equation\_systems\_micro,&system\_names\_micro);}
285 
286 \textcolor{comment}{//      exo\_io\_micro.write\_element\_data(equation\_systems\_micro);}
287 
288 \textcolor{comment}{//      libMesh::ExodusII\_IO exo\_io\_BIG(system\_mesh, /*single\_precision=*/true);}
289 
290 \textcolor{comment}{//      std::set<std::string> system\_names\_BIG;}
291 \textcolor{comment}{//      system\_names\_BIG.insert("Elasticity");}
292 \textcolor{comment}{//      
      exo\_io\_BIG.write\_equation\_systems(input\_params.output\_file\_BIG,equation\_systems\_BIG,&system\_names\_BIG);}
293 
294 \textcolor{comment}{//      exo\_io\_BIG.write\_element\_data(equation\_systems\_BIG);}
295 \textcolor{comment}{//      perf\_log.pop("Save output","Output:");}
296 \textcolor{comment}{//  \}}
297 \textcolor{comment}{// #endif}
298 
299 \textcolor{comment}{//  if(input\_params.b\_ExportScalingData)}
300 \textcolor{comment}{//  \{}
301 \textcolor{comment}{//      CoupledTest.print\_perf\_log(input\_params.scaling\_data\_file);}
302 \textcolor{comment}{//  \}}
303 
304     \textcolor{keywordflow}{return} 0;
305 \}\end{DoxyCode}
