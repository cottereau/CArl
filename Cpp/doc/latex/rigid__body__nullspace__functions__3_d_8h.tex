\hypertarget{rigid__body__nullspace__functions__3_d_8h}{}\section{/\+Users/breubreubreu/\+Programming/\+C\+Arl/\+Cpp/src/execs/ext\+\_\+solver\+\_\+libmesh/ext\+\_\+solver\+\_\+libmesh\+\_\+common/include/rigid\+\_\+body\+\_\+nullspace\+\_\+functions\+\_\+3\+D.h File Reference}
\label{rigid__body__nullspace__functions__3_d_8h}\index{/\+Users/breubreubreu/\+Programming/\+C\+Arl/\+Cpp/src/execs/ext\+\_\+solver\+\_\+libmesh/ext\+\_\+solver\+\_\+libmesh\+\_\+common/include/rigid\+\_\+body\+\_\+nullspace\+\_\+functions\+\_\+3\+D.\+h@{/\+Users/breubreubreu/\+Programming/\+C\+Arl/\+Cpp/src/execs/ext\+\_\+solver\+\_\+libmesh/ext\+\_\+solver\+\_\+libmesh\+\_\+common/include/rigid\+\_\+body\+\_\+nullspace\+\_\+functions\+\_\+3\+D.\+h}}
{\ttfamily \#include \char`\"{}common\+\_\+header\+\_\+ext\+\_\+solver\+\_\+libmesh.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}P\+E\+T\+S\+C\+\_\+matrix\+\_\+operations.\+h\char`\"{}}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{rigid__body__nullspace__functions__3_d_8h_ae89c68ca2fb752127c2c39e23668f914}{build\+\_\+rigid\+\_\+body\+\_\+vectors} (lib\+Mesh\+::\+Implicit\+System \&input\+\_\+system, Mat\+Null\+Space \&nullsp\+\_\+sys)
\begin{DoxyCompactList}\small\item\em Build the rigid body modes associated to a given system. \end{DoxyCompactList}\item 
void \hyperlink{rigid__body__nullspace__functions__3_d_8h_a92d61aec182bca7a41728f3856f7113f}{write\+\_\+rigid\+\_\+body\+\_\+vectors} (Mat\+Null\+Space \&nullsp\+\_\+sys, const std\+::string output\+\_\+base, int rank)
\begin{DoxyCompactList}\small\item\em Export the rigid body mode vectors to a folder. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{rigid__body__nullspace__functions__3_d_8h_ae89c68ca2fb752127c2c39e23668f914}{}\index{rigid\+\_\+body\+\_\+nullspace\+\_\+functions\+\_\+3\+D.\+h@{rigid\+\_\+body\+\_\+nullspace\+\_\+functions\+\_\+3\+D.\+h}!build\+\_\+rigid\+\_\+body\+\_\+vectors@{build\+\_\+rigid\+\_\+body\+\_\+vectors}}
\index{build\+\_\+rigid\+\_\+body\+\_\+vectors@{build\+\_\+rigid\+\_\+body\+\_\+vectors}!rigid\+\_\+body\+\_\+nullspace\+\_\+functions\+\_\+3\+D.\+h@{rigid\+\_\+body\+\_\+nullspace\+\_\+functions\+\_\+3\+D.\+h}}
\subsubsection[{build\+\_\+rigid\+\_\+body\+\_\+vectors(lib\+Mesh\+::\+Implicit\+System \&input\+\_\+system, Mat\+Null\+Space \&nullsp\+\_\+sys)}]{\setlength{\rightskip}{0pt plus 5cm}void build\+\_\+rigid\+\_\+body\+\_\+vectors (
\begin{DoxyParamCaption}
\item[{lib\+Mesh\+::\+Implicit\+System \&}]{input\+\_\+system, }
\item[{Mat\+Null\+Space \&}]{nullsp\+\_\+sys}
\end{DoxyParamCaption}
)}\label{rigid__body__nullspace__functions__3_d_8h_ae89c68ca2fb752127c2c39e23668f914}


Build the rigid body modes associated to a given system. 

Mesh address 

Definition at line 3 of file rigid\+\_\+body\+\_\+nullspace\+\_\+functions\+\_\+3\+D.\+cpp.


\begin{DoxyCode}
4 \{
5     \textcolor{comment}{// --- Set up some temporary variables to simplify code}
6 
7     \textcolor{comment}{// System matrix pointer (only used to get the proper vector dimensions)}
8     libMesh::PetscMatrix<libMesh::Number> * mat\_sys = 
      libMesh::cast\_ptr<libMesh::PetscMatrix<libMesh::Number>* >(input\_system.matrix);
9 
11     \textcolor{keyword}{const} libMesh::MeshBase& mesh\_sys = input\_system.get\_mesh();
12 
13     \textcolor{comment}{// System number}
14     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} sys\_number = input\_system.number();
15 
16     \textcolor{comment}{// --- Set the coordinates vector structure as the same of rigidity matrix}
17     Vec coord\_vec\_PETSC;
18     PetscInt local\_N;
19     MatGetLocalSize(mat\_sys->mat(),NULL,&local\_N);
20     VecCreate(mesh\_sys.comm().get(),&coord\_vec\_PETSC);
21     VecSetSizes(coord\_vec\_PETSC,local\_N,mat\_sys->n());
22     VecSetBlockSize(coord\_vec\_PETSC,mesh\_sys.mesh\_dimension());
23     VecSetFromOptions(coord\_vec\_PETSC);
24 
25     libMesh::PetscVector<libMesh::Number> coord\_vec(coord\_vec\_PETSC,mesh\_sys.comm());
26 
27     \textcolor{comment}{// --- Fill the coordinates vector}
28     \textcolor{keyword}{auto} node\_it = mesh\_sys.local\_nodes\_begin();
29     \textcolor{keyword}{auto} node\_it\_end = mesh\_sys.local\_nodes\_end();
30 
31     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} dof\_number = 0;
32 
33     \textcolor{keywordflow}{for}( ; node\_it != node\_it\_end; ++node\_it)
34     \{
35         \textcolor{keyword}{const} libMesh::Node* node = *node\_it;
36 
37         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} var=0; var<node->n\_dofs(sys\_number); var++)
38         \{
39             dof\_number = node->dof\_number(sys\_number,var,0);
40             coord\_vec.set(dof\_number,node->operator ()(var));
41         \}
42     \}
43 
44     MatNullSpaceCreateRigidBody(coord\_vec.vec(),&nullsp\_sys);
45     VecDestroy(&coord\_vec\_PETSC);
46 \};
\end{DoxyCode}
\hypertarget{rigid__body__nullspace__functions__3_d_8h_a92d61aec182bca7a41728f3856f7113f}{}\index{rigid\+\_\+body\+\_\+nullspace\+\_\+functions\+\_\+3\+D.\+h@{rigid\+\_\+body\+\_\+nullspace\+\_\+functions\+\_\+3\+D.\+h}!write\+\_\+rigid\+\_\+body\+\_\+vectors@{write\+\_\+rigid\+\_\+body\+\_\+vectors}}
\index{write\+\_\+rigid\+\_\+body\+\_\+vectors@{write\+\_\+rigid\+\_\+body\+\_\+vectors}!rigid\+\_\+body\+\_\+nullspace\+\_\+functions\+\_\+3\+D.\+h@{rigid\+\_\+body\+\_\+nullspace\+\_\+functions\+\_\+3\+D.\+h}}
\subsubsection[{write\+\_\+rigid\+\_\+body\+\_\+vectors(\+Mat\+Null\+Space \&nullsp\+\_\+sys, const std\+::string output\+\_\+base, int rank)}]{\setlength{\rightskip}{0pt plus 5cm}void write\+\_\+rigid\+\_\+body\+\_\+vectors (
\begin{DoxyParamCaption}
\item[{Mat\+Null\+Space \&}]{nullsp\+\_\+sys, }
\item[{const std\+::string}]{output\+\_\+base, }
\item[{int}]{rank}
\end{DoxyParamCaption}
)}\label{rigid__body__nullspace__functions__3_d_8h_a92d61aec182bca7a41728f3856f7113f}


Export the rigid body mode vectors to a folder. 



Definition at line 49 of file rigid\+\_\+body\+\_\+nullspace\+\_\+functions\+\_\+3\+D.\+cpp.


\begin{DoxyCode}
50 \{
51     \textcolor{comment}{// PETSc variables}
52     PetscInt    nullsp\_nvecs;
53     \textcolor{keyword}{const} Vec * nullsp\_vecs;
54     PetscBool   nullsp\_has\_const;
55     
56     \textcolor{comment}{// Get the vectors}
57     MatNullSpaceGetVecs(nullsp\_sys,&nullsp\_has\_const,&nullsp\_nvecs,&nullsp\_vecs);
58 
59     \textcolor{comment}{// Print them}
60     std::string filename;
61     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} iii = 0; iii < nullsp\_nvecs; ++iii)
62     \{
63         filename = output\_base + \textcolor{stringliteral}{"\_rb\_vector\_"} + std::to\_string(iii) + \textcolor{stringliteral}{"\_n\_"} + std::to\_string(nullsp\_nvecs)
      ;
64 
65         \textcolor{comment}{// Export the RB vector}
66         \hyperlink{namespacecarl_a1632084ec1f296b63559648cc9c2047f}{carl::write\_PETSC\_vector}(nullsp\_vecs[iii], filename + \textcolor{stringliteral}{".petscvec"},rank,
      PETSC\_COMM\_WORLD);
67 
68 \textcolor{comment}{// Print MatLab debugging output? Variable defined at "carl\_headers.h"}
69 \textcolor{preprocessor}{#ifdef PRINT\_MATLAB\_DEBUG}
70         \hyperlink{namespacecarl_a25d36e4c1615382a1832d73c716599db}{carl::write\_PETSC\_vector\_MATLAB}(nullsp\_vecs[iii],filename + \textcolor{stringliteral}{".m"},
      PETSC\_COMM\_WORLD);
71 \textcolor{preprocessor}{#endif}
72     \};
73 \};
\end{DoxyCode}
